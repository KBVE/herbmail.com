let E=0,p=[];function U(){return E+=1,()=>{if(E-=1,E===0){let e=p;p=[];for(let t of e)t()}}}function V(e){let t=U();return e().finally(t)}let l=[],x=(e,t)=>{let r=[],s={get(){return s.lc||s.listen(()=>{})(),s.value},l:t||0,lc:0,listen(n,i){return s.lc=r.push(n,i||s.l)/2,()=>{let a=r.indexOf(n);~a&&(r.splice(a,2),s.lc--,s.lc||s.off())}},notify(n){let i=!l.length;for(let a=0;a<r.length;a+=2)l.push(r[a],s.value,n,r[a+1]);if(i){for(let a=0;a<l.length;a+=4){let h=!1;for(let d=a+7;d<l.length;d+=4)if(l[d]<l[a+3]){h=!0;break}h?l.push(l[a],l[a+1],l[a+2],l[a+3]):l[a](l[a+1],l[a+2])}l.length=0}},off(){},set(n){s.value!==n&&(s.value=n,s.notify())},subscribe(n,i){let a=s.listen(n,i);return n(s.value),a},value:e};return s};const $=5,y=6,m=10;let O=(e,t,r,s)=>(e.events=e.events||{},e.events[r+m]||(e.events[r+m]=s(n=>{e.events[r].reduceRight((i,a)=>(a(i),i),{shared:{},...n})})),e.events[r]=e.events[r]||[],e.events[r].push(t),()=>{let n=e.events[r],i=n.indexOf(t);n.splice(i,1),n.length||(delete e.events[r],e.events[r+m](),delete e.events[r+m])}),T=1e3,N=(e,t)=>O(e,s=>{let n=t(s);n&&e.events[y].push(n)},$,s=>{let n=e.listen;e.listen=(...a)=>(!e.lc&&!e.active&&(e.active=!0,s()),n(...a));let i=e.off;return e.events[y]=[],e.off=()=>{i(),setTimeout(()=>{if(e.active&&!e.lc){e.active=!1;for(let a of e.events[y])a();e.events[y]=[]}},T)},()=>{e.listen=n,e.off=i}}),b=(e={})=>{let t=x(e);return t.setKey=function(r,s){typeof s>"u"?r in t.value&&(t.value={...t.value},delete t.value[r],t.notify(r)):t.value[r]!==s&&(t.value={...t.value,[r]:s},t.notify(r))},t};const z="/api/v1/",Z="5ba581fa-b6fc-4bb0-8222-02fcd6a59e35",C="https://js.hcaptcha.com/1/api.js",R="auth/register",P="auth/login";class c{status;error;message;data;constructor(t,r,s){this.status=t,this.error=t<200||t>=300,this.message=r,this.data=s}display(){console.log(`Status: ${this.status}, Message: ${this.message}, Error: ${this.error}, Data: ${JSON.stringify(this.data)}`)}scope(){try{return JSON.stringify(this.data)}catch(t){return console.error("Parsing error:",t),"Error: Unable to parse data"}}async serialize(){try{return JSON.stringify({status:this.status,error:this.error,message:this.message,data:this.data})}catch(t){return console.error("Serialization error:",t),JSON.stringify({status:500,error:!0,message:"Internal Server Error: Unable to serialize response",data:{}})}}static async deserialize(t){try{const r=JSON.parse(t);return new c(r.status,r.message,r.data)}catch(r){return console.error("Deserialization error:",r),new c(500,"Internal Server Error: Unable to deserialize response",{})}}}const _=new RegExp(/^[a-z0-9]+$/i),w=8,A=async e=>e.length<w?new c(400,"Validation Error",{error:"Username is too short. Minimum length is "+w}):_.test(e)?new c(200,"Validation Successful",{message:"Username is valid."}):new c(400,"Validation Error",{error:"Username contains invalid characters."});async function F(e){try{const t=await A(e);return t.status===200?{isValid:!0,error:null}:{isValid:!1,error:t.data.error}}catch{return{isValid:!1,error:"An unexpected error occurred"}}}const M=new RegExp(/(?:[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*|"(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21\x23-\x5b\x5d-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])*")@(?:(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?|\[(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?|[a-z0-9-]*[a-z0-9]:(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21-\x5a\x53-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])+)\])/),J=async e=>M.test(e)?new c(200,"Validation Successful",{message:"Email is valid."}):new c(400,"Validation Error",{error:"Email is invalid."});async function Y(e){try{const t=await J(e);return t.status===200?{isValid:!0,error:null}:{isValid:!1,error:t.data.error}}catch{return{isValid:!1,error:"An unexpected error occurred"}}}const D=async e=>{if(e.length<8)return new c(400,"Validation Error",{error:"Password is too short"});if(e.length>255)return new c(400,"Validation Error",{error:"Password is too long"});const t=/[A-Z]/.test(e),r=/[a-z]/.test(e),s=/\d/.test(e),n=/[^A-Za-z0-9]/.test(e);return!t||!r||!s||!n?new c(400,"Validation Error",{error:"Password must include uppercase, lowercase, digits, and special characters"}):new c(200,"Validation Successful",{message:"Password is valid"})};async function B(e){try{const t=await D(e);return t.status===200?{isValid:!0,error:null}:{isValid:!1,error:t.data.error}}catch{return{isValid:!1,error:"An unexpected error occurred"}}}async function L(e,t,r){try{const s=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json",...r},body:JSON.stringify(t),credentials:"include"}),n=await s.json(),i=n.message||(s.ok?"Success":"Error"),h=!s.ok&&n.error?{error:n.error}:n;return new c(s.status,i,h)}catch(s){return console.error("Request failed:",s),new c(500,"Internal Server Error: Request failed",{})}}async function G(e,t,r,s,n){const i=`${e}${z}${R}`;return L(i,{username:t,email:r,password:s,token:n},{"x-kbve-shieldwall":"auth-register"})}async function X(e,t,r){const s=`${e}${z}${P}`;return L(s,{email:t,password:r},{"x-kbve-shieldwall":"auth-login"})}let S=e=>e,g={},f={addEventListener(){},removeEventListener(){}};function I(){try{return typeof localStorage<"u"}catch{return!1}}I()&&(g=localStorage);let q={addEventListener(e,t,r){window.addEventListener("storage",t),window.addEventListener("pageshow",r)},removeEventListener(e,t,r){window.removeEventListener("storage",t),window.removeEventListener("pageshow",r)}};typeof window<"u"&&(f=q);function Q(e,t={},r={}){let s=r.encode||S,n=r.decode||S,i=b(),a=i.setKey;i.setKey=(o,u)=>{typeof u>"u"?(r.listen!==!1&&f.perKey&&f.removeEventListener(e+o,d,v),delete g[e+o]):(r.listen!==!1&&f.perKey&&!(o in i.value)&&f.addEventListener(e+o,d,v),g[e+o]=s(u)),a(o,u)};let h=i.set;i.set=function(o){for(let u in o)i.setKey(u,o[u]);for(let u in i.value)u in o||i.setKey(u)};function d(o){o.key?o.key.startsWith(e)&&(o.newValue===null?a(o.key.slice(e.length),void 0):a(o.key.slice(e.length),n(o.newValue))):h({})}function v(){let o={...t};for(let u in g)u.startsWith(e)&&(o[u.slice(e.length)]=n(g[u]));i.set(o)}return N(i,()=>{if(v(),r.listen!==!1)return f.addEventListener(e,d,v),()=>{f.removeEventListener(e,d,v);for(let o in i.value)f.removeEventListener(e+o,d,v)}}),i}const W=x(""),k=x("");Q("kbve:");k.subscribe(e=>{console.log(`[TOAST] -> ${e}`)});const H=async e=>{V(async()=>{W.set(e),k.set(e)})};export{B as a,C as b,Y as c,F as d,Z as h,X as l,H as n,G as r,k as t};
