const __vite__fileDeps=["_astro/browser.NOQ3X0A0.js","_astro/index.SSXOyoI7.js"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{S as Bo,i as Mo,s as qo,E as Ji,a as Ie,e as ee,t as Wn,v as Ko,h as ae,d as je,c as te,b as be,g as _t,f as Gn,j as J,H as Qr,B as Ta,l as G,k as Yt,m as Ht,n as Zr,I as zo,o as Yn,p as zn,r as Ho,J as Jo,x as Vo,y as Wo}from"./index.Bw2twfQ2.js";import{g as Go}from"./globals.D0QH3NT1.js";import{p as Aa,m as Yo,a as Xo,b as Ra}from"./index.Y0MI8VVX.js";import{t as Qo}from"./index.BH1EYZ08.js";import{_ as Nr}from"./preload-helper.ygWHROA3.js";import{c as Vi,g as Zo,R as ec,r as Ds}from"./index.SSXOyoI7.js";import{j as Ln}from"./jsx-runtime.BPj4-Rfu.js";var Ia=(s=>(s.DARK="dark",s.LIGHT="light",s))(Ia||{});const Wi={hcaptcha:"5ba581fa-b6fc-4bb0-8222-02fcd6a59e35",hcaptcha_api:"https://js.hcaptcha.com/1/api.js",api:"https://supabase.kbve.com",anonKey:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.ewogICJyb2xlIjogImFub24iLAogICJpc3MiOiAic3VwYWJhc2UiLAogICJpYXQiOiAxNzI0NTM2ODAwLAogICJleHAiOiAxODgyMzAzMjAwCn0._fmEmblm0afeLoPXxt8wP2mYpa9gzU-ufx3v8oRTFGg"},Hn={_state:{...Wi},get(){return{...this._state}},set(s){this._state={...this._state,...s}},reset(){this._state={...Wi}},toString(){return JSON.stringify(this._state,null,2)},getKey(s){return this._state[s]}};function ja(s,e){return function(){return s.apply(e,arguments)}}const{toString:tc}=Object.prototype,{getPrototypeOf:ai}=Object,Xn=(s=>e=>{const t=tc.call(e);return s[t]||(s[t]=t.slice(8,-1).toLowerCase())})(Object.create(null)),Et=s=>(s=s.toLowerCase(),e=>Xn(e)===s),Qn=s=>e=>typeof e===s,{isArray:Ur}=Array,cn=Qn("undefined");function rc(s){return s!==null&&!cn(s)&&s.constructor!==null&&!cn(s.constructor)&&it(s.constructor.isBuffer)&&s.constructor.isBuffer(s)}const Da=Et("ArrayBuffer");function nc(s){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(s):e=s&&s.buffer&&Da(s.buffer),e}const sc=Qn("string"),it=Qn("function"),Na=Qn("number"),Zn=s=>s!==null&&typeof s=="object",ic=s=>s===!0||s===!1,Mn=s=>{if(Xn(s)!=="object")return!1;const e=ai(s);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in s)&&!(Symbol.iterator in s)},ac=Et("Date"),oc=Et("File"),cc=Et("Blob"),uc=Et("FileList"),lc=s=>Zn(s)&&it(s.pipe),hc=s=>{let e;return s&&(typeof FormData=="function"&&s instanceof FormData||it(s.append)&&((e=Xn(s))==="formdata"||e==="object"&&it(s.toString)&&s.toString()==="[object FormData]"))},dc=Et("URLSearchParams"),fc=s=>s.trim?s.trim():s.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function hn(s,e,{allOwnKeys:t=!1}={}){if(s===null||typeof s>"u")return;let r,o;if(typeof s!="object"&&(s=[s]),Ur(s))for(r=0,o=s.length;r<o;r++)e.call(null,s[r],r,s);else{const a=t?Object.getOwnPropertyNames(s):Object.keys(s),u=a.length;let d;for(r=0;r<u;r++)d=a[r],e.call(null,s[d],d,s)}}function $a(s,e){e=e.toLowerCase();const t=Object.keys(s);let r=t.length,o;for(;r-- >0;)if(o=t[r],e===o.toLowerCase())return o;return null}const La=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,Ua=s=>!cn(s)&&s!==La;function Js(){const{caseless:s}=Ua(this)&&this||{},e={},t=(r,o)=>{const a=s&&$a(e,o)||o;Mn(e[a])&&Mn(r)?e[a]=Js(e[a],r):Mn(r)?e[a]=Js({},r):Ur(r)?e[a]=r.slice():e[a]=r};for(let r=0,o=arguments.length;r<o;r++)arguments[r]&&hn(arguments[r],t);return e}const pc=(s,e,t,{allOwnKeys:r}={})=>(hn(e,(o,a)=>{t&&it(o)?s[a]=ja(o,t):s[a]=o},{allOwnKeys:r}),s),mc=s=>(s.charCodeAt(0)===65279&&(s=s.slice(1)),s),yc=(s,e,t,r)=>{s.prototype=Object.create(e.prototype,r),s.prototype.constructor=s,Object.defineProperty(s,"super",{value:e.prototype}),t&&Object.assign(s.prototype,t)},gc=(s,e,t,r)=>{let o,a,u;const d={};if(e=e||{},s==null)return e;do{for(o=Object.getOwnPropertyNames(s),a=o.length;a-- >0;)u=o[a],(!r||r(u,s,e))&&!d[u]&&(e[u]=s[u],d[u]=!0);s=t!==!1&&ai(s)}while(s&&(!t||t(s,e))&&s!==Object.prototype);return e},vc=(s,e,t)=>{s=String(s),(t===void 0||t>s.length)&&(t=s.length),t-=e.length;const r=s.indexOf(e,t);return r!==-1&&r===t},bc=s=>{if(!s)return null;if(Ur(s))return s;let e=s.length;if(!Na(e))return null;const t=new Array(e);for(;e-- >0;)t[e]=s[e];return t},wc=(s=>e=>s&&e instanceof s)(typeof Uint8Array<"u"&&ai(Uint8Array)),_c=(s,e)=>{const r=(s&&s[Symbol.iterator]).call(s);let o;for(;(o=r.next())&&!o.done;){const a=o.value;e.call(s,a[0],a[1])}},kc=(s,e)=>{let t;const r=[];for(;(t=s.exec(e))!==null;)r.push(t);return r},Ec=Et("HTMLFormElement"),Sc=s=>s.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(t,r,o){return r.toUpperCase()+o}),Gi=(({hasOwnProperty:s})=>(e,t)=>s.call(e,t))(Object.prototype),xc=Et("RegExp"),Fa=(s,e)=>{const t=Object.getOwnPropertyDescriptors(s),r={};hn(t,(o,a)=>{let u;(u=e(o,a,s))!==!1&&(r[a]=u||o)}),Object.defineProperties(s,r)},Pc=s=>{Fa(s,(e,t)=>{if(it(s)&&["arguments","caller","callee"].indexOf(t)!==-1)return!1;const r=s[t];if(it(r)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+t+"'")})}})},Oc=(s,e)=>{const t={},r=o=>{o.forEach(a=>{t[a]=!0})};return Ur(s)?r(s):r(String(s).split(e)),t},Cc=()=>{},Tc=(s,e)=>(s=+s,Number.isFinite(s)?s:e),Ns="abcdefghijklmnopqrstuvwxyz",Yi="0123456789",Ba={DIGIT:Yi,ALPHA:Ns,ALPHA_DIGIT:Ns+Ns.toUpperCase()+Yi},Ac=(s=16,e=Ba.ALPHA_DIGIT)=>{let t="";const{length:r}=e;for(;s--;)t+=e[Math.random()*r|0];return t};function Rc(s){return!!(s&&it(s.append)&&s[Symbol.toStringTag]==="FormData"&&s[Symbol.iterator])}const Ic=s=>{const e=new Array(10),t=(r,o)=>{if(Zn(r)){if(e.indexOf(r)>=0)return;if(!("toJSON"in r)){e[o]=r;const a=Ur(r)?[]:{};return hn(r,(u,d)=>{const p=t(u,o+1);!cn(p)&&(a[d]=p)}),e[o]=void 0,a}}return r};return t(s,0)},jc=Et("AsyncFunction"),Dc=s=>s&&(Zn(s)||it(s))&&it(s.then)&&it(s.catch),j={isArray:Ur,isArrayBuffer:Da,isBuffer:rc,isFormData:hc,isArrayBufferView:nc,isString:sc,isNumber:Na,isBoolean:ic,isObject:Zn,isPlainObject:Mn,isUndefined:cn,isDate:ac,isFile:oc,isBlob:cc,isRegExp:xc,isFunction:it,isStream:lc,isURLSearchParams:dc,isTypedArray:wc,isFileList:uc,forEach:hn,merge:Js,extend:pc,trim:fc,stripBOM:mc,inherits:yc,toFlatObject:gc,kindOf:Xn,kindOfTest:Et,endsWith:vc,toArray:bc,forEachEntry:_c,matchAll:kc,isHTMLForm:Ec,hasOwnProperty:Gi,hasOwnProp:Gi,reduceDescriptors:Fa,freezeMethods:Pc,toObjectSet:Oc,toCamelCase:Sc,noop:Cc,toFiniteNumber:Tc,findKey:$a,global:La,isContextDefined:Ua,ALPHABET:Ba,generateString:Ac,isSpecCompliantForm:Rc,toJSONObject:Ic,isAsyncFn:jc,isThenable:Dc};function fe(s,e,t,r,o){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=s,this.name="AxiosError",e&&(this.code=e),t&&(this.config=t),r&&(this.request=r),o&&(this.response=o)}j.inherits(fe,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:j.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});const Ma=fe.prototype,qa={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(s=>{qa[s]={value:s}});Object.defineProperties(fe,qa);Object.defineProperty(Ma,"isAxiosError",{value:!0});fe.from=(s,e,t,r,o,a)=>{const u=Object.create(Ma);return j.toFlatObject(s,u,function(p){return p!==Error.prototype},d=>d!=="isAxiosError"),fe.call(u,s.message,e,t,r,o),u.cause=s,u.name=s.name,a&&Object.assign(u,a),u};const Nc=null;function Vs(s){return j.isPlainObject(s)||j.isArray(s)}function Ka(s){return j.endsWith(s,"[]")?s.slice(0,-2):s}function Xi(s,e,t){return s?s.concat(e).map(function(o,a){return o=Ka(o),!t&&a?"["+o+"]":o}).join(t?".":""):e}function $c(s){return j.isArray(s)&&!s.some(Vs)}const Lc=j.toFlatObject(j,{},null,function(e){return/^is[A-Z]/.test(e)});function es(s,e,t){if(!j.isObject(s))throw new TypeError("target must be an object");e=e||new FormData,t=j.toFlatObject(t,{metaTokens:!0,dots:!1,indexes:!1},!1,function(L,V){return!j.isUndefined(V[L])});const r=t.metaTokens,o=t.visitor||y,a=t.dots,u=t.indexes,p=(t.Blob||typeof Blob<"u"&&Blob)&&j.isSpecCompliantForm(e);if(!j.isFunction(o))throw new TypeError("visitor must be a function");function g($){if($===null)return"";if(j.isDate($))return $.toISOString();if(!p&&j.isBlob($))throw new fe("Blob is not supported. Use a Buffer instead.");return j.isArrayBuffer($)||j.isTypedArray($)?p&&typeof Blob=="function"?new Blob([$]):Buffer.from($):$}function y($,L,V){let Q=$;if($&&!V&&typeof $=="object"){if(j.endsWith(L,"{}"))L=r?L:L.slice(0,-2),$=JSON.stringify($);else if(j.isArray($)&&$c($)||(j.isFileList($)||j.endsWith(L,"[]"))&&(Q=j.toArray($)))return L=Ka(L),Q.forEach(function(he,X){!(j.isUndefined(he)||he===null)&&e.append(u===!0?Xi([L],X,a):u===null?L:L+"[]",g(he))}),!1}return Vs($)?!0:(e.append(Xi(V,L,a),g($)),!1)}const w=[],D=Object.assign(Lc,{defaultVisitor:y,convertValue:g,isVisitable:Vs});function F($,L){if(!j.isUndefined($)){if(w.indexOf($)!==-1)throw Error("Circular reference detected in "+L.join("."));w.push($),j.forEach($,function(Q,le){(!(j.isUndefined(Q)||Q===null)&&o.call(e,Q,j.isString(le)?le.trim():le,L,D))===!0&&F(Q,L?L.concat(le):[le])}),w.pop()}}if(!j.isObject(s))throw new TypeError("data must be an object");return F(s),e}function Qi(s){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(s).replace(/[!'()~]|%20|%00/g,function(r){return e[r]})}function oi(s,e){this._pairs=[],s&&es(s,this,e)}const za=oi.prototype;za.append=function(e,t){this._pairs.push([e,t])};za.toString=function(e){const t=e?function(r){return e.call(this,r,Qi)}:Qi;return this._pairs.map(function(o){return t(o[0])+"="+t(o[1])},"").join("&")};function Uc(s){return encodeURIComponent(s).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function Ha(s,e,t){if(!e)return s;const r=t&&t.encode||Uc,o=t&&t.serialize;let a;if(o?a=o(e,t):a=j.isURLSearchParams(e)?e.toString():new oi(e,t).toString(r),a){const u=s.indexOf("#");u!==-1&&(s=s.slice(0,u)),s+=(s.indexOf("?")===-1?"?":"&")+a}return s}class Zi{constructor(){this.handlers=[]}use(e,t,r){return this.handlers.push({fulfilled:e,rejected:t,synchronous:r?r.synchronous:!1,runWhen:r?r.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){j.forEach(this.handlers,function(r){r!==null&&e(r)})}}const Ja={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Fc=typeof URLSearchParams<"u"?URLSearchParams:oi,Bc=typeof FormData<"u"?FormData:null,Mc=typeof Blob<"u"?Blob:null,qc={isBrowser:!0,classes:{URLSearchParams:Fc,FormData:Bc,Blob:Mc},protocols:["http","https","file","blob","url","data"]},Va=typeof window<"u"&&typeof document<"u",Kc=(s=>Va&&["ReactNative","NativeScript","NS"].indexOf(s)<0)(typeof navigator<"u"&&navigator.product),zc=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",Hc=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:Va,hasStandardBrowserEnv:Kc,hasStandardBrowserWebWorkerEnv:zc},Symbol.toStringTag,{value:"Module"})),kt={...Hc,...qc};function Jc(s,e){return es(s,new kt.classes.URLSearchParams,Object.assign({visitor:function(t,r,o,a){return kt.isNode&&j.isBuffer(t)?(this.append(r,t.toString("base64")),!1):a.defaultVisitor.apply(this,arguments)}},e))}function Vc(s){return j.matchAll(/\w+|\[(\w*)]/g,s).map(e=>e[0]==="[]"?"":e[1]||e[0])}function Wc(s){const e={},t=Object.keys(s);let r;const o=t.length;let a;for(r=0;r<o;r++)a=t[r],e[a]=s[a];return e}function Wa(s){function e(t,r,o,a){let u=t[a++];if(u==="__proto__")return!0;const d=Number.isFinite(+u),p=a>=t.length;return u=!u&&j.isArray(o)?o.length:u,p?(j.hasOwnProp(o,u)?o[u]=[o[u],r]:o[u]=r,!d):((!o[u]||!j.isObject(o[u]))&&(o[u]=[]),e(t,r,o[u],a)&&j.isArray(o[u])&&(o[u]=Wc(o[u])),!d)}if(j.isFormData(s)&&j.isFunction(s.entries)){const t={};return j.forEachEntry(s,(r,o)=>{e(Vc(r),o,t,0)}),t}return null}function Gc(s,e,t){if(j.isString(s))try{return(e||JSON.parse)(s),j.trim(s)}catch(r){if(r.name!=="SyntaxError")throw r}return(t||JSON.stringify)(s)}const ci={transitional:Ja,adapter:["xhr","http"],transformRequest:[function(e,t){const r=t.getContentType()||"",o=r.indexOf("application/json")>-1,a=j.isObject(e);if(a&&j.isHTMLForm(e)&&(e=new FormData(e)),j.isFormData(e))return o?JSON.stringify(Wa(e)):e;if(j.isArrayBuffer(e)||j.isBuffer(e)||j.isStream(e)||j.isFile(e)||j.isBlob(e))return e;if(j.isArrayBufferView(e))return e.buffer;if(j.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let d;if(a){if(r.indexOf("application/x-www-form-urlencoded")>-1)return Jc(e,this.formSerializer).toString();if((d=j.isFileList(e))||r.indexOf("multipart/form-data")>-1){const p=this.env&&this.env.FormData;return es(d?{"files[]":e}:e,p&&new p,this.formSerializer)}}return a||o?(t.setContentType("application/json",!1),Gc(e)):e}],transformResponse:[function(e){const t=this.transitional||ci.transitional,r=t&&t.forcedJSONParsing,o=this.responseType==="json";if(e&&j.isString(e)&&(r&&!this.responseType||o)){const u=!(t&&t.silentJSONParsing)&&o;try{return JSON.parse(e)}catch(d){if(u)throw d.name==="SyntaxError"?fe.from(d,fe.ERR_BAD_RESPONSE,this,null,this.response):d}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:kt.classes.FormData,Blob:kt.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};j.forEach(["delete","get","head","post","put","patch"],s=>{ci.headers[s]={}});const ui=ci,Yc=j.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),Xc=s=>{const e={};let t,r,o;return s&&s.split(`
`).forEach(function(u){o=u.indexOf(":"),t=u.substring(0,o).trim().toLowerCase(),r=u.substring(o+1).trim(),!(!t||e[t]&&Yc[t])&&(t==="set-cookie"?e[t]?e[t].push(r):e[t]=[r]:e[t]=e[t]?e[t]+", "+r:r)}),e},ea=Symbol("internals");function en(s){return s&&String(s).trim().toLowerCase()}function qn(s){return s===!1||s==null?s:j.isArray(s)?s.map(qn):String(s)}function Qc(s){const e=Object.create(null),t=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let r;for(;r=t.exec(s);)e[r[1]]=r[2];return e}const Zc=s=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(s.trim());function $s(s,e,t,r,o){if(j.isFunction(r))return r.call(this,e,t);if(o&&(e=t),!!j.isString(e)){if(j.isString(r))return e.indexOf(r)!==-1;if(j.isRegExp(r))return r.test(e)}}function eu(s){return s.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,t,r)=>t.toUpperCase()+r)}function tu(s,e){const t=j.toCamelCase(" "+e);["get","set","has"].forEach(r=>{Object.defineProperty(s,r+t,{value:function(o,a,u){return this[r].call(this,e,o,a,u)},configurable:!0})})}class ts{constructor(e){e&&this.set(e)}set(e,t,r){const o=this;function a(d,p,g){const y=en(p);if(!y)throw new Error("header name must be a non-empty string");const w=j.findKey(o,y);(!w||o[w]===void 0||g===!0||g===void 0&&o[w]!==!1)&&(o[w||p]=qn(d))}const u=(d,p)=>j.forEach(d,(g,y)=>a(g,y,p));return j.isPlainObject(e)||e instanceof this.constructor?u(e,t):j.isString(e)&&(e=e.trim())&&!Zc(e)?u(Xc(e),t):e!=null&&a(t,e,r),this}get(e,t){if(e=en(e),e){const r=j.findKey(this,e);if(r){const o=this[r];if(!t)return o;if(t===!0)return Qc(o);if(j.isFunction(t))return t.call(this,o,r);if(j.isRegExp(t))return t.exec(o);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=en(e),e){const r=j.findKey(this,e);return!!(r&&this[r]!==void 0&&(!t||$s(this,this[r],r,t)))}return!1}delete(e,t){const r=this;let o=!1;function a(u){if(u=en(u),u){const d=j.findKey(r,u);d&&(!t||$s(r,r[d],d,t))&&(delete r[d],o=!0)}}return j.isArray(e)?e.forEach(a):a(e),o}clear(e){const t=Object.keys(this);let r=t.length,o=!1;for(;r--;){const a=t[r];(!e||$s(this,this[a],a,e,!0))&&(delete this[a],o=!0)}return o}normalize(e){const t=this,r={};return j.forEach(this,(o,a)=>{const u=j.findKey(r,a);if(u){t[u]=qn(o),delete t[a];return}const d=e?eu(a):String(a).trim();d!==a&&delete t[a],t[d]=qn(o),r[d]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const t=Object.create(null);return j.forEach(this,(r,o)=>{r!=null&&r!==!1&&(t[o]=e&&j.isArray(r)?r.join(", "):r)}),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,t])=>e+": "+t).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...t){const r=new this(e);return t.forEach(o=>r.set(o)),r}static accessor(e){const r=(this[ea]=this[ea]={accessors:{}}).accessors,o=this.prototype;function a(u){const d=en(u);r[d]||(tu(o,u),r[d]=!0)}return j.isArray(e)?e.forEach(a):a(e),this}}ts.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);j.reduceDescriptors(ts.prototype,({value:s},e)=>{let t=e[0].toUpperCase()+e.slice(1);return{get:()=>s,set(r){this[t]=r}}});j.freezeMethods(ts);const It=ts;function Ls(s,e){const t=this||ui,r=e||t,o=It.from(r.headers);let a=r.data;return j.forEach(s,function(d){a=d.call(t,a,o.normalize(),e?e.status:void 0)}),o.normalize(),a}function Ga(s){return!!(s&&s.__CANCEL__)}function dn(s,e,t){fe.call(this,s??"canceled",fe.ERR_CANCELED,e,t),this.name="CanceledError"}j.inherits(dn,fe,{__CANCEL__:!0});function ru(s,e,t){const r=t.config.validateStatus;!t.status||!r||r(t.status)?s(t):e(new fe("Request failed with status code "+t.status,[fe.ERR_BAD_REQUEST,fe.ERR_BAD_RESPONSE][Math.floor(t.status/100)-4],t.config,t.request,t))}const nu=kt.hasStandardBrowserEnv?{write(s,e,t,r,o,a){const u=[s+"="+encodeURIComponent(e)];j.isNumber(t)&&u.push("expires="+new Date(t).toGMTString()),j.isString(r)&&u.push("path="+r),j.isString(o)&&u.push("domain="+o),a===!0&&u.push("secure"),document.cookie=u.join("; ")},read(s){const e=document.cookie.match(new RegExp("(^|;\\s*)("+s+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove(s){this.write(s,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function su(s){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(s)}function iu(s,e){return e?s.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):s}function Ya(s,e){return s&&!su(e)?iu(s,e):e}const au=kt.hasStandardBrowserEnv?function(){const e=/(msie|trident)/i.test(navigator.userAgent),t=document.createElement("a");let r;function o(a){let u=a;return e&&(t.setAttribute("href",u),u=t.href),t.setAttribute("href",u),{href:t.href,protocol:t.protocol?t.protocol.replace(/:$/,""):"",host:t.host,search:t.search?t.search.replace(/^\?/,""):"",hash:t.hash?t.hash.replace(/^#/,""):"",hostname:t.hostname,port:t.port,pathname:t.pathname.charAt(0)==="/"?t.pathname:"/"+t.pathname}}return r=o(window.location.href),function(u){const d=j.isString(u)?o(u):u;return d.protocol===r.protocol&&d.host===r.host}}():function(){return function(){return!0}}();function ou(s){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(s);return e&&e[1]||""}function cu(s,e){s=s||10;const t=new Array(s),r=new Array(s);let o=0,a=0,u;return e=e!==void 0?e:1e3,function(p){const g=Date.now(),y=r[a];u||(u=g),t[o]=p,r[o]=g;let w=a,D=0;for(;w!==o;)D+=t[w++],w=w%s;if(o=(o+1)%s,o===a&&(a=(a+1)%s),g-u<e)return;const F=y&&g-y;return F?Math.round(D*1e3/F):void 0}}function ta(s,e){let t=0;const r=cu(50,250);return o=>{const a=o.loaded,u=o.lengthComputable?o.total:void 0,d=a-t,p=r(d),g=a<=u;t=a;const y={loaded:a,total:u,progress:u?a/u:void 0,bytes:d,rate:p||void 0,estimated:p&&u&&g?(u-a)/p:void 0,event:o};y[e?"download":"upload"]=!0,s(y)}}const uu=typeof XMLHttpRequest<"u",lu=uu&&function(s){return new Promise(function(t,r){let o=s.data;const a=It.from(s.headers).normalize();let{responseType:u,withXSRFToken:d}=s,p;function g(){s.cancelToken&&s.cancelToken.unsubscribe(p),s.signal&&s.signal.removeEventListener("abort",p)}let y;if(j.isFormData(o)){if(kt.hasStandardBrowserEnv||kt.hasStandardBrowserWebWorkerEnv)a.setContentType(!1);else if((y=a.getContentType())!==!1){const[L,...V]=y?y.split(";").map(Q=>Q.trim()).filter(Boolean):[];a.setContentType([L||"multipart/form-data",...V].join("; "))}}let w=new XMLHttpRequest;if(s.auth){const L=s.auth.username||"",V=s.auth.password?unescape(encodeURIComponent(s.auth.password)):"";a.set("Authorization","Basic "+btoa(L+":"+V))}const D=Ya(s.baseURL,s.url);w.open(s.method.toUpperCase(),Ha(D,s.params,s.paramsSerializer),!0),w.timeout=s.timeout;function F(){if(!w)return;const L=It.from("getAllResponseHeaders"in w&&w.getAllResponseHeaders()),Q={data:!u||u==="text"||u==="json"?w.responseText:w.response,status:w.status,statusText:w.statusText,headers:L,config:s,request:w};ru(function(he){t(he),g()},function(he){r(he),g()},Q),w=null}if("onloadend"in w?w.onloadend=F:w.onreadystatechange=function(){!w||w.readyState!==4||w.status===0&&!(w.responseURL&&w.responseURL.indexOf("file:")===0)||setTimeout(F)},w.onabort=function(){w&&(r(new fe("Request aborted",fe.ECONNABORTED,s,w)),w=null)},w.onerror=function(){r(new fe("Network Error",fe.ERR_NETWORK,s,w)),w=null},w.ontimeout=function(){let V=s.timeout?"timeout of "+s.timeout+"ms exceeded":"timeout exceeded";const Q=s.transitional||Ja;s.timeoutErrorMessage&&(V=s.timeoutErrorMessage),r(new fe(V,Q.clarifyTimeoutError?fe.ETIMEDOUT:fe.ECONNABORTED,s,w)),w=null},kt.hasStandardBrowserEnv&&(d&&j.isFunction(d)&&(d=d(s)),d||d!==!1&&au(D))){const L=s.xsrfHeaderName&&s.xsrfCookieName&&nu.read(s.xsrfCookieName);L&&a.set(s.xsrfHeaderName,L)}o===void 0&&a.setContentType(null),"setRequestHeader"in w&&j.forEach(a.toJSON(),function(V,Q){w.setRequestHeader(Q,V)}),j.isUndefined(s.withCredentials)||(w.withCredentials=!!s.withCredentials),u&&u!=="json"&&(w.responseType=s.responseType),typeof s.onDownloadProgress=="function"&&w.addEventListener("progress",ta(s.onDownloadProgress,!0)),typeof s.onUploadProgress=="function"&&w.upload&&w.upload.addEventListener("progress",ta(s.onUploadProgress)),(s.cancelToken||s.signal)&&(p=L=>{w&&(r(!L||L.type?new dn(null,s,w):L),w.abort(),w=null)},s.cancelToken&&s.cancelToken.subscribe(p),s.signal&&(s.signal.aborted?p():s.signal.addEventListener("abort",p)));const $=ou(D);if($&&kt.protocols.indexOf($)===-1){r(new fe("Unsupported protocol "+$+":",fe.ERR_BAD_REQUEST,s));return}w.send(o||null)})},Ws={http:Nc,xhr:lu};j.forEach(Ws,(s,e)=>{if(s){try{Object.defineProperty(s,"name",{value:e})}catch{}Object.defineProperty(s,"adapterName",{value:e})}});const ra=s=>`- ${s}`,hu=s=>j.isFunction(s)||s===null||s===!1,Xa={getAdapter:s=>{s=j.isArray(s)?s:[s];const{length:e}=s;let t,r;const o={};for(let a=0;a<e;a++){t=s[a];let u;if(r=t,!hu(t)&&(r=Ws[(u=String(t)).toLowerCase()],r===void 0))throw new fe(`Unknown adapter '${u}'`);if(r)break;o[u||"#"+a]=r}if(!r){const a=Object.entries(o).map(([d,p])=>`adapter ${d} `+(p===!1?"is not supported by the environment":"is not available in the build"));let u=e?a.length>1?`since :
`+a.map(ra).join(`
`):" "+ra(a[0]):"as no adapter specified";throw new fe("There is no suitable adapter to dispatch the request "+u,"ERR_NOT_SUPPORT")}return r},adapters:Ws};function Us(s){if(s.cancelToken&&s.cancelToken.throwIfRequested(),s.signal&&s.signal.aborted)throw new dn(null,s)}function na(s){return Us(s),s.headers=It.from(s.headers),s.data=Ls.call(s,s.transformRequest),["post","put","patch"].indexOf(s.method)!==-1&&s.headers.setContentType("application/x-www-form-urlencoded",!1),Xa.getAdapter(s.adapter||ui.adapter)(s).then(function(r){return Us(s),r.data=Ls.call(s,s.transformResponse,r),r.headers=It.from(r.headers),r},function(r){return Ga(r)||(Us(s),r&&r.response&&(r.response.data=Ls.call(s,s.transformResponse,r.response),r.response.headers=It.from(r.response.headers))),Promise.reject(r)})}const sa=s=>s instanceof It?s.toJSON():s;function $r(s,e){e=e||{};const t={};function r(g,y,w){return j.isPlainObject(g)&&j.isPlainObject(y)?j.merge.call({caseless:w},g,y):j.isPlainObject(y)?j.merge({},y):j.isArray(y)?y.slice():y}function o(g,y,w){if(j.isUndefined(y)){if(!j.isUndefined(g))return r(void 0,g,w)}else return r(g,y,w)}function a(g,y){if(!j.isUndefined(y))return r(void 0,y)}function u(g,y){if(j.isUndefined(y)){if(!j.isUndefined(g))return r(void 0,g)}else return r(void 0,y)}function d(g,y,w){if(w in e)return r(g,y);if(w in s)return r(void 0,g)}const p={url:a,method:a,data:a,baseURL:u,transformRequest:u,transformResponse:u,paramsSerializer:u,timeout:u,timeoutMessage:u,withCredentials:u,withXSRFToken:u,adapter:u,responseType:u,xsrfCookieName:u,xsrfHeaderName:u,onUploadProgress:u,onDownloadProgress:u,decompress:u,maxContentLength:u,maxBodyLength:u,beforeRedirect:u,transport:u,httpAgent:u,httpsAgent:u,cancelToken:u,socketPath:u,responseEncoding:u,validateStatus:d,headers:(g,y)=>o(sa(g),sa(y),!0)};return j.forEach(Object.keys(Object.assign({},s,e)),function(y){const w=p[y]||o,D=w(s[y],e[y],y);j.isUndefined(D)&&w!==d||(t[y]=D)}),t}const Qa="1.6.7",li={};["object","boolean","number","function","string","symbol"].forEach((s,e)=>{li[s]=function(r){return typeof r===s||"a"+(e<1?"n ":" ")+s}});const ia={};li.transitional=function(e,t,r){function o(a,u){return"[Axios v"+Qa+"] Transitional option '"+a+"'"+u+(r?". "+r:"")}return(a,u,d)=>{if(e===!1)throw new fe(o(u," has been removed"+(t?" in "+t:"")),fe.ERR_DEPRECATED);return t&&!ia[u]&&(ia[u]=!0,console.warn(o(u," has been deprecated since v"+t+" and will be removed in the near future"))),e?e(a,u,d):!0}};function du(s,e,t){if(typeof s!="object")throw new fe("options must be an object",fe.ERR_BAD_OPTION_VALUE);const r=Object.keys(s);let o=r.length;for(;o-- >0;){const a=r[o],u=e[a];if(u){const d=s[a],p=d===void 0||u(d,a,s);if(p!==!0)throw new fe("option "+a+" must be "+p,fe.ERR_BAD_OPTION_VALUE);continue}if(t!==!0)throw new fe("Unknown option "+a,fe.ERR_BAD_OPTION)}}const Gs={assertOptions:du,validators:li},Jt=Gs.validators;class Jn{constructor(e){this.defaults=e,this.interceptors={request:new Zi,response:new Zi}}async request(e,t){try{return await this._request(e,t)}catch(r){if(r instanceof Error){let o;Error.captureStackTrace?Error.captureStackTrace(o={}):o=new Error;const a=o.stack?o.stack.replace(/^.+\n/,""):"";r.stack?a&&!String(r.stack).endsWith(a.replace(/^.+\n.+\n/,""))&&(r.stack+=`
`+a):r.stack=a}throw r}}_request(e,t){typeof e=="string"?(t=t||{},t.url=e):t=e||{},t=$r(this.defaults,t);const{transitional:r,paramsSerializer:o,headers:a}=t;r!==void 0&&Gs.assertOptions(r,{silentJSONParsing:Jt.transitional(Jt.boolean),forcedJSONParsing:Jt.transitional(Jt.boolean),clarifyTimeoutError:Jt.transitional(Jt.boolean)},!1),o!=null&&(j.isFunction(o)?t.paramsSerializer={serialize:o}:Gs.assertOptions(o,{encode:Jt.function,serialize:Jt.function},!0)),t.method=(t.method||this.defaults.method||"get").toLowerCase();let u=a&&j.merge(a.common,a[t.method]);a&&j.forEach(["delete","get","head","post","put","patch","common"],$=>{delete a[$]}),t.headers=It.concat(u,a);const d=[];let p=!0;this.interceptors.request.forEach(function(L){typeof L.runWhen=="function"&&L.runWhen(t)===!1||(p=p&&L.synchronous,d.unshift(L.fulfilled,L.rejected))});const g=[];this.interceptors.response.forEach(function(L){g.push(L.fulfilled,L.rejected)});let y,w=0,D;if(!p){const $=[na.bind(this),void 0];for($.unshift.apply($,d),$.push.apply($,g),D=$.length,y=Promise.resolve(t);w<D;)y=y.then($[w++],$[w++]);return y}D=d.length;let F=t;for(w=0;w<D;){const $=d[w++],L=d[w++];try{F=$(F)}catch(V){L.call(this,V);break}}try{y=na.call(this,F)}catch($){return Promise.reject($)}for(w=0,D=g.length;w<D;)y=y.then(g[w++],g[w++]);return y}getUri(e){e=$r(this.defaults,e);const t=Ya(e.baseURL,e.url);return Ha(t,e.params,e.paramsSerializer)}}j.forEach(["delete","get","head","options"],function(e){Jn.prototype[e]=function(t,r){return this.request($r(r||{},{method:e,url:t,data:(r||{}).data}))}});j.forEach(["post","put","patch"],function(e){function t(r){return function(a,u,d){return this.request($r(d||{},{method:e,headers:r?{"Content-Type":"multipart/form-data"}:{},url:a,data:u}))}}Jn.prototype[e]=t(),Jn.prototype[e+"Form"]=t(!0)});const Kn=Jn;class hi{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let t;this.promise=new Promise(function(a){t=a});const r=this;this.promise.then(o=>{if(!r._listeners)return;let a=r._listeners.length;for(;a-- >0;)r._listeners[a](o);r._listeners=null}),this.promise.then=o=>{let a;const u=new Promise(d=>{r.subscribe(d),a=d}).then(o);return u.cancel=function(){r.unsubscribe(a)},u},e(function(a,u,d){r.reason||(r.reason=new dn(a,u,d),t(r.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);t!==-1&&this._listeners.splice(t,1)}static source(){let e;return{token:new hi(function(o){e=o}),cancel:e}}}const fu=hi;function pu(s){return function(t){return s.apply(null,t)}}function mu(s){return j.isObject(s)&&s.isAxiosError===!0}const Ys={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(Ys).forEach(([s,e])=>{Ys[e]=s});const yu=Ys;function Za(s){const e=new Kn(s),t=ja(Kn.prototype.request,e);return j.extend(t,Kn.prototype,e,{allOwnKeys:!0}),j.extend(t,e,null,{allOwnKeys:!0}),t.create=function(o){return Za($r(s,o))},t}const ve=Za(ui);ve.Axios=Kn;ve.CanceledError=dn;ve.CancelToken=fu;ve.isCancel=Ga;ve.VERSION=Qa;ve.toFormData=es;ve.AxiosError=fe;ve.Cancel=ve.CanceledError;ve.all=function(e){return Promise.all(e)};ve.spread=pu;ve.isAxiosError=mu;ve.mergeConfig=$r;ve.AxiosHeaders=It;ve.formToJSON=s=>Wa(j.isHTMLForm(s)?new FormData(s):s);ve.getAdapter=Xa.getAdapter;ve.HttpStatusCode=yu;ve.default=ve;const jr="0123456789ABCDEFGHJKMNPQRSTVWXYZ";function gu(s,e,t){for(;s.length<e;)s=t+s;return s}function vu(){const s=Math.floor(Math.random()*jr.length);return jr.charAt(s)}function bu(s){let e="";for(let t=0;t<s;t++)e+=vu();return e}function wu(s,e){let t="";for(let r=e-1;r>=0;r--){const o=s%jr.length;t=jr.charAt(o)+t,s=Math.floor(s/jr.length)}return gu(t,e,jr[0])}function aa(){const s=Date.now(),e=wu(s,10),t=bu(16),r=e+t;return{toString:()=>r,valueOf:()=>r}}const _u={id:"",title:"",description:"",journals:[],isComplete:!1,reward:""},ku={backpack:[],equipment:{head:null,body:null,legs:null,feet:null,hands:null,weapon:null,shield:null,accessory:null}},eo={},Eu={inCombat:!1,isDead:!1,isResting:!1,activeBoosts:{}},Su={username:"Guest",health:"100",mana:"100",energy:"100",maxHealth:"100",maxMana:"100",maxEnergy:"100",armour:"0",agility:"0",strength:"0",intelligence:"0",experience:"0",reputation:"0",faith:"0"},xu={stats:Su,inventory:ku,state:Eu},Pu={tooltipItem:{id:null,position:{x:0,y:0}},submenuItem:{id:null,position:{x:0,y:0}},tooltipNPC:{id:null,position:{x:0,y:0}},isStatsMenuCollapsed:!1,isSettingsMenuCollapsed:!1,debugMode:!1,textSpeed:40},Ou={gamemode:"Idle",action:{type:"ROLL_DICE",diceValues:[],isRolling:!1},textures:{side1:"",side2:"",side3:"",side4:"",side5:"",side6:""}};function mr(s,e){return Aa(s,e,{encode(t){return JSON.stringify(t)},decode(t){try{return JSON.parse(t)}catch{return e}}})}mr("playerData",xu);mr("quest",_u);mr("items",eo);mr("notifications",[]);mr("itemDB",eo);const Xs=mr("settings",Pu);mr("minigameState",Ou);const Cu=s=>Xs.get()[s],to=(s,e)=>{Qo(async()=>{const t=Xs.get();Xs.set({...t,[s]:e})})},Tu=()=>{to("debugMode",!0)},Au=()=>{to("debugMode",!1)},rs=()=>Cu("debugMode"),Vn=s=>typeof s=="string"?s:JSON.stringify(s,null,2),Ru=s=>{rs()&&console.log(`[DEBUG] ${Vn(s)}`)},Iu=s=>{rs()&&console.warn(`[DEBUG] ${Vn(s)}`)},ju=(s,e)=>{rs()&&(e instanceof Error?console.error(`[DEBUG] ${Vn(s)} - Error: ${e.message}
${e.stack}`):console.error(`[DEBUG] ${Vn(s)}`))},H={enable:Tu,disable:Au,isEnabled:rs,log:Ru,warn:Iu,error:ju};class Du{constructor(){this.events={},this.lastEmitted=new Map}on(e,t){this.events[e]||(this.events[e]=[]),this.events[e]?.push(t)}off(e,t){this.events[e]&&(this.events[e]=this.events[e]?.filter(r=>r!==t))}emit(e,t,r=0,o){const a=Date.now(),u=this.lastEmitted.get(e)||0;if(a-u>=r){if(!this.events[e])return;this.events[e]?.forEach(d=>d(t)),o&&H.isEnabled()&&H.log(`Event: ${String(e)} - Message: ${o}`),H.isEnabled()&&H.log(`Event Data: ${String(e)} - Data: ${t?JSON.stringify(t):"No data"}`),this.lastEmitted.set(e,a)}}}const fr=new Du,Nu=s=>{let e;return s?e=s:typeof fetch>"u"?e=(...t)=>Nr(()=>Promise.resolve().then(()=>fn),void 0).then(({default:r})=>r(...t)):e=fetch,(...t)=>e(...t)};class di extends Error{constructor(e,t="FunctionsError",r){super(e),this.name=t,this.context=r}}class $u extends di{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class Lu extends di{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class Uu extends di{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var Qs;(function(s){s.Any="any",s.ApNortheast1="ap-northeast-1",s.ApNortheast2="ap-northeast-2",s.ApSouth1="ap-south-1",s.ApSoutheast1="ap-southeast-1",s.ApSoutheast2="ap-southeast-2",s.CaCentral1="ca-central-1",s.EuCentral1="eu-central-1",s.EuWest1="eu-west-1",s.EuWest2="eu-west-2",s.EuWest3="eu-west-3",s.SaEast1="sa-east-1",s.UsEast1="us-east-1",s.UsWest1="us-west-1",s.UsWest2="us-west-2"})(Qs||(Qs={}));var Fu=function(s,e,t,r){function o(a){return a instanceof t?a:new t(function(u){u(a)})}return new(t||(t=Promise))(function(a,u){function d(y){try{g(r.next(y))}catch(w){u(w)}}function p(y){try{g(r.throw(y))}catch(w){u(w)}}function g(y){y.done?a(y.value):o(y.value).then(d,p)}g((r=r.apply(s,e||[])).next())})};class Bu{constructor(e,{headers:t={},customFetch:r,region:o=Qs.Any}={}){this.url=e,this.headers=t,this.region=o,this.fetch=Nu(r)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,t={}){var r;return Fu(this,void 0,void 0,function*(){try{const{headers:o,method:a,body:u}=t;let d={},{region:p}=t;p||(p=this.region),p&&p!=="any"&&(d["x-region"]=p);let g;u&&(o&&!Object.prototype.hasOwnProperty.call(o,"Content-Type")||!o)&&(typeof Blob<"u"&&u instanceof Blob||u instanceof ArrayBuffer?(d["Content-Type"]="application/octet-stream",g=u):typeof u=="string"?(d["Content-Type"]="text/plain",g=u):typeof FormData<"u"&&u instanceof FormData?g=u:(d["Content-Type"]="application/json",g=JSON.stringify(u)));const y=yield this.fetch(`${this.url}/${e}`,{method:a||"POST",headers:Object.assign(Object.assign(Object.assign({},d),this.headers),o),body:g}).catch($=>{throw new $u($)}),w=y.headers.get("x-relay-error");if(w&&w==="true")throw new Lu(y);if(!y.ok)throw new Uu(y);let D=((r=y.headers.get("Content-Type"))!==null&&r!==void 0?r:"text/plain").split(";")[0].trim(),F;return D==="application/json"?F=yield y.json():D==="application/octet-stream"?F=yield y.blob():D==="text/event-stream"?F=y:D==="multipart/form-data"?F=yield y.formData():F=yield y.text(),{data:F,error:null}}catch(o){return{data:null,error:o}}})}}var Mu=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},Lr=Mu();const qu=Lr.fetch,fi=Lr.fetch.bind(Lr),ro=Lr.Headers,Ku=Lr.Request,zu=Lr.Response,fn=Object.freeze(Object.defineProperty({__proto__:null,Headers:ro,Request:Ku,Response:zu,default:fi,fetch:qu},Symbol.toStringTag,{value:"Module"}));class Hu extends Error{constructor(e){super(e.message),this.name="PostgrestError",this.details=e.details,this.hint=e.hint,this.code=e.code}}class Ju{constructor(e){this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=e.headers,this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=e.shouldThrowOnError,this.signal=e.signal,this.isMaybeSingle=e.isMaybeSingle,e.fetch?this.fetch=e.fetch:typeof fetch>"u"?this.fetch=fi:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}then(e,t){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),this.method!=="GET"&&this.method!=="HEAD"&&(this.headers["Content-Type"]="application/json");const r=this.fetch;let o=r(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async a=>{var u,d,p;let g=null,y=null,w=null,D=a.status,F=a.statusText;if(a.ok){if(this.method!=="HEAD"){const Q=await a.text();Q===""||(this.headers.Accept==="text/csv"||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?y=Q:y=JSON.parse(Q))}const L=(u=this.headers.Prefer)===null||u===void 0?void 0:u.match(/count=(exact|planned|estimated)/),V=(d=a.headers.get("content-range"))===null||d===void 0?void 0:d.split("/");L&&V&&V.length>1&&(w=parseInt(V[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(y)&&(y.length>1?(g={code:"PGRST116",details:`Results contain ${y.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},y=null,w=null,D=406,F="Not Acceptable"):y.length===1?y=y[0]:y=null)}else{const L=await a.text();try{g=JSON.parse(L),Array.isArray(g)&&a.status===404&&(y=[],g=null,D=200,F="OK")}catch{a.status===404&&L===""?(D=204,F="No Content"):g={message:L}}if(g&&this.isMaybeSingle&&(!((p=g?.details)===null||p===void 0)&&p.includes("0 rows"))&&(g=null,D=200,F="OK"),g&&this.shouldThrowOnError)throw new Hu(g)}return{error:g,data:y,count:w,status:D,statusText:F}});return this.shouldThrowOnError||(o=o.catch(a=>{var u,d,p;return{error:{message:`${(u=a?.name)!==null&&u!==void 0?u:"FetchError"}: ${a?.message}`,details:`${(d=a?.stack)!==null&&d!==void 0?d:""}`,hint:"",code:`${(p=a?.code)!==null&&p!==void 0?p:""}`},data:null,count:null,status:0,statusText:""}})),o.then(e,t)}}class Vu extends Ju{select(e){let t=!1;const r=(e??"*").split("").map(o=>/\s/.test(o)&&!t?"":(o==='"'&&(t=!t),o)).join("");return this.url.searchParams.set("select",r),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(e,{ascending:t=!0,nullsFirst:r,foreignTable:o,referencedTable:a=o}={}){const u=a?`${a}.order`:"order",d=this.url.searchParams.get(u);return this.url.searchParams.set(u,`${d?`${d},`:""}${e}.${t?"asc":"desc"}${r===void 0?"":r?".nullsfirst":".nullslast"}`),this}limit(e,{foreignTable:t,referencedTable:r=t}={}){const o=typeof r>"u"?"limit":`${r}.limit`;return this.url.searchParams.set(o,`${e}`),this}range(e,t,{foreignTable:r,referencedTable:o=r}={}){const a=typeof o>"u"?"offset":`${o}.offset`,u=typeof o>"u"?"limit":`${o}.limit`;return this.url.searchParams.set(a,`${e}`),this.url.searchParams.set(u,`${t-e+1}`),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return this.method==="GET"?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:e=!1,verbose:t=!1,settings:r=!1,buffers:o=!1,wal:a=!1,format:u="text"}={}){var d;const p=[e?"analyze":null,t?"verbose":null,r?"settings":null,o?"buffers":null,a?"wal":null].filter(Boolean).join("|"),g=(d=this.headers.Accept)!==null&&d!==void 0?d:"application/json";return this.headers.Accept=`application/vnd.pgrst.plan+${u}; for="${g}"; options=${p};`,u==="json"?this:this}rollback(){var e;return((e=this.headers.Prefer)!==null&&e!==void 0?e:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}}class Ir extends Vu{eq(e,t){return this.url.searchParams.append(e,`eq.${t}`),this}neq(e,t){return this.url.searchParams.append(e,`neq.${t}`),this}gt(e,t){return this.url.searchParams.append(e,`gt.${t}`),this}gte(e,t){return this.url.searchParams.append(e,`gte.${t}`),this}lt(e,t){return this.url.searchParams.append(e,`lt.${t}`),this}lte(e,t){return this.url.searchParams.append(e,`lte.${t}`),this}like(e,t){return this.url.searchParams.append(e,`like.${t}`),this}likeAllOf(e,t){return this.url.searchParams.append(e,`like(all).{${t.join(",")}}`),this}likeAnyOf(e,t){return this.url.searchParams.append(e,`like(any).{${t.join(",")}}`),this}ilike(e,t){return this.url.searchParams.append(e,`ilike.${t}`),this}ilikeAllOf(e,t){return this.url.searchParams.append(e,`ilike(all).{${t.join(",")}}`),this}ilikeAnyOf(e,t){return this.url.searchParams.append(e,`ilike(any).{${t.join(",")}}`),this}is(e,t){return this.url.searchParams.append(e,`is.${t}`),this}in(e,t){const r=Array.from(new Set(t)).map(o=>typeof o=="string"&&new RegExp("[,()]").test(o)?`"${o}"`:`${o}`).join(",");return this.url.searchParams.append(e,`in.(${r})`),this}contains(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cs.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cs.{${t.join(",")}}`):this.url.searchParams.append(e,`cs.${JSON.stringify(t)}`),this}containedBy(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cd.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cd.{${t.join(",")}}`):this.url.searchParams.append(e,`cd.${JSON.stringify(t)}`),this}rangeGt(e,t){return this.url.searchParams.append(e,`sr.${t}`),this}rangeGte(e,t){return this.url.searchParams.append(e,`nxl.${t}`),this}rangeLt(e,t){return this.url.searchParams.append(e,`sl.${t}`),this}rangeLte(e,t){return this.url.searchParams.append(e,`nxr.${t}`),this}rangeAdjacent(e,t){return this.url.searchParams.append(e,`adj.${t}`),this}overlaps(e,t){return typeof t=="string"?this.url.searchParams.append(e,`ov.${t}`):this.url.searchParams.append(e,`ov.{${t.join(",")}}`),this}textSearch(e,t,{config:r,type:o}={}){let a="";o==="plain"?a="pl":o==="phrase"?a="ph":o==="websearch"&&(a="w");const u=r===void 0?"":`(${r})`;return this.url.searchParams.append(e,`${a}fts${u}.${t}`),this}match(e){return Object.entries(e).forEach(([t,r])=>{this.url.searchParams.append(t,`eq.${r}`)}),this}not(e,t,r){return this.url.searchParams.append(e,`not.${t}.${r}`),this}or(e,{foreignTable:t,referencedTable:r=t}={}){const o=r?`${r}.or`:"or";return this.url.searchParams.append(o,`(${e})`),this}filter(e,t,r){return this.url.searchParams.append(e,`${t}.${r}`),this}}class Wu{constructor(e,{headers:t={},schema:r,fetch:o}){this.url=e,this.headers=t,this.schema=r,this.fetch=o}select(e,{head:t=!1,count:r}={}){const o=t?"HEAD":"GET";let a=!1;const u=(e??"*").split("").map(d=>/\s/.test(d)&&!a?"":(d==='"'&&(a=!a),d)).join("");return this.url.searchParams.set("select",u),r&&(this.headers.Prefer=`count=${r}`),new Ir({method:o,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(e,{count:t,defaultToNull:r=!0}={}){const o="POST",a=[];if(this.headers.Prefer&&a.push(this.headers.Prefer),t&&a.push(`count=${t}`),r||a.push("missing=default"),this.headers.Prefer=a.join(","),Array.isArray(e)){const u=e.reduce((d,p)=>d.concat(Object.keys(p)),[]);if(u.length>0){const d=[...new Set(u)].map(p=>`"${p}"`);this.url.searchParams.set("columns",d.join(","))}}return new Ir({method:o,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}upsert(e,{onConflict:t,ignoreDuplicates:r=!1,count:o,defaultToNull:a=!0}={}){const u="POST",d=[`resolution=${r?"ignore":"merge"}-duplicates`];if(t!==void 0&&this.url.searchParams.set("on_conflict",t),this.headers.Prefer&&d.push(this.headers.Prefer),o&&d.push(`count=${o}`),a||d.push("missing=default"),this.headers.Prefer=d.join(","),Array.isArray(e)){const p=e.reduce((g,y)=>g.concat(Object.keys(y)),[]);if(p.length>0){const g=[...new Set(p)].map(y=>`"${y}"`);this.url.searchParams.set("columns",g.join(","))}}return new Ir({method:u,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}update(e,{count:t}={}){const r="PATCH",o=[];return this.headers.Prefer&&o.push(this.headers.Prefer),t&&o.push(`count=${t}`),this.headers.Prefer=o.join(","),new Ir({method:r,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}delete({count:e}={}){const t="DELETE",r=[];return e&&r.push(`count=${e}`),this.headers.Prefer&&r.unshift(this.headers.Prefer),this.headers.Prefer=r.join(","),new Ir({method:t,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}}const Gu="1.15.2",Yu={"X-Client-Info":`postgrest-js/${Gu}`};class pi{constructor(e,{headers:t={},schema:r,fetch:o}={}){this.url=e,this.headers=Object.assign(Object.assign({},Yu),t),this.schemaName=r,this.fetch=o}from(e){const t=new URL(`${this.url}/${e}`);return new Wu(t,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(e){return new pi(this.url,{headers:this.headers,schema:e,fetch:this.fetch})}rpc(e,t={},{head:r=!1,get:o=!1,count:a}={}){let u;const d=new URL(`${this.url}/rpc/${e}`);let p;r||o?(u=r?"HEAD":"GET",Object.entries(t).filter(([y,w])=>w!==void 0).map(([y,w])=>[y,Array.isArray(w)?`{${w.join(",")}}`:`${w}`]).forEach(([y,w])=>{d.searchParams.append(y,w)})):(u="POST",p=t);const g=Object.assign({},this.headers);return a&&(g.Prefer=`count=${a}`),new Ir({method:u,url:d,headers:g,schema:this.schemaName,body:p,fetch:this.fetch,allowEmpty:!1})}}const Xu="2.9.4",Qu={"X-Client-Info":`realtime-js/${Xu}`},Zu="1.0.0",no=1e4,el=1e3;var Dr;(function(s){s[s.connecting=0]="connecting",s[s.open=1]="open",s[s.closing=2]="closing",s[s.closed=3]="closed"})(Dr||(Dr={}));var tt;(function(s){s.closed="closed",s.errored="errored",s.joined="joined",s.joining="joining",s.leaving="leaving"})(tt||(tt={}));var dt;(function(s){s.close="phx_close",s.error="phx_error",s.join="phx_join",s.reply="phx_reply",s.leave="phx_leave",s.access_token="access_token"})(dt||(dt={}));var Zs;(function(s){s.websocket="websocket"})(Zs||(Zs={}));var pr;(function(s){s.Connecting="connecting",s.Open="open",s.Closing="closing",s.Closed="closed"})(pr||(pr={}));class so{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}class tl{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t(typeof e=="string"?JSON.parse(e):{})}_binaryDecode(e){const t=new DataView(e),r=new TextDecoder;return this._decodeBroadcast(e,t,r)}_decodeBroadcast(e,t,r){const o=t.getUint8(1),a=t.getUint8(2);let u=this.HEADER_LENGTH+2;const d=r.decode(e.slice(u,u+o));u=u+o;const p=r.decode(e.slice(u,u+a));u=u+a;const g=JSON.parse(r.decode(e.slice(u,e.byteLength)));return{ref:null,topic:d,event:p,payload:g}}}class Fs{constructor(e,t,r={},o=no){this.channel=e,this.event=t,this.payload=r,this.timeout=o,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var r;return this._hasReceived(e)&&t((r=this.receivedResp)===null||r===void 0?void 0:r.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=t=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=t,this._matchReceive(t)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(r=>r.status===e).forEach(r=>r.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var oa;(function(s){s.SYNC="sync",s.JOIN="join",s.LEAVE="leave"})(oa||(oa={}));class an{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const r=t?.events||{state:"presence_state",diff:"presence_diff"};this.channel._on(r.state,{},o=>{const{onJoin:a,onLeave:u,onSync:d}=this.caller;this.joinRef=this.channel._joinRef(),this.state=an.syncState(this.state,o,a,u),this.pendingDiffs.forEach(p=>{this.state=an.syncDiff(this.state,p,a,u)}),this.pendingDiffs=[],d()}),this.channel._on(r.diff,{},o=>{const{onJoin:a,onLeave:u,onSync:d}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(o):(this.state=an.syncDiff(this.state,o,a,u),d())}),this.onJoin((o,a,u)=>{this.channel._trigger("presence",{event:"join",key:o,currentPresences:a,newPresences:u})}),this.onLeave((o,a,u)=>{this.channel._trigger("presence",{event:"leave",key:o,currentPresences:a,leftPresences:u})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,r,o){const a=this.cloneDeep(e),u=this.transformState(t),d={},p={};return this.map(a,(g,y)=>{u[g]||(p[g]=y)}),this.map(u,(g,y)=>{const w=a[g];if(w){const D=y.map(V=>V.presence_ref),F=w.map(V=>V.presence_ref),$=y.filter(V=>F.indexOf(V.presence_ref)<0),L=w.filter(V=>D.indexOf(V.presence_ref)<0);$.length>0&&(d[g]=$),L.length>0&&(p[g]=L)}else d[g]=y}),this.syncDiff(a,{joins:d,leaves:p},r,o)}static syncDiff(e,t,r,o){const{joins:a,leaves:u}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return r||(r=()=>{}),o||(o=()=>{}),this.map(a,(d,p)=>{var g;const y=(g=e[d])!==null&&g!==void 0?g:[];if(e[d]=this.cloneDeep(p),y.length>0){const w=e[d].map(F=>F.presence_ref),D=y.filter(F=>w.indexOf(F.presence_ref)<0);e[d].unshift(...D)}r(d,y,p)}),this.map(u,(d,p)=>{let g=e[d];if(!g)return;const y=p.map(w=>w.presence_ref);g=g.filter(w=>y.indexOf(w.presence_ref)<0),e[d]=g,o(d,g,p),g.length===0&&delete e[d]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(r=>t(r,e[r]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,r)=>{const o=e[r];return"metas"in o?t[r]=o.metas.map(a=>(a.presence_ref=a.phx_ref,delete a.phx_ref,delete a.phx_ref_prev,a)):t[r]=o,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var _e;(function(s){s.abstime="abstime",s.bool="bool",s.date="date",s.daterange="daterange",s.float4="float4",s.float8="float8",s.int2="int2",s.int4="int4",s.int4range="int4range",s.int8="int8",s.int8range="int8range",s.json="json",s.jsonb="jsonb",s.money="money",s.numeric="numeric",s.oid="oid",s.reltime="reltime",s.text="text",s.time="time",s.timestamp="timestamp",s.timestamptz="timestamptz",s.timetz="timetz",s.tsrange="tsrange",s.tstzrange="tstzrange"})(_e||(_e={}));const ca=(s,e,t={})=>{var r;const o=(r=t.skipTypes)!==null&&r!==void 0?r:[];return Object.keys(e).reduce((a,u)=>(a[u]=rl(u,s,e,o),a),{})},rl=(s,e,t,r)=>{const o=e.find(d=>d.name===s),a=o?.type,u=t[s];return a&&!r.includes(a)?io(a,u):ei(u)},io=(s,e)=>{if(s.charAt(0)==="_"){const t=s.slice(1,s.length);return al(e,t)}switch(s){case _e.bool:return nl(e);case _e.float4:case _e.float8:case _e.int2:case _e.int4:case _e.int8:case _e.numeric:case _e.oid:return sl(e);case _e.json:case _e.jsonb:return il(e);case _e.timestamp:return ol(e);case _e.abstime:case _e.date:case _e.daterange:case _e.int4range:case _e.int8range:case _e.money:case _e.reltime:case _e.text:case _e.time:case _e.timestamptz:case _e.timetz:case _e.tsrange:case _e.tstzrange:return ei(e);default:return ei(e)}},ei=s=>s,nl=s=>{switch(s){case"t":return!0;case"f":return!1;default:return s}},sl=s=>{if(typeof s=="string"){const e=parseFloat(s);if(!Number.isNaN(e))return e}return s},il=s=>{if(typeof s=="string")try{return JSON.parse(s)}catch(e){return console.log(`JSON parse error: ${e}`),s}return s},al=(s,e)=>{if(typeof s!="string")return s;const t=s.length-1,r=s[t];if(s[0]==="{"&&r==="}"){let a;const u=s.slice(1,t);try{a=JSON.parse("["+u+"]")}catch{a=u?u.split(","):[]}return a.map(d=>io(e,d))}return s},ol=s=>typeof s=="string"?s.replace(" ","T"):s;var ua;(function(s){s.ALL="*",s.INSERT="INSERT",s.UPDATE="UPDATE",s.DELETE="DELETE"})(ua||(ua={}));var la;(function(s){s.BROADCAST="broadcast",s.PRESENCE="presence",s.POSTGRES_CHANGES="postgres_changes"})(la||(la={}));var ha;(function(s){s.SUBSCRIBED="SUBSCRIBED",s.TIMED_OUT="TIMED_OUT",s.CLOSED="CLOSED",s.CHANNEL_ERROR="CHANNEL_ERROR"})(ha||(ha={}));class mi{constructor(e,t={config:{}},r){this.topic=e,this.params=t,this.socket=r,this.bindings={},this.state=tt.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""}},t.config),this.timeout=this.socket.timeout,this.joinPush=new Fs(this,dt.join,this.params,this.timeout),this.rejoinTimer=new so(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=tt.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(o=>o.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=tt.closed,this.socket._remove(this)}),this._onError(o=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,o),this.state=tt.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=tt.errored,this.rejoinTimer.scheduleTimeout())}),this._on(dt.reply,{},(o,a)=>{this._trigger(this._replyEventName(a),o)}),this.presence=new an(this),this.broadcastEndpointURL=this._broadcastEndpointURL()}subscribe(e,t=this.timeout){var r,o;if(this.socket.isConnected()||this.socket.connect(),this.joinedOnce)throw"tried to subscribe multiple times. 'subscribe' can only be called a single time per channel instance";{const{config:{broadcast:a,presence:u}}=this.params;this._onError(g=>e&&e("CHANNEL_ERROR",g)),this._onClose(()=>e&&e("CLOSED"));const d={},p={broadcast:a,presence:u,postgres_changes:(o=(r=this.bindings.postgres_changes)===null||r===void 0?void 0:r.map(g=>g.filter))!==null&&o!==void 0?o:[]};this.socket.accessToken&&(d.access_token=this.socket.accessToken),this.updateJoinPayload(Object.assign({config:p},d)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",({postgres_changes:g})=>{var y;if(this.socket.accessToken&&this.socket.setAuth(this.socket.accessToken),g===void 0){e&&e("SUBSCRIBED");return}else{const w=this.bindings.postgres_changes,D=(y=w?.length)!==null&&y!==void 0?y:0,F=[];for(let $=0;$<D;$++){const L=w[$],{filter:{event:V,schema:Q,table:le,filter:he}}=L,X=g&&g[$];if(X&&X.event===V&&X.schema===Q&&X.table===le&&X.filter===he)F.push(Object.assign(Object.assign({},L),{id:X.id}));else{this.unsubscribe(),e&&e("CHANNEL_ERROR",new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=F,e&&e("SUBSCRIBED");return}}).receive("error",g=>{e&&e("CHANNEL_ERROR",new Error(JSON.stringify(Object.values(g).join(", ")||"error")))}).receive("timeout",()=>{e&&e("TIMED_OUT")})}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,r){return this._on(e,t,r)}async send(e,t={}){var r,o;if(!this._canPush()&&e.type==="broadcast"){const{event:a,payload:u}=e,d={method:"POST",headers:{apikey:(r=this.socket.apiKey)!==null&&r!==void 0?r:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:a,payload:u}]})};try{return(await this._fetchWithTimeout(this.broadcastEndpointURL,d,(o=t.timeout)!==null&&o!==void 0?o:this.timeout)).ok?"ok":"error"}catch(p){return p.name==="AbortError"?"timed out":"error"}}else return new Promise(a=>{var u,d,p;const g=this._push(e.type,e,t.timeout||this.timeout);e.type==="broadcast"&&!(!((p=(d=(u=this.params)===null||u===void 0?void 0:u.config)===null||d===void 0?void 0:d.broadcast)===null||p===void 0)&&p.ack)&&a("ok"),g.receive("ok",()=>a("ok")),g.receive("error",()=>a("error")),g.receive("timeout",()=>a("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=tt.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(dt.close,"leave",this._joinRef())};return this.rejoinTimer.reset(),this.joinPush.destroy(),new Promise(r=>{const o=new Fs(this,dt.leave,{},e);o.receive("ok",()=>{t(),r("ok")}).receive("timeout",()=>{t(),r("timed out")}).receive("error",()=>{r("error")}),o.send(),this._canPush()||o.trigger("ok",{})})}_broadcastEndpointURL(){let e=this.socket.endPoint;return e=e.replace(/^ws/i,"http"),e=e.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),e.replace(/\/+$/,"")+"/api/broadcast"}async _fetchWithTimeout(e,t,r){const o=new AbortController,a=setTimeout(()=>o.abort(),r),u=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:o.signal}));return clearTimeout(a),u}_push(e,t,r=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let o=new Fs(this,e,t,r);return this._canPush()?o.send():(o.startTimeout(),this.pushBuffer.push(o)),o}_onMessage(e,t,r){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,r){var o,a;const u=e.toLocaleLowerCase(),{close:d,error:p,leave:g,join:y}=dt;if(r&&[d,p,g,y].indexOf(u)>=0&&r!==this._joinRef())return;let D=this._onMessage(u,t,r);if(t&&!D)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(u)?(o=this.bindings.postgres_changes)===null||o===void 0||o.filter(F=>{var $,L,V;return(($=F.filter)===null||$===void 0?void 0:$.event)==="*"||((V=(L=F.filter)===null||L===void 0?void 0:L.event)===null||V===void 0?void 0:V.toLocaleLowerCase())===u}).map(F=>F.callback(D,r)):(a=this.bindings[u])===null||a===void 0||a.filter(F=>{var $,L,V,Q,le,he;if(["broadcast","presence","postgres_changes"].includes(u))if("id"in F){const X=F.id,Xe=($=F.filter)===null||$===void 0?void 0:$.event;return X&&((L=t.ids)===null||L===void 0?void 0:L.includes(X))&&(Xe==="*"||Xe?.toLocaleLowerCase()===((V=t.data)===null||V===void 0?void 0:V.type.toLocaleLowerCase()))}else{const X=(le=(Q=F?.filter)===null||Q===void 0?void 0:Q.event)===null||le===void 0?void 0:le.toLocaleLowerCase();return X==="*"||X===((he=t?.event)===null||he===void 0?void 0:he.toLocaleLowerCase())}else return F.type.toLocaleLowerCase()===u}).map(F=>{if(typeof D=="object"&&"ids"in D){const $=D.data,{schema:L,table:V,commit_timestamp:Q,type:le,errors:he}=$;D=Object.assign(Object.assign({},{schema:L,table:V,commit_timestamp:Q,eventType:le,new:{},old:{},errors:he}),this._getPayloadRecords($))}F.callback(D,r)})}_isClosed(){return this.state===tt.closed}_isJoined(){return this.state===tt.joined}_isJoining(){return this.state===tt.joining}_isLeaving(){return this.state===tt.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,r){const o=e.toLocaleLowerCase(),a={type:o,filter:t,callback:r};return this.bindings[o]?this.bindings[o].push(a):this.bindings[o]=[a],this}_off(e,t){const r=e.toLocaleLowerCase();return this.bindings[r]=this.bindings[r].filter(o=>{var a;return!(((a=o.type)===null||a===void 0?void 0:a.toLocaleLowerCase())===r&&mi.isEqual(o.filter,t))}),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const r in e)if(e[r]!==t[r])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(dt.close,{},e)}_onError(e){this._on(dt.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=tt.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(t.new=ca(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(t.old=ca(e.columns,e.old_record)),t}}const cl=()=>{},ul=typeof WebSocket<"u";class ll{constructor(e,t){var r;this.accessToken=null,this.apiKey=null,this.channels=[],this.endPoint="",this.headers=Qu,this.params={},this.timeout=no,this.heartbeatIntervalMs=3e4,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.ref=0,this.logger=cl,this.conn=null,this.sendBuffer=[],this.serializer=new tl,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this._resolveFetch=a=>{let u;return a?u=a:typeof fetch>"u"?u=(...d)=>Nr(()=>Promise.resolve().then(()=>fn),void 0).then(({default:p})=>p(...d)):u=fetch,(...d)=>u(...d)},this.endPoint=`${e}/${Zs.websocket}`,t?.transport?this.transport=t.transport:this.transport=null,t?.params&&(this.params=t.params),t?.headers&&(this.headers=Object.assign(Object.assign({},this.headers),t.headers)),t?.timeout&&(this.timeout=t.timeout),t?.logger&&(this.logger=t.logger),t?.heartbeatIntervalMs&&(this.heartbeatIntervalMs=t.heartbeatIntervalMs);const o=(r=t?.params)===null||r===void 0?void 0:r.apikey;o&&(this.accessToken=o,this.apiKey=o),this.reconnectAfterMs=t?.reconnectAfterMs?t.reconnectAfterMs:a=>[1e3,2e3,5e3,1e4][a-1]||1e4,this.encode=t?.encode?t.encode:(a,u)=>u(JSON.stringify(a)),this.decode=t?.decode?t.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new so(async()=>{this.disconnect(),this.connect()},this.reconnectAfterMs),this.fetch=this._resolveFetch(t?.fetch)}connect(){if(!this.conn){if(this.transport){this.conn=new this.transport(this._endPointURL(),void 0,{headers:this.headers});return}if(ul){this.conn=new WebSocket(this._endPointURL()),this.setupConnection();return}this.conn=new hl(this._endPointURL(),void 0,{close:()=>{this.conn=null}}),Nr(()=>import("./browser.NOQ3X0A0.js").then(e=>e.b),__vite__mapDeps([0,1])).then(({default:e})=>{this.conn=new e(this._endPointURL(),void 0,{headers:this.headers}),this.setupConnection()})}}disconnect(e,t){this.conn&&(this.conn.onclose=function(){},e?this.conn.close(e,t??""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset())}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map(t=>t.unsubscribe()));return this.disconnect(),e}log(e,t,r){this.logger(e,t,r)}connectionState(){switch(this.conn&&this.conn.readyState){case Dr.connecting:return pr.Connecting;case Dr.open:return pr.Open;case Dr.closing:return pr.Closing;default:return pr.Closed}}isConnected(){return this.connectionState()===pr.Open}channel(e,t={config:{}}){const r=new mi(`realtime:${e}`,t,this);return this.channels.push(r),r}push(e){const{topic:t,event:r,payload:o,ref:a}=e,u=()=>{this.encode(e,d=>{var p;(p=this.conn)===null||p===void 0||p.send(d)})};this.log("push",`${t} ${r} (${a})`,o),this.isConnected()?u():this.sendBuffer.push(u)}setAuth(e){this.accessToken=e,this.channels.forEach(t=>{e&&t.updateJoinPayload({access_token:e}),t.joinedOnce&&t._isJoined()&&t._push(dt.access_token,{access_token:e})})}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(r=>r.topic===e&&(r._isJoined()||r._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t._joinRef()!==e._joinRef())}setupConnection(){this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_endPointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:Zu}))}_onConnMessage(e){this.decode(e.data,t=>{let{topic:r,event:o,payload:a,ref:u}=t;(u&&u===this.pendingHeartbeatRef||o===a?.type)&&(this.pendingHeartbeatRef=null),this.log("receive",`${a.status||""} ${r} ${o} ${u&&"("+u+")"||""}`,a),this.channels.filter(d=>d._isMember(r)).forEach(d=>d._trigger(o,a,u)),this.stateChangeCallbacks.message.forEach(d=>d(t))})}_onConnOpen(){this.log("transport",`connected to ${this._endPointURL()}`),this._flushSendBuffer(),this.reconnectTimer.reset(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this._sendHeartbeat(),this.heartbeatIntervalMs),this.stateChangeCallbacks.open.forEach(e=>e())}_onConnClose(e){this.log("transport","close",e),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(t=>t(e))}_onConnError(e){this.log("transport",e.message),this._triggerChanError(),this.stateChangeCallbacks.error.forEach(t=>t(e))}_triggerChanError(){this.channels.forEach(e=>e._trigger(dt.error))}_appendParams(e,t){if(Object.keys(t).length===0)return e;const r=e.match(/\?/)?"&":"?",o=new URLSearchParams(t);return`${e}${r}${o}`}_flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_sendHeartbeat(){var e;if(this.isConnected()){if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),(e=this.conn)===null||e===void 0||e.close(el,"hearbeat timeout");return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.setAuth(this.accessToken)}}}class hl{constructor(e,t,r){this.binaryType="arraybuffer",this.onclose=()=>{},this.onerror=()=>{},this.onmessage=()=>{},this.onopen=()=>{},this.readyState=Dr.connecting,this.send=()=>{},this.url=null,this.url=e,this.close=r.close}}class yi extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function ze(s){return typeof s=="object"&&s!==null&&"__isStorageError"in s}class dl extends yi{constructor(e,t){super(e),this.name="StorageApiError",this.status=t}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class da extends yi{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}var fl=function(s,e,t,r){function o(a){return a instanceof t?a:new t(function(u){u(a)})}return new(t||(t=Promise))(function(a,u){function d(y){try{g(r.next(y))}catch(w){u(w)}}function p(y){try{g(r.throw(y))}catch(w){u(w)}}function g(y){y.done?a(y.value):o(y.value).then(d,p)}g((r=r.apply(s,e||[])).next())})};const ao=s=>{let e;return s?e=s:typeof fetch>"u"?e=(...t)=>Nr(()=>Promise.resolve().then(()=>fn),void 0).then(({default:r})=>r(...t)):e=fetch,(...t)=>e(...t)},pl=()=>fl(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield Nr(()=>Promise.resolve().then(()=>fn),void 0)).Response:Response});var Fr=function(s,e,t,r){function o(a){return a instanceof t?a:new t(function(u){u(a)})}return new(t||(t=Promise))(function(a,u){function d(y){try{g(r.next(y))}catch(w){u(w)}}function p(y){try{g(r.throw(y))}catch(w){u(w)}}function g(y){y.done?a(y.value):o(y.value).then(d,p)}g((r=r.apply(s,e||[])).next())})};const Bs=s=>s.msg||s.message||s.error_description||s.error||JSON.stringify(s),ml=(s,e)=>Fr(void 0,void 0,void 0,function*(){const t=yield pl();s instanceof t?s.json().then(r=>{e(new dl(Bs(r),s.status||500))}).catch(r=>{e(new da(Bs(r),r))}):e(new da(Bs(s),s))}),yl=(s,e,t,r)=>{const o={method:s,headers:e?.headers||{}};return s==="GET"?o:(o.headers=Object.assign({"Content-Type":"application/json"},e?.headers),o.body=JSON.stringify(r),Object.assign(Object.assign({},o),t))};function ns(s,e,t,r,o,a){return Fr(this,void 0,void 0,function*(){return new Promise((u,d)=>{s(t,yl(e,r,o,a)).then(p=>{if(!p.ok)throw p;return r?.noResolveJson?p:p.json()}).then(p=>u(p)).catch(p=>ml(p,d))})})}function ti(s,e,t,r){return Fr(this,void 0,void 0,function*(){return ns(s,"GET",e,t,r)})}function Wt(s,e,t,r,o){return Fr(this,void 0,void 0,function*(){return ns(s,"POST",e,r,o,t)})}function gl(s,e,t,r,o){return Fr(this,void 0,void 0,function*(){return ns(s,"PUT",e,r,o,t)})}function oo(s,e,t,r,o){return Fr(this,void 0,void 0,function*(){return ns(s,"DELETE",e,r,o,t)})}var st=function(s,e,t,r){function o(a){return a instanceof t?a:new t(function(u){u(a)})}return new(t||(t=Promise))(function(a,u){function d(y){try{g(r.next(y))}catch(w){u(w)}}function p(y){try{g(r.throw(y))}catch(w){u(w)}}function g(y){y.done?a(y.value):o(y.value).then(d,p)}g((r=r.apply(s,e||[])).next())})};const vl={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},fa={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class bl{constructor(e,t={},r,o){this.url=e,this.headers=t,this.bucketId=r,this.fetch=ao(o)}uploadOrUpdate(e,t,r,o){return st(this,void 0,void 0,function*(){try{let a;const u=Object.assign(Object.assign({},fa),o),d=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(u.upsert)});typeof Blob<"u"&&r instanceof Blob?(a=new FormData,a.append("cacheControl",u.cacheControl),a.append("",r)):typeof FormData<"u"&&r instanceof FormData?(a=r,a.append("cacheControl",u.cacheControl)):(a=r,d["cache-control"]=`max-age=${u.cacheControl}`,d["content-type"]=u.contentType);const p=this._removeEmptyFolders(t),g=this._getFinalPath(p),y=yield this.fetch(`${this.url}/object/${g}`,Object.assign({method:e,body:a,headers:d},u?.duplex?{duplex:u.duplex}:{})),w=yield y.json();return y.ok?{data:{path:p,id:w.Id,fullPath:w.Key},error:null}:{data:null,error:w}}catch(a){if(ze(a))return{data:null,error:a};throw a}})}upload(e,t,r){return st(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,r)})}uploadToSignedUrl(e,t,r,o){return st(this,void 0,void 0,function*(){const a=this._removeEmptyFolders(e),u=this._getFinalPath(a),d=new URL(this.url+`/object/upload/sign/${u}`);d.searchParams.set("token",t);try{let p;const g=Object.assign({upsert:fa.upsert},o),y=Object.assign(Object.assign({},this.headers),{"x-upsert":String(g.upsert)});typeof Blob<"u"&&r instanceof Blob?(p=new FormData,p.append("cacheControl",g.cacheControl),p.append("",r)):typeof FormData<"u"&&r instanceof FormData?(p=r,p.append("cacheControl",g.cacheControl)):(p=r,y["cache-control"]=`max-age=${g.cacheControl}`,y["content-type"]=g.contentType);const w=yield this.fetch(d.toString(),{method:"PUT",body:p,headers:y}),D=yield w.json();return w.ok?{data:{path:a,fullPath:D.Key},error:null}:{data:null,error:D}}catch(p){if(ze(p))return{data:null,error:p};throw p}})}createSignedUploadUrl(e){return st(this,void 0,void 0,function*(){try{let t=this._getFinalPath(e);const r=yield Wt(this.fetch,`${this.url}/object/upload/sign/${t}`,{},{headers:this.headers}),o=new URL(this.url+r.url),a=o.searchParams.get("token");if(!a)throw new yi("No token returned by API");return{data:{signedUrl:o.toString(),path:e,token:a},error:null}}catch(t){if(ze(t))return{data:null,error:t};throw t}})}update(e,t,r){return st(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,r)})}move(e,t){return st(this,void 0,void 0,function*(){try{return{data:yield Wt(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t},{headers:this.headers}),error:null}}catch(r){if(ze(r))return{data:null,error:r};throw r}})}copy(e,t){return st(this,void 0,void 0,function*(){try{return{data:{path:(yield Wt(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t},{headers:this.headers})).Key},error:null}}catch(r){if(ze(r))return{data:null,error:r};throw r}})}createSignedUrl(e,t,r){return st(this,void 0,void 0,function*(){try{let o=this._getFinalPath(e),a=yield Wt(this.fetch,`${this.url}/object/sign/${o}`,Object.assign({expiresIn:t},r?.transform?{transform:r.transform}:{}),{headers:this.headers});const u=r?.download?`&download=${r.download===!0?"":r.download}`:"";return a={signedUrl:encodeURI(`${this.url}${a.signedURL}${u}`)},{data:a,error:null}}catch(o){if(ze(o))return{data:null,error:o};throw o}})}createSignedUrls(e,t,r){return st(this,void 0,void 0,function*(){try{const o=yield Wt(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),a=r?.download?`&download=${r.download===!0?"":r.download}`:"";return{data:o.map(u=>Object.assign(Object.assign({},u),{signedUrl:u.signedURL?encodeURI(`${this.url}${u.signedURL}${a}`):null})),error:null}}catch(o){if(ze(o))return{data:null,error:o};throw o}})}download(e,t){return st(this,void 0,void 0,function*(){const o=typeof t?.transform<"u"?"render/image/authenticated":"object",a=this.transformOptsToQueryString(t?.transform||{}),u=a?`?${a}`:"";try{const d=this._getFinalPath(e);return{data:yield(yield ti(this.fetch,`${this.url}/${o}/${d}${u}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(d){if(ze(d))return{data:null,error:d};throw d}})}getPublicUrl(e,t){const r=this._getFinalPath(e),o=[],a=t?.download?`download=${t.download===!0?"":t.download}`:"";a!==""&&o.push(a);const d=typeof t?.transform<"u"?"render/image":"object",p=this.transformOptsToQueryString(t?.transform||{});p!==""&&o.push(p);let g=o.join("&");return g!==""&&(g=`?${g}`),{data:{publicUrl:encodeURI(`${this.url}/${d}/public/${r}${g}`)}}}remove(e){return st(this,void 0,void 0,function*(){try{return{data:yield oo(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(ze(t))return{data:null,error:t};throw t}})}list(e,t,r){return st(this,void 0,void 0,function*(){try{const o=Object.assign(Object.assign(Object.assign({},vl),t),{prefix:e||""});return{data:yield Wt(this.fetch,`${this.url}/object/list/${this.bucketId}`,o,{headers:this.headers},r),error:null}}catch(o){if(ze(o))return{data:null,error:o};throw o}})}_getFinalPath(e){return`${this.bucketId}/${e}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}const wl="2.5.5",_l={"X-Client-Info":`storage-js/${wl}`};var Cr=function(s,e,t,r){function o(a){return a instanceof t?a:new t(function(u){u(a)})}return new(t||(t=Promise))(function(a,u){function d(y){try{g(r.next(y))}catch(w){u(w)}}function p(y){try{g(r.throw(y))}catch(w){u(w)}}function g(y){y.done?a(y.value):o(y.value).then(d,p)}g((r=r.apply(s,e||[])).next())})};class kl{constructor(e,t={},r){this.url=e,this.headers=Object.assign(Object.assign({},_l),t),this.fetch=ao(r)}listBuckets(){return Cr(this,void 0,void 0,function*(){try{return{data:yield ti(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(ze(e))return{data:null,error:e};throw e}})}getBucket(e){return Cr(this,void 0,void 0,function*(){try{return{data:yield ti(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(ze(t))return{data:null,error:t};throw t}})}createBucket(e,t={public:!1}){return Cr(this,void 0,void 0,function*(){try{return{data:yield Wt(this.fetch,`${this.url}/bucket`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(ze(r))return{data:null,error:r};throw r}})}updateBucket(e,t){return Cr(this,void 0,void 0,function*(){try{return{data:yield gl(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(ze(r))return{data:null,error:r};throw r}})}emptyBucket(e){return Cr(this,void 0,void 0,function*(){try{return{data:yield Wt(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(ze(t))return{data:null,error:t};throw t}})}deleteBucket(e){return Cr(this,void 0,void 0,function*(){try{return{data:yield oo(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(ze(t))return{data:null,error:t};throw t}})}}class El extends kl{constructor(e,t={},r){super(e,t,r)}from(e){return new bl(this.url,this.headers,e,this.fetch)}}const Sl="2.42.5";let sn="";typeof Deno<"u"?sn="deno":typeof document<"u"?sn="web":typeof navigator<"u"&&navigator.product==="ReactNative"?sn="react-native":sn="node";const xl={"X-Client-Info":`supabase-js-${sn}/${Sl}`},Pl={headers:xl},Ol={schema:"public"},Cl={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},Tl={};var Al=function(s,e,t,r){function o(a){return a instanceof t?a:new t(function(u){u(a)})}return new(t||(t=Promise))(function(a,u){function d(y){try{g(r.next(y))}catch(w){u(w)}}function p(y){try{g(r.throw(y))}catch(w){u(w)}}function g(y){y.done?a(y.value):o(y.value).then(d,p)}g((r=r.apply(s,e||[])).next())})};const Rl=s=>{let e;return s?e=s:typeof fetch>"u"?e=fi:e=fetch,(...t)=>e(...t)},Il=()=>typeof Headers>"u"?ro:Headers,jl=(s,e,t)=>{const r=Rl(t),o=Il();return(a,u)=>Al(void 0,void 0,void 0,function*(){var d;const p=(d=yield e())!==null&&d!==void 0?d:s;let g=new o(u?.headers);return g.has("apikey")||g.set("apikey",s),g.has("Authorization")||g.set("Authorization",`Bearer ${p}`),r(a,Object.assign(Object.assign({},u),{headers:g}))})};function Dl(s){return s.replace(/\/$/,"")}function Nl(s,e){const{db:t,auth:r,realtime:o,global:a}=s,{db:u,auth:d,realtime:p,global:g}=e;return{db:Object.assign(Object.assign({},u),t),auth:Object.assign(Object.assign({},d),r),realtime:Object.assign(Object.assign({},p),o),global:Object.assign(Object.assign({},g),a)}}const co="2.63.1",$l="http://localhost:9999",Ll="supabase.auth.token",Ul={"X-Client-Info":`gotrue-js/${co}`},pa=10,ri="X-Supabase-Api-Version",uo={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}};function Fl(s){return Math.round(Date.now()/1e3)+s}function Bl(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(s){const e=Math.random()*16|0;return(s=="x"?e:e&3|8).toString(16)})}const ht=()=>typeof document<"u",lr={tested:!1,writable:!1},on=()=>{if(!ht())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(lr.tested)return lr.writable;const s=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(s,s),globalThis.localStorage.removeItem(s),lr.tested=!0,lr.writable=!0}catch{lr.tested=!0,lr.writable=!1}return lr.writable};function Ms(s){const e={},t=new URL(s);if(t.hash&&t.hash[0]==="#")try{new URLSearchParams(t.hash.substring(1)).forEach((o,a)=>{e[a]=o})}catch{}return t.searchParams.forEach((r,o)=>{e[o]=r}),e}const lo=s=>{let e;return s?e=s:typeof fetch>"u"?e=(...t)=>Nr(()=>Promise.resolve().then(()=>fn),void 0).then(({default:r})=>r(...t)):e=fetch,(...t)=>e(...t)},Ml=s=>typeof s=="object"&&s!==null&&"status"in s&&"ok"in s&&"json"in s&&typeof s.json=="function",ho=async(s,e,t)=>{await s.setItem(e,JSON.stringify(t))},Un=async(s,e)=>{const t=await s.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch{return t}},qs=async(s,e)=>{await s.removeItem(e)};function ql(s){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let t="",r,o,a,u,d,p,g,y=0;for(s=s.replace("-","+").replace("_","/");y<s.length;)u=e.indexOf(s.charAt(y++)),d=e.indexOf(s.charAt(y++)),p=e.indexOf(s.charAt(y++)),g=e.indexOf(s.charAt(y++)),r=u<<2|d>>4,o=(d&15)<<4|p>>2,a=(p&3)<<6|g,t=t+String.fromCharCode(r),p!=64&&o!=0&&(t=t+String.fromCharCode(o)),g!=64&&a!=0&&(t=t+String.fromCharCode(a));return t}class ss{constructor(){this.promise=new ss.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}ss.promiseConstructor=Promise;function ma(s){const e=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}=?$|[a-z0-9_-]{2}(==)?$)$/i,t=s.split(".");if(t.length!==3)throw new Error("JWT is not valid: not a JWT structure");if(!e.test(t[1]))throw new Error("JWT is not valid: payload is not in base64url format");const r=t[1];return JSON.parse(ql(r))}async function Kl(s){return await new Promise(e=>{setTimeout(()=>e(null),s)})}function zl(s,e){return new Promise((r,o)=>{(async()=>{for(let a=0;a<1/0;a++)try{const u=await s(a);if(!e(a,null,u)){r(u);return}}catch(u){if(!e(a,u)){o(u);return}}})()})}function Hl(s){return("0"+s.toString(16)).substr(-2)}function Jl(){const e=new Uint32Array(56);if(typeof crypto>"u"){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",r=t.length;let o="";for(let a=0;a<56;a++)o+=t.charAt(Math.floor(Math.random()*r));return o}return crypto.getRandomValues(e),Array.from(e,Hl).join("")}async function Vl(s){const t=new TextEncoder().encode(s),r=await crypto.subtle.digest("SHA-256",t),o=new Uint8Array(r);return Array.from(o).map(a=>String.fromCharCode(a)).join("")}function Wl(s){return btoa(s).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function Gl(s){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),s;const t=await Vl(s);return Wl(t)}async function Tr(s,e,t=!1){const r=Jl();let o=r;t&&(o+="/PASSWORD_RECOVERY"),await ho(s,`${e}-code-verifier`,o);const a=await Gl(r);return[a,r===a?"plain":"s256"]}const Yl=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function Xl(s){const e=s.headers.get(ri);if(!e||!e.match(Yl))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}class gi extends Error{constructor(e,t,r){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=r}}function ue(s){return typeof s=="object"&&s!==null&&"__isAuthError"in s}class Ql extends gi{constructor(e,t,r){super(e,t,r),this.name="AuthApiError",this.status=t,this.code=r}}function Zl(s){return ue(s)&&s.name==="AuthApiError"}class fo extends gi{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class yr extends gi{constructor(e,t,r,o){super(e,r,o),this.name=t,this.status=r}}class hr extends yr{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}class Ks extends yr{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class Fn extends yr{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class Bn extends yr{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class ya extends yr{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class ni extends yr{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function zs(s){return ue(s)&&s.name==="AuthRetryableFetchError"}class ga extends yr{constructor(e,t,r){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=r}}var eh=function(s,e){var t={};for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&e.indexOf(r)<0&&(t[r]=s[r]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,r=Object.getOwnPropertySymbols(s);o<r.length;o++)e.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(s,r[o])&&(t[r[o]]=s[r[o]]);return t};const dr=s=>s.msg||s.message||s.error_description||s.error||JSON.stringify(s),th=[502,503,504];async function va(s){var e;if(!Ml(s))throw new ni(dr(s),0);if(th.includes(s.status))throw new ni(dr(s),s.status);let t;try{t=await s.json()}catch(a){throw new fo(dr(a),a)}let r;const o=Xl(s);if(o&&o.getTime()>=uo["2024-01-01"].timestamp&&typeof t=="object"&&t&&typeof t.code=="string"?r=t.code:typeof t=="object"&&t&&typeof t.error_code=="string"&&(r=t.error_code),r){if(r==="weak_password")throw new ga(dr(t),s.status,((e=t.weak_password)===null||e===void 0?void 0:e.reasons)||[])}else if(typeof t=="object"&&t&&typeof t.weak_password=="object"&&t.weak_password&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.reasons.reduce((a,u)=>a&&typeof u=="string",!0))throw new ga(dr(t),s.status,t.weak_password.reasons);throw new Ql(dr(t),s.status||500,r)}const rh=(s,e,t,r)=>{const o={method:s,headers:e?.headers||{}};return s==="GET"?o:(o.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e?.headers),o.body=JSON.stringify(r),Object.assign(Object.assign({},o),t))};async function de(s,e,t,r){var o;const a=Object.assign({},r?.headers);a[ri]||(a[ri]=uo["2024-01-01"].name),r?.jwt&&(a.Authorization=`Bearer ${r.jwt}`);const u=(o=r?.query)!==null&&o!==void 0?o:{};r?.redirectTo&&(u.redirect_to=r.redirectTo);const d=Object.keys(u).length?"?"+new URLSearchParams(u).toString():"",p=await nh(s,e,t+d,{headers:a,noResolveJson:r?.noResolveJson},{},r?.body);return r?.xform?r?.xform(p):{data:Object.assign({},p),error:null}}async function nh(s,e,t,r,o,a){const u=rh(e,r,o,a);let d;try{d=await s(t,Object.assign(Object.assign({},u),{cache:"no-store"}))}catch(p){throw console.error(p),new ni(dr(p),0)}if(d.ok||await va(d),r?.noResolveJson)return d;try{return await d.json()}catch(p){await va(p)}}function Vt(s){var e;let t=null;oh(s)&&(t=Object.assign({},s),s.expires_at||(t.expires_at=Fl(s.expires_in)));const r=(e=s.user)!==null&&e!==void 0?e:s;return{data:{session:t,user:r},error:null}}function ba(s){const e=Vt(s);return!e.error&&s.weak_password&&typeof s.weak_password=="object"&&Array.isArray(s.weak_password.reasons)&&s.weak_password.reasons.length&&s.weak_password.message&&typeof s.weak_password.message=="string"&&s.weak_password.reasons.reduce((t,r)=>t&&typeof r=="string",!0)&&(e.data.weak_password=s.weak_password),e}function Gt(s){var e;return{data:{user:(e=s.user)!==null&&e!==void 0?e:s},error:null}}function sh(s){return{data:s,error:null}}function ih(s){const{action_link:e,email_otp:t,hashed_token:r,redirect_to:o,verification_type:a}=s,u=eh(s,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),d={action_link:e,email_otp:t,hashed_token:r,redirect_to:o,verification_type:a},p=Object.assign({},u);return{data:{properties:d,user:p},error:null}}function ah(s){return s}function oh(s){return s.access_token&&s.refresh_token&&s.expires_in}var ch=function(s,e){var t={};for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&e.indexOf(r)<0&&(t[r]=s[r]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,r=Object.getOwnPropertySymbols(s);o<r.length;o++)e.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(s,r[o])&&(t[r[o]]=s[r[o]]);return t};class uh{constructor({url:e="",headers:t={},fetch:r}){this.url=e,this.headers=t,this.fetch=lo(r),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e,t="global"){try{return await de(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(r){if(ue(r))return{data:null,error:r};throw r}}async inviteUserByEmail(e,t={}){try{return await de(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:Gt})}catch(r){if(ue(r))return{data:{user:null},error:r};throw r}}async generateLink(e){try{const{options:t}=e,r=ch(e,["options"]),o=Object.assign(Object.assign({},r),t);return"newEmail"in r&&(o.new_email=r?.newEmail,delete o.newEmail),await de(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:o,headers:this.headers,xform:ih,redirectTo:t?.redirectTo})}catch(t){if(ue(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await de(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:Gt})}catch(t){if(ue(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,r,o,a,u,d,p;try{const g={nextPage:null,lastPage:0,total:0},y=await de(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(r=(t=e?.page)===null||t===void 0?void 0:t.toString())!==null&&r!==void 0?r:"",per_page:(a=(o=e?.perPage)===null||o===void 0?void 0:o.toString())!==null&&a!==void 0?a:""},xform:ah});if(y.error)throw y.error;const w=await y.json(),D=(u=y.headers.get("x-total-count"))!==null&&u!==void 0?u:0,F=(p=(d=y.headers.get("link"))===null||d===void 0?void 0:d.split(","))!==null&&p!==void 0?p:[];return F.length>0&&(F.forEach($=>{const L=parseInt($.split(";")[0].split("=")[1].substring(0,1)),V=JSON.parse($.split(";")[1].split("=")[1]);g[`${V}Page`]=L}),g.total=parseInt(D)),{data:Object.assign(Object.assign({},w),g),error:null}}catch(g){if(ue(g))return{data:{users:[]},error:g};throw g}}async getUserById(e){try{return await de(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:Gt})}catch(t){if(ue(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){try{return await de(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:Gt})}catch(r){if(ue(r))return{data:{user:null},error:r};throw r}}async deleteUser(e,t=!1){try{return await de(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:Gt})}catch(r){if(ue(r))return{data:{user:null},error:r};throw r}}async _listFactors(e){try{const{data:t,error:r}=await de(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:o=>({data:{factors:o},error:null})});return{data:t,error:r}}catch(t){if(ue(t))return{data:null,error:t};throw t}}async _deleteFactor(e){try{return{data:await de(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(ue(t))return{data:null,error:t};throw t}}}const lh={getItem:s=>on()?globalThis.localStorage.getItem(s):null,setItem:(s,e)=>{on()&&globalThis.localStorage.setItem(s,e)},removeItem:s=>{on()&&globalThis.localStorage.removeItem(s)}};function wa(s={}){return{getItem:e=>s[e]||null,setItem:(e,t)=>{s[e]=t},removeItem:e=>{delete s[e]}}}function hh(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}const Ar={debug:!!(globalThis&&on()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class po extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class dh extends po{}async function fh(s,e,t){Ar.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",s,e);const r=new globalThis.AbortController;return e>0&&setTimeout(()=>{r.abort(),Ar.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",s)},e),await globalThis.navigator.locks.request(s,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:r.signal},async o=>{if(o){Ar.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",s,o.name);try{return await t()}finally{Ar.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",s,o.name)}}else{if(e===0)throw Ar.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",s),new dh(`Acquiring an exclusive Navigator LockManager lock "${s}" immediately failed`);if(Ar.debug)try{const a=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(a,null,"  "))}catch(a){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",a)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await t()}})}hh();const ph={url:$l,storageKey:Ll,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:Ul,flowType:"implicit",debug:!1},tn=30*1e3,_a=3;async function ka(s,e,t){return await t()}class un{constructor(e){var t,r;this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=un.nextInstanceID,un.nextInstanceID+=1,this.instanceID>0&&ht()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const o=Object.assign(Object.assign({},ph),e);if(this.logDebugMessages=!!o.debug,typeof o.debug=="function"&&(this.logger=o.debug),this.persistSession=o.persistSession,this.storageKey=o.storageKey,this.autoRefreshToken=o.autoRefreshToken,this.admin=new uh({url:o.url,headers:o.headers,fetch:o.fetch}),this.url=o.url,this.headers=o.headers,this.fetch=lo(o.fetch),this.lock=o.lock||ka,this.detectSessionInUrl=o.detectSessionInUrl,this.flowType=o.flowType,o.lock?this.lock=o.lock:ht()&&(!((t=globalThis?.navigator)===null||t===void 0)&&t.locks)?this.lock=fh:this.lock=ka,this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?o.storage?this.storage=o.storage:on()?this.storage=lh:(this.memoryStorage={},this.storage=wa(this.memoryStorage)):(this.memoryStorage={},this.storage=wa(this.memoryStorage)),ht()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(a){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",a)}(r=this.broadcastChannel)===null||r===void 0||r.addEventListener("message",async a=>{this._debug("received broadcast notification from other tab or client",a),await this._notifyAllSubscribers(a.data.event,a.data.session,!1)})}this.initialize()}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${co}) ${new Date().toISOString()}`,...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){try{const e=ht()?await this._isPKCEFlow():!1;if(this._debug("#_initialize()","begin","is PKCE flow",e),e||this.detectSessionInUrl&&this._isImplicitGrantFlow()){const{data:t,error:r}=await this._getSessionFromURL(e);if(r)return this._debug("#_initialize()","error detecting session from URL",r),r?.message==="Identity is already linked"||r?.message==="Identity is already linked to another user"?{error:r}:(await this._removeSession(),{error:r});const{session:o,redirectType:a}=t;return this._debug("#_initialize()","detected session in URL",o,"redirect type",a),await this._saveSession(o),setTimeout(async()=>{a==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",o):await this._notifyAllSubscribers("SIGNED_IN",o)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(e){return ue(e)?{error:e}:{error:new fo("Unexpected error during initialization",e)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,r,o;try{await this._removeSession();const a=await de(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(r=(t=e?.options)===null||t===void 0?void 0:t.data)!==null&&r!==void 0?r:{},gotrue_meta_security:{captcha_token:(o=e?.options)===null||o===void 0?void 0:o.captchaToken}},xform:Vt}),{data:u,error:d}=a;if(d||!u)return{data:{user:null,session:null},error:d};const p=u.session,g=u.user;return u.session&&(await this._saveSession(u.session),await this._notifyAllSubscribers("SIGNED_IN",p)),{data:{user:g,session:p},error:null}}catch(a){if(ue(a))return{data:{user:null,session:null},error:a};throw a}}async signUp(e){var t,r,o;try{await this._removeSession();let a;if("email"in e){const{email:y,password:w,options:D}=e;let F=null,$=null;this.flowType==="pkce"&&([F,$]=await Tr(this.storage,this.storageKey)),a=await de(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:D?.emailRedirectTo,body:{email:y,password:w,data:(t=D?.data)!==null&&t!==void 0?t:{},gotrue_meta_security:{captcha_token:D?.captchaToken},code_challenge:F,code_challenge_method:$},xform:Vt})}else if("phone"in e){const{phone:y,password:w,options:D}=e;a=await de(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:y,password:w,data:(r=D?.data)!==null&&r!==void 0?r:{},channel:(o=D?.channel)!==null&&o!==void 0?o:"sms",gotrue_meta_security:{captcha_token:D?.captchaToken}},xform:Vt})}else throw new Fn("You must provide either an email or phone number and a password");const{data:u,error:d}=a;if(d||!u)return{data:{user:null,session:null},error:d};const p=u.session,g=u.user;return u.session&&(await this._saveSession(u.session),await this._notifyAllSubscribers("SIGNED_IN",p)),{data:{user:g,session:p},error:null}}catch(a){if(ue(a))return{data:{user:null,session:null},error:a};throw a}}async signInWithPassword(e){try{await this._removeSession();let t;if("email"in e){const{email:a,password:u,options:d}=e;t=await de(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:a,password:u,gotrue_meta_security:{captcha_token:d?.captchaToken}},xform:ba})}else if("phone"in e){const{phone:a,password:u,options:d}=e;t=await de(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:a,password:u,gotrue_meta_security:{captcha_token:d?.captchaToken}},xform:ba})}else throw new Fn("You must provide either an email or phone number and a password");const{data:r,error:o}=t;return o?{data:{user:null,session:null},error:o}:!r||!r.session||!r.user?{data:{user:null,session:null},error:new Ks}:(r.session&&(await this._saveSession(r.session),await this._notifyAllSubscribers("SIGNED_IN",r.session)),{data:Object.assign({user:r.user,session:r.session},r.weak_password?{weakPassword:r.weak_password}:null),error:o})}catch(t){if(ue(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOAuth(e){var t,r,o,a;return await this._removeSession(),await this._handleProviderSignIn(e.provider,{redirectTo:(t=e.options)===null||t===void 0?void 0:t.redirectTo,scopes:(r=e.options)===null||r===void 0?void 0:r.scopes,queryParams:(o=e.options)===null||o===void 0?void 0:o.queryParams,skipBrowserRedirect:(a=e.options)===null||a===void 0?void 0:a.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async _exchangeCodeForSession(e){const t=await Un(this.storage,`${this.storageKey}-code-verifier`),[r,o]=(t??"").split("/"),{data:a,error:u}=await de(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:r},xform:Vt});return await qs(this.storage,`${this.storageKey}-code-verifier`),u?{data:{user:null,session:null,redirectType:null},error:u}:!a||!a.session||!a.user?{data:{user:null,session:null,redirectType:null},error:new Ks}:(a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",a.session)),{data:Object.assign(Object.assign({},a),{redirectType:o??null}),error:u})}async signInWithIdToken(e){await this._removeSession();try{const{options:t,provider:r,token:o,access_token:a,nonce:u}=e,d=await de(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:r,id_token:o,access_token:a,nonce:u,gotrue_meta_security:{captcha_token:t?.captchaToken}},xform:Vt}),{data:p,error:g}=d;return g?{data:{user:null,session:null},error:g}:!p||!p.session||!p.user?{data:{user:null,session:null},error:new Ks}:(p.session&&(await this._saveSession(p.session),await this._notifyAllSubscribers("SIGNED_IN",p.session)),{data:p,error:g})}catch(t){if(ue(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOtp(e){var t,r,o,a,u;try{if(await this._removeSession(),"email"in e){const{email:d,options:p}=e;let g=null,y=null;this.flowType==="pkce"&&([g,y]=await Tr(this.storage,this.storageKey));const{error:w}=await de(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:d,data:(t=p?.data)!==null&&t!==void 0?t:{},create_user:(r=p?.shouldCreateUser)!==null&&r!==void 0?r:!0,gotrue_meta_security:{captcha_token:p?.captchaToken},code_challenge:g,code_challenge_method:y},redirectTo:p?.emailRedirectTo});return{data:{user:null,session:null},error:w}}if("phone"in e){const{phone:d,options:p}=e,{data:g,error:y}=await de(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:d,data:(o=p?.data)!==null&&o!==void 0?o:{},create_user:(a=p?.shouldCreateUser)!==null&&a!==void 0?a:!0,gotrue_meta_security:{captcha_token:p?.captchaToken},channel:(u=p?.channel)!==null&&u!==void 0?u:"sms"}});return{data:{user:null,session:null,messageId:g?.message_id},error:y}}throw new Fn("You must provide either an email or phone number.")}catch(d){if(ue(d))return{data:{user:null,session:null},error:d};throw d}}async verifyOtp(e){var t,r;try{e.type!=="email_change"&&e.type!=="phone_change"&&await this._removeSession();let o,a;"options"in e&&(o=(t=e.options)===null||t===void 0?void 0:t.redirectTo,a=(r=e.options)===null||r===void 0?void 0:r.captchaToken);const{data:u,error:d}=await de(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:a}}),redirectTo:o,xform:Vt});if(d)throw d;if(!u)throw new Error("An error occurred on token verification.");const p=u.session,g=u.user;return p?.access_token&&(await this._saveSession(p),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",p)),{data:{user:g,session:p},error:null}}catch(o){if(ue(o))return{data:{user:null,session:null},error:o};throw o}}async signInWithSSO(e){var t,r,o;try{await this._removeSession();let a=null,u=null;return this.flowType==="pkce"&&([a,u]=await Tr(this.storage,this.storageKey)),await de(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(r=(t=e.options)===null||t===void 0?void 0:t.redirectTo)!==null&&r!==void 0?r:void 0}),!((o=e?.options)===null||o===void 0)&&o.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:a,code_challenge_method:u}),headers:this.headers,xform:sh})}catch(a){if(ue(a))return{data:null,error:a};throw a}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:t},error:r}=e;if(r)throw r;if(!t)throw new hr;const{error:o}=await de(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return{data:{user:null,session:null},error:o}})}catch(e){if(ue(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{e.type!="email_change"&&e.type!="phone_change"&&await this._removeSession();const t=`${this.url}/resend`;if("email"in e){const{email:r,type:o,options:a}=e,{error:u}=await de(this.fetch,"POST",t,{headers:this.headers,body:{email:r,type:o,gotrue_meta_security:{captcha_token:a?.captchaToken}},redirectTo:a?.emailRedirectTo});return{data:{user:null,session:null},error:u}}else if("phone"in e){const{phone:r,type:o,options:a}=e,{data:u,error:d}=await de(this.fetch,"POST",t,{headers:this.headers,body:{phone:r,type:o,gotrue_meta_security:{captcha_token:a?.captchaToken}}});return{data:{user:null,session:null,messageId:u?.message_id},error:d}}throw new Fn("You must provide either an email or phone number and a type")}catch(t){if(ue(t))return{data:{user:null,session:null},error:t};throw t}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async t=>t))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const r=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),o=(async()=>(await r,await t()))();return this.pendingInLock.push((async()=>{try{await o}catch{}})()),o}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const r=t();for(this.pendingInLock.push((async()=>{try{await r}catch{}})()),await r;this.pendingInLock.length;){const o=[...this.pendingInLock];await Promise.all(o),this.pendingInLock.splice(0,o.length)}return await r}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const t=await Un(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),t!==null&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const r=e.expires_at?e.expires_at<=Date.now()/1e3:!1;if(this._debug("#__loadSession()",`session has${r?"":" not"} expired`,"expires_at",e.expires_at),!r)return this.storage.isServer&&(e=new Proxy(e,{get(d,p,g){return p==="user"&&console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and many not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),Reflect.get(d,p,g)}})),{data:{session:e},error:null};const{session:o,error:a}=await this._callRefreshToken(e.refresh_token);return a?{data:{session:null},error:a}:{data:{session:o},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await de(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:Gt}):await this._useSession(async t=>{var r,o,a;const{data:u,error:d}=t;if(d)throw d;return!((r=u.session)===null||r===void 0)&&r.access_token?await de(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(a=(o=u.session)===null||o===void 0?void 0:o.access_token)!==null&&a!==void 0?a:void 0,xform:Gt}):{data:{user:null},error:new hr}})}catch(t){if(ue(t))return{data:{user:null},error:t};throw t}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,t))}async _updateUser(e,t={}){try{return await this._useSession(async r=>{const{data:o,error:a}=r;if(a)throw a;if(!o.session)throw new hr;const u=o.session;let d=null,p=null;this.flowType==="pkce"&&e.email!=null&&([d,p]=await Tr(this.storage,this.storageKey));const{data:g,error:y}=await de(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:t?.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:d,code_challenge_method:p}),jwt:u.access_token,xform:Gt});if(y)throw y;return u.user=g.user,await this._saveSession(u),await this._notifyAllSubscribers("USER_UPDATED",u),{data:{user:u.user},error:null}})}catch(r){if(ue(r))return{data:{user:null},error:r};throw r}}_decodeJWT(e){return ma(e)}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new hr;const t=Date.now()/1e3;let r=t,o=!0,a=null;const u=ma(e.access_token);if(u.exp&&(r=u.exp,o=r<=t),o){const{session:d,error:p}=await this._callRefreshToken(e.refresh_token);if(p)return{data:{user:null,session:null},error:p};if(!d)return{data:{user:null,session:null},error:null};a=d}else{const{data:d,error:p}=await this._getUser(e.access_token);if(p)throw p;a={access_token:e.access_token,refresh_token:e.refresh_token,user:d.user,token_type:"bearer",expires_in:r-t,expires_at:r},await this._saveSession(a),await this._notifyAllSubscribers("SIGNED_IN",a)}return{data:{user:a.user,session:a},error:null}}catch(t){if(ue(t))return{data:{session:null,user:null},error:t};throw t}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var r;if(!e){const{data:u,error:d}=t;if(d)throw d;e=(r=u.session)!==null&&r!==void 0?r:void 0}if(!e?.refresh_token)throw new hr;const{session:o,error:a}=await this._callRefreshToken(e.refresh_token);return a?{data:{user:null,session:null},error:a}:o?{data:{user:o.user,session:o},error:null}:{data:{user:null,session:null},error:null}})}catch(t){if(ue(t))return{data:{user:null,session:null},error:t};throw t}}async _getSessionFromURL(e){try{if(!ht())throw new Bn("No browser detected.");if(this.flowType==="implicit"&&!this._isImplicitGrantFlow())throw new Bn("Not a valid implicit grant flow url.");if(this.flowType=="pkce"&&!e)throw new ya("Not a valid PKCE flow url.");const t=Ms(window.location.href);if(e){if(!t.code)throw new ya("No code detected.");const{data:le,error:he}=await this._exchangeCodeForSession(t.code);if(he)throw he;const X=new URL(window.location.href);return X.searchParams.delete("code"),window.history.replaceState(window.history.state,"",X.toString()),{data:{session:le.session,redirectType:null},error:null}}if(t.error||t.error_description||t.error_code)throw new Bn(t.error_description||"Error in URL with unspecified error_description",{error:t.error||"unspecified_error",code:t.error_code||"unspecified_code"});const{provider_token:r,provider_refresh_token:o,access_token:a,refresh_token:u,expires_in:d,expires_at:p,token_type:g}=t;if(!a||!d||!u||!g)throw new Bn("No session defined in URL");const y=Math.round(Date.now()/1e3),w=parseInt(d);let D=y+w;p&&(D=parseInt(p));const F=D-y;F*1e3<=tn&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${F}s, should have been closer to ${w}s`);const $=D-w;y-$>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",$,D,y):y-$<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clok for skew",$,D,y);const{data:L,error:V}=await this._getUser(a);if(V)throw V;const Q={provider_token:r,provider_refresh_token:o,access_token:a,expires_in:w,expires_at:D,refresh_token:u,token_type:g,user:L.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:Q,redirectType:t.type},error:null}}catch(t){if(ue(t))return{data:{session:null,redirectType:null},error:t};throw t}}_isImplicitGrantFlow(){const e=Ms(window.location.href);return!!(ht()&&(e.access_token||e.error_description))}async _isPKCEFlow(){const e=Ms(window.location.href),t=await Un(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var r;const{data:o,error:a}=t;if(a)return{error:a};const u=(r=o.session)===null||r===void 0?void 0:r.access_token;if(u){const{error:d}=await this.admin.signOut(u,e);if(d&&!(Zl(d)&&(d.status===404||d.status===401)))return{error:d}}return e!=="others"&&(await this._removeSession(),await qs(this.storage,`${this.storageKey}-code-verifier`),await this._notifyAllSubscribers("SIGNED_OUT",null)),{error:null}})}onAuthStateChange(e){const t=Bl(),r={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,r),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(t)})))(),{data:{subscription:r}}}async _emitInitialSession(e){return await this._useSession(async t=>{var r,o;try{const{data:{session:a},error:u}=t;if(u)throw u;await((r=this.stateChangeEmitters.get(e))===null||r===void 0?void 0:r.callback("INITIAL_SESSION",a)),this._debug("INITIAL_SESSION","callback id",e,"session",a)}catch(a){await((o=this.stateChangeEmitters.get(e))===null||o===void 0?void 0:o.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",a),console.error(a)}})}async resetPasswordForEmail(e,t={}){let r=null,o=null;this.flowType==="pkce"&&([r,o]=await Tr(this.storage,this.storageKey,!0));try{return await de(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:r,code_challenge_method:o,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(a){if(ue(a))return{data:null,error:a};throw a}}async getUserIdentities(){var e;try{const{data:t,error:r}=await this.getUser();if(r)throw r;return{data:{identities:(e=t.user.identities)!==null&&e!==void 0?e:[]},error:null}}catch(t){if(ue(t))return{data:null,error:t};throw t}}async linkIdentity(e){var t;try{const{data:r,error:o}=await this._useSession(async a=>{var u,d,p,g,y;const{data:w,error:D}=a;if(D)throw D;const F=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(u=e.options)===null||u===void 0?void 0:u.redirectTo,scopes:(d=e.options)===null||d===void 0?void 0:d.scopes,queryParams:(p=e.options)===null||p===void 0?void 0:p.queryParams,skipBrowserRedirect:!0});return await de(this.fetch,"GET",F,{headers:this.headers,jwt:(y=(g=w.session)===null||g===void 0?void 0:g.access_token)!==null&&y!==void 0?y:void 0})});if(o)throw o;return ht()&&!(!((t=e.options)===null||t===void 0)&&t.skipBrowserRedirect)&&window.location.assign(r?.url),{data:{provider:e.provider,url:r?.url},error:null}}catch(r){if(ue(r))return{data:{provider:e.provider,url:null},error:r};throw r}}async unlinkIdentity(e){try{return await this._useSession(async t=>{var r,o;const{data:a,error:u}=t;if(u)throw u;return await de(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(o=(r=a.session)===null||r===void 0?void 0:r.access_token)!==null&&o!==void 0?o:void 0})})}catch(t){if(ue(t))return{data:null,error:t};throw t}}async _refreshAccessToken(e){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const r=Date.now();return await zl(async o=>(o>0&&await Kl(200*Math.pow(2,o-1)),this._debug(t,"refreshing attempt",o),await de(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:Vt})),(o,a)=>{const u=200*Math.pow(2,o);return a&&zs(a)&&Date.now()+u-r<tn})}catch(r){if(this._debug(t,"error",r),ue(r))return{data:{session:null,user:null},error:r};throw r}finally{this._debug(t,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const r=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",r),ht()&&!t.skipBrowserRedirect&&window.location.assign(r),{data:{provider:e,url:r},error:null}}async _recoverAndRefresh(){var e;const t="#_recoverAndRefresh()";this._debug(t,"begin");try{const r=await Un(this.storage,this.storageKey);if(this._debug(t,"session from storage",r),!this._isValidSession(r)){this._debug(t,"session is not valid"),r!==null&&await this._removeSession();return}const o=Math.round(Date.now()/1e3),a=((e=r.expires_at)!==null&&e!==void 0?e:1/0)<o+pa;if(this._debug(t,`session has${a?"":" not"} expired with margin of ${pa}s`),a){if(this.autoRefreshToken&&r.refresh_token){const{error:u}=await this._callRefreshToken(r.refresh_token);u&&(console.error(u),zs(u)||(this._debug(t,"refresh failed with a non-retryable error, removing the session",u),await this._removeSession()))}}else await this._notifyAllSubscribers("SIGNED_IN",r)}catch(r){this._debug(t,"error",r),console.error(r);return}finally{this._debug(t,"end")}}async _callRefreshToken(e){var t,r;if(!e)throw new hr;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const o=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(o,"begin");try{this.refreshingDeferred=new ss;const{data:a,error:u}=await this._refreshAccessToken(e);if(u)throw u;if(!a.session)throw new hr;await this._saveSession(a.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",a.session);const d={session:a.session,error:null};return this.refreshingDeferred.resolve(d),d}catch(a){if(this._debug(o,"error",a),ue(a)){const u={session:null,error:a};return zs(a)||(await this._removeSession(),await this._notifyAllSubscribers("SIGNED_OUT",null)),(t=this.refreshingDeferred)===null||t===void 0||t.resolve(u),u}throw(r=this.refreshingDeferred)===null||r===void 0||r.reject(a),a}finally{this.refreshingDeferred=null,this._debug(o,"end")}}async _notifyAllSubscribers(e,t,r=!0){const o=`#_notifyAllSubscribers(${e})`;this._debug(o,"begin",t,`broadcast = ${r}`);try{this.broadcastChannel&&r&&this.broadcastChannel.postMessage({event:e,session:t});const a=[],u=Array.from(this.stateChangeEmitters.values()).map(async d=>{try{await d.callback(e,t)}catch(p){a.push(p)}});if(await Promise.all(u),a.length>0){for(let d=0;d<a.length;d+=1)console.error(a[d]);throw a[0]}}finally{this._debug(o,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),await ho(this.storage,this.storageKey,e)}async _removeSession(){this._debug("#_removeSession()"),await qs(this.storage,this.storageKey)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&ht()&&window?.removeEventListener&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),tn);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async t=>{const{data:{session:r}}=t;if(!r||!r.refresh_token||!r.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const o=Math.floor((r.expires_at*1e3-e)/tn);this._debug("#_autoRefreshTokenTick()",`access token expires in ${o} ticks, a tick lasts ${tn}ms, refresh threshold is ${_a} ticks`),o<=_a&&await this._callRefreshToken(r.refresh_token)})}catch(t){console.error("Auto refresh tick failed with error. This is likely a transient error.",t)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof po)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!ht()||!window?.addEventListener)return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window?.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,r){const o=[`provider=${encodeURIComponent(t)}`];if(r?.redirectTo&&o.push(`redirect_to=${encodeURIComponent(r.redirectTo)}`),r?.scopes&&o.push(`scopes=${encodeURIComponent(r.scopes)}`),this.flowType==="pkce"){const[a,u]=await Tr(this.storage,this.storageKey),d=new URLSearchParams({code_challenge:`${encodeURIComponent(a)}`,code_challenge_method:`${encodeURIComponent(u)}`});o.push(d.toString())}if(r?.queryParams){const a=new URLSearchParams(r.queryParams);o.push(a.toString())}return r?.skipBrowserRedirect&&o.push(`skip_http_redirect=${r.skipBrowserRedirect}`),`${e}?${o.join("&")}`}async _unenroll(e){try{return await this._useSession(async t=>{var r;const{data:o,error:a}=t;return a?{data:null,error:a}:await de(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(r=o?.session)===null||r===void 0?void 0:r.access_token})})}catch(t){if(ue(t))return{data:null,error:t};throw t}}async _enroll(e){try{return await this._useSession(async t=>{var r,o;const{data:a,error:u}=t;if(u)return{data:null,error:u};const{data:d,error:p}=await de(this.fetch,"POST",`${this.url}/factors`,{body:{friendly_name:e.friendlyName,factor_type:e.factorType,issuer:e.issuer},headers:this.headers,jwt:(r=a?.session)===null||r===void 0?void 0:r.access_token});return p?{data:null,error:p}:(!((o=d?.totp)===null||o===void 0)&&o.qr_code&&(d.totp.qr_code=`data:image/svg+xml;utf-8,${d.totp.qr_code}`),{data:d,error:null})})}catch(t){if(ue(t))return{data:null,error:t};throw t}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var r;const{data:o,error:a}=t;if(a)return{data:null,error:a};const{data:u,error:d}=await de(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:(r=o?.session)===null||r===void 0?void 0:r.access_token});return d?{data:null,error:d}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+u.expires_in},u)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",u),{data:u,error:d})})}catch(t){if(ue(t))return{data:null,error:t};throw t}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var r;const{data:o,error:a}=t;return a?{data:null,error:a}:await de(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{headers:this.headers,jwt:(r=o?.session)===null||r===void 0?void 0:r.access_token})})}catch(t){if(ue(t))return{data:null,error:t};throw t}})}async _challengeAndVerify(e){const{data:t,error:r}=await this._challenge({factorId:e.factorId});return r?{data:null,error:r}:await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){const{data:{user:e},error:t}=await this.getUser();if(t)return{data:null,error:t};const r=e?.factors||[],o=r.filter(a=>a.factor_type==="totp"&&a.status==="verified");return{data:{all:r,totp:o},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var t,r;const{data:{session:o},error:a}=e;if(a)return{data:null,error:a};if(!o)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const u=this._decodeJWT(o.access_token);let d=null;u.aal&&(d=u.aal);let p=d;((r=(t=o.user.factors)===null||t===void 0?void 0:t.filter(w=>w.status==="verified"))!==null&&r!==void 0?r:[]).length>0&&(p="aal2");const y=u.amr||[];return{data:{currentLevel:d,nextLevel:p,currentAuthenticationMethods:y},error:null}}))}}un.nextInstanceID=0;const mh=un;class yh extends mh{constructor(e){super(e)}}var gh=function(s,e,t,r){function o(a){return a instanceof t?a:new t(function(u){u(a)})}return new(t||(t=Promise))(function(a,u){function d(y){try{g(r.next(y))}catch(w){u(w)}}function p(y){try{g(r.throw(y))}catch(w){u(w)}}function g(y){y.done?a(y.value):o(y.value).then(d,p)}g((r=r.apply(s,e||[])).next())})};class vh{constructor(e,t,r){var o,a,u,d,p,g,y,w;if(this.supabaseUrl=e,this.supabaseKey=t,!e)throw new Error("supabaseUrl is required.");if(!t)throw new Error("supabaseKey is required.");const D=Dl(e);this.realtimeUrl=`${D}/realtime/v1`.replace(/^http/i,"ws"),this.authUrl=`${D}/auth/v1`,this.storageUrl=`${D}/storage/v1`,this.functionsUrl=`${D}/functions/v1`;const F=`sb-${new URL(this.authUrl).hostname.split(".")[0]}-auth-token`,$={db:Ol,realtime:Tl,auth:Object.assign(Object.assign({},Cl),{storageKey:F}),global:Pl},L=Nl(r??{},$);this.storageKey=(a=(o=L.auth)===null||o===void 0?void 0:o.storageKey)!==null&&a!==void 0?a:"",this.headers=(d=(u=L.global)===null||u===void 0?void 0:u.headers)!==null&&d!==void 0?d:{},this.auth=this._initSupabaseAuthClient((p=L.auth)!==null&&p!==void 0?p:{},this.headers,(g=L.global)===null||g===void 0?void 0:g.fetch),this.fetch=jl(t,this._getAccessToken.bind(this),(y=L.global)===null||y===void 0?void 0:y.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers},L.realtime)),this.rest=new pi(`${D}/rest/v1`,{headers:this.headers,schema:(w=L.db)===null||w===void 0?void 0:w.schema,fetch:this.fetch}),this._listenForAuthEvents()}get functions(){return new Bu(this.functionsUrl,{headers:this.headers,customFetch:this.fetch})}get storage(){return new El(this.storageUrl,this.headers,this.fetch)}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},r={}){return this.rest.rpc(e,t,r)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,t;return gh(this,void 0,void 0,function*(){const{data:r}=yield this.auth.getSession();return(t=(e=r.session)===null||e===void 0?void 0:e.access_token)!==null&&t!==void 0?t:null})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:o,storageKey:a,flowType:u,debug:d},p,g){const y={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new yh({url:this.authUrl,headers:Object.assign(Object.assign({},y),p),storageKey:a,autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:o,flowType:u,debug:d,fetch:g})}_initRealtimeClient(e){return new ll(this.realtimeUrl,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e?.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,r)=>{this._handleTokenChanged(t,"CLIENT",r?.access_token)})}_handleTokenChanged(e,t,r){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==r?(this.realtime.setAuth(r??null),this.changedAccessToken=r):e==="SIGNED_OUT"&&(this.realtime.setAuth(this.supabaseKey),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const bh=(s,e,t)=>new vh(s,e,t);var mo={exports:{}};(function(s,e){(function(t,r){s.exports=r()})(Vi,function(){var t=function(n,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(c,l){c.__proto__=l}||function(c,l){for(var h in l)Object.prototype.hasOwnProperty.call(l,h)&&(c[h]=l[h])})(n,i)},r=function(){return(r=Object.assign||function(n){for(var i,c=1,l=arguments.length;c<l;c++)for(var h in i=arguments[c])Object.prototype.hasOwnProperty.call(i,h)&&(n[h]=i[h]);return n}).apply(this,arguments)};function o(n,i,c){if(c||arguments.length===2)for(var l,h=0,f=i.length;h<f;h++)!l&&h in i||((l=l||Array.prototype.slice.call(i,0,h))[h]=i[h]);return n.concat(l||Array.prototype.slice.call(i))}var a=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:Vi,u=Object.keys,d=Array.isArray;function p(n,i){return typeof i!="object"||u(i).forEach(function(c){n[c]=i[c]}),n}typeof Promise>"u"||a.Promise||(a.Promise=Promise);var g=Object.getPrototypeOf,y={}.hasOwnProperty;function w(n,i){return y.call(n,i)}function D(n,i){typeof i=="function"&&(i=i(g(n))),(typeof Reflect>"u"?u:Reflect.ownKeys)(i).forEach(function(c){$(n,c,i[c])})}var F=Object.defineProperty;function $(n,i,c,l){F(n,i,p(c&&w(c,"get")&&typeof c.get=="function"?{get:c.get,set:c.set,configurable:!0}:{value:c,configurable:!0,writable:!0},l))}function L(n){return{from:function(i){return n.prototype=Object.create(i.prototype),$(n.prototype,"constructor",n),{extend:D.bind(null,n.prototype)}}}}var V=Object.getOwnPropertyDescriptor,Q=[].slice;function le(n,i,c){return Q.call(n,i,c)}function he(n,i){return i(n)}function X(n){if(!n)throw new Error("Assertion Failed")}function Xe(n){a.setImmediate?setImmediate(n):setTimeout(n,0)}function Le(n,i){if(typeof i=="string"&&w(n,i))return n[i];if(!i)return n;if(typeof i!="string"){for(var c=[],l=0,h=i.length;l<h;++l){var f=Le(n,i[l]);c.push(f)}return c}var m=i.indexOf(".");if(m!==-1){var v=n[i.substr(0,m)];return v==null?void 0:Le(v,i.substr(m+1))}}function ye(n,i,c){if(n&&i!==void 0&&!("isFrozen"in Object&&Object.isFrozen(n)))if(typeof i!="string"&&"length"in i){X(typeof c!="string"&&"length"in c);for(var l=0,h=i.length;l<h;++l)ye(n,i[l],c[l])}else{var f,m,v=i.indexOf(".");v!==-1?(f=i.substr(0,v),(m=i.substr(v+1))===""?c===void 0?d(n)&&!isNaN(parseInt(f))?n.splice(f,1):delete n[f]:n[f]=c:ye(v=!(v=n[f])||!w(n,f)?n[f]={}:v,m,c)):c===void 0?d(n)&&!isNaN(parseInt(i))?n.splice(i,1):delete n[i]:n[i]=c}}function jt(n){var i,c={};for(i in n)w(n,i)&&(c[i]=n[i]);return c}var at=[].concat;function Qe(n){return at.apply([],n)}var At="BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(Qe([8,16,32,64].map(function(n){return["Int","Uint","Float"].map(function(i){return i+n+"Array"})}))).filter(function(n){return a[n]}),Xt=new Set(At.map(function(n){return a[n]})),ce=null;function Ee(n){return ce=new WeakMap,n=function i(c){if(!c||typeof c!="object")return c;var l=ce.get(c);if(l)return l;if(d(c)){l=[],ce.set(c,l);for(var h=0,f=c.length;h<f;++h)l.push(i(c[h]))}else if(Xt.has(c.constructor))l=c;else{var m,v=g(c);for(m in l=v===Object.prototype?{}:Object.create(v),ce.set(c,l),c)w(c,m)&&(l[m]=i(c[m]))}return l}(n),ce=null,n}var Se={}.toString;function Qt(n){return Se.call(n).slice(8,-1)}var ot=typeof Symbol<"u"?Symbol.iterator:"@@iterator",St=typeof ot=="symbol"?function(n){var i;return n!=null&&(i=n[ot])&&i.apply(n)}:function(){return null};function ft(n,i){return i=n.indexOf(i),0<=i&&n.splice(i,1),0<=i}var pt={};function He(n){var i,c,l,h;if(arguments.length===1){if(d(n))return n.slice();if(this===pt&&typeof n=="string")return[n];if(h=St(n)){for(c=[];!(l=h.next()).done;)c.push(l.value);return c}if(n==null)return[n];if(typeof(i=n.length)!="number")return[n];for(c=new Array(i);i--;)c[i]=n[i];return c}for(i=arguments.length,c=new Array(i);i--;)c[i]=arguments[i];return c}var Ue=typeof Symbol<"u"?function(n){return n[Symbol.toStringTag]==="AsyncFunction"}:function(){return!1},Oe=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],nt=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(Oe),Br={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function Ge(n,i){this.name=n,this.message=i}function mt(n,i){return n+". Errors: "+Object.keys(i).map(function(c){return i[c].toString()}).filter(function(c,l,h){return h.indexOf(c)===l}).join(`
`)}function Zt(n,i,c,l){this.failures=i,this.failedKeys=l,this.successCount=c,this.message=mt(n,i)}function yt(n,i){this.name="BulkError",this.failures=Object.keys(i).map(function(c){return i[c]}),this.failuresByPos=i,this.message=mt(n,this.failures)}L(Ge).from(Error).extend({toString:function(){return this.name+": "+this.message}}),L(Zt).from(Ge),L(yt).from(Ge);var xt=nt.reduce(function(n,i){return n[i]=i+"Error",n},{}),Je=Ge,Y=nt.reduce(function(n,i){var c=i+"Error";function l(h,f){this.name=c,h?typeof h=="string"?(this.message="".concat(h).concat(f?`
 `+f:""),this.inner=f||null):typeof h=="object"&&(this.message="".concat(h.name," ").concat(h.message),this.inner=h):(this.message=Br[i]||c,this.inner=null)}return L(l).from(Je),n[i]=l,n},{});Y.Syntax=SyntaxError,Y.Type=TypeError,Y.Range=RangeError;var Dt=Oe.reduce(function(n,i){return n[i+"Error"]=Y[i],n},{}),ct=nt.reduce(function(n,i){return["Syntax","Type","Range"].indexOf(i)===-1&&(n[i+"Error"]=Y[i]),n},{});function pe(){}function Ve(n){return n}function er(n,i){return n==null||n===Ve?i:function(c){return i(n(c))}}function rt(n,i){return function(){n.apply(this,arguments),i.apply(this,arguments)}}function Mr(n,i){return n===pe?i:function(){var c=n.apply(this,arguments);c!==void 0&&(arguments[0]=c);var l=this.onsuccess,h=this.onerror;this.onsuccess=null,this.onerror=null;var f=i.apply(this,arguments);return l&&(this.onsuccess=this.onsuccess?rt(l,this.onsuccess):l),h&&(this.onerror=this.onerror?rt(h,this.onerror):h),f!==void 0?f:c}}function gt(n,i){return n===pe?i:function(){n.apply(this,arguments);var c=this.onsuccess,l=this.onerror;this.onsuccess=this.onerror=null,i.apply(this,arguments),c&&(this.onsuccess=this.onsuccess?rt(c,this.onsuccess):c),l&&(this.onerror=this.onerror?rt(l,this.onerror):l)}}function Pt(n,i){return n===pe?i:function(c){var l=n.apply(this,arguments);p(c,l);var h=this.onsuccess,f=this.onerror;return this.onsuccess=null,this.onerror=null,c=i.apply(this,arguments),h&&(this.onsuccess=this.onsuccess?rt(h,this.onsuccess):h),f&&(this.onerror=this.onerror?rt(f,this.onerror):f),l===void 0?c===void 0?void 0:c:p(l,c)}}function qr(n,i){return n===pe?i:function(){return i.apply(this,arguments)!==!1&&n.apply(this,arguments)}}function Ye(n,i){return n===pe?i:function(){var c=n.apply(this,arguments);if(c&&typeof c.then=="function"){for(var l=this,h=arguments.length,f=new Array(h);h--;)f[h]=arguments[h];return c.then(function(){return i.apply(l,f)})}return i.apply(this,arguments)}}ct.ModifyError=Zt,ct.DexieError=Ge,ct.BulkError=yt;var Ze=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function gr(n){Ze=n}var Nt={},Re=100,At=typeof Promise>"u"?[]:function(){var n=Promise.resolve();if(typeof crypto>"u"||!crypto.subtle)return[n,g(n),n];var i=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[i,g(i),n]}(),Oe=At[0],nt=At[1],At=At[2],nt=nt&&nt.then,xe=Oe&&Oe.constructor,Ae=!!At,$t=function(n,i){De.push([n,i]),Be&&(queueMicrotask(pn),Be=!1)},Lt=!0,Be=!0,re=[],Pe=[],vr=Ve,ut={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:pe,pgp:!1,env:{},finalize:pe},W=ut,De=[],vt=0,Fe=[];function q(n){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this._lib=!1;var i=this._PSD=W;if(typeof n!="function"){if(n!==Nt)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(this._state===!1&&wr(this,this._value))}this._state=null,this._value=null,++i.ref,function c(l,h){try{h(function(f){if(l._state===null){if(f===l)throw new TypeError("A promise cannot be resolved with itself.");var m=l._lib&&Ot();f&&typeof f.then=="function"?c(l,function(v,E){f instanceof q?f._then(v,E):f.then(v,E)}):(l._state=!0,l._value=f,rr(l)),m&&Ct()}},wr.bind(null,l))}catch(f){wr(l,f)}}(this,n)}var br={get:function(){var n=W,i=gn;function c(l,h){var f=this,m=!n.global&&(n!==W||i!==gn),v=m&&!Bt(),E=new q(function(_,P){_r(f,new tr(bi(l,n,m,v),bi(h,n,m,v),_,P,n))});return this._consoleTask&&(E._consoleTask=this._consoleTask),E}return c.prototype=Nt,c},set:function(n){$(this,"then",n&&n.prototype===Nt?br:{get:function(){return n},set:br.set})}};function tr(n,i,c,l,h){this.onFulfilled=typeof n=="function"?n:null,this.onRejected=typeof i=="function"?i:null,this.resolve=c,this.reject=l,this.psd=h}function wr(n,i){var c,l;Pe.push(i),n._state===null&&(c=n._lib&&Ot(),i=vr(i),n._state=!1,n._value=i,l=n,re.some(function(h){return h._value===l._value})||re.push(l),rr(n),c&&Ct())}function rr(n){var i=n._listeners;n._listeners=[];for(var c=0,l=i.length;c<l;++c)_r(n,i[c]);var h=n._PSD;--h.ref||h.finalize(),vt===0&&(++vt,$t(function(){--vt==0&&Ut()},[]))}function _r(n,i){if(n._state!==null){var c=n._state?i.onFulfilled:i.onRejected;if(c===null)return(n._state?i.resolve:i.reject)(n._value);++i.psd.ref,++vt,$t(kr,[c,n,i])}else n._listeners.push(i)}function kr(n,i,c){try{var l,h=i._value;!i._state&&Pe.length&&(Pe=[]),l=Ze&&i._consoleTask?i._consoleTask.run(function(){return n(h)}):n(h),i._state||Pe.indexOf(h)!==-1||function(f){for(var m=re.length;m;)if(re[--m]._value===f._value)return re.splice(m,1)}(i),c.resolve(l)}catch(f){c.reject(f)}finally{--vt==0&&Ut(),--c.psd.ref||c.psd.finalize()}}function pn(){sr(ut,function(){Ot()&&Ct()})}function Ot(){var n=Lt;return Be=Lt=!1,n}function Ct(){var n,i,c;do for(;0<De.length;)for(n=De,De=[],c=n.length,i=0;i<c;++i){var l=n[i];l[0].apply(null,l[1])}while(0<De.length);Be=Lt=!0}function Ut(){var n=re;re=[],n.forEach(function(l){l._PSD.onunhandled.call(null,l._value,l)});for(var i=Fe.slice(0),c=i.length;c;)i[--c]()}function nr(n){return new q(Nt,!1,n)}function we(n,i){var c=W;return function(){var l=Ot(),h=W;try{return Mt(c,!0),n.apply(this,arguments)}catch(f){i&&i(f)}finally{Mt(h,!1),l&&Ct()}}}D(q.prototype,{then:br,_then:function(n,i){_r(this,new tr(null,null,n,i,W))},catch:function(n){if(arguments.length===1)return this.then(null,n);var i=n,c=arguments[1];return typeof i=="function"?this.then(null,function(l){return(l instanceof i?c:nr)(l)}):this.then(null,function(l){return(l&&l.name===i?c:nr)(l)})},finally:function(n){return this.then(function(i){return q.resolve(n()).then(function(){return i})},function(i){return q.resolve(n()).then(function(){return nr(i)})})},timeout:function(n,i){var c=this;return n<1/0?new q(function(l,h){var f=setTimeout(function(){return h(new Y.Timeout(i))},n);c.then(l,h).finally(clearTimeout.bind(null,f))}):this}}),typeof Symbol<"u"&&Symbol.toStringTag&&$(q.prototype,Symbol.toStringTag,"Dexie.Promise"),ut.env=vi(),D(q,{all:function(){var n=He.apply(null,arguments).map(vn);return new q(function(i,c){n.length===0&&i([]);var l=n.length;n.forEach(function(h,f){return q.resolve(h).then(function(m){n[f]=m,--l||i(n)},c)})})},resolve:function(n){return n instanceof q?n:n&&typeof n.then=="function"?new q(function(i,c){n.then(i,c)}):new q(Nt,!0,n)},reject:nr,race:function(){var n=He.apply(null,arguments).map(vn);return new q(function(i,c){n.map(function(l){return q.resolve(l).then(i,c)})})},PSD:{get:function(){return W},set:function(n){return W=n}},totalEchoes:{get:function(){return gn}},newPSD:Ft,usePSD:sr,scheduler:{get:function(){return $t},set:function(n){$t=n}},rejectionMapper:{get:function(){return vr},set:function(n){vr=n}},follow:function(n,i){return new q(function(c,l){return Ft(function(h,f){var m=W;m.unhandleds=[],m.onunhandled=f,m.finalize=rt(function(){var v,E=this;v=function(){E.unhandleds.length===0?h():f(E.unhandleds[0])},Fe.push(function _(){v(),Fe.splice(Fe.indexOf(_),1)}),++vt,$t(function(){--vt==0&&Ut()},[])},m.finalize),n()},i,c,l)})}}),xe&&(xe.allSettled&&$(q,"allSettled",function(){var n=He.apply(null,arguments).map(vn);return new q(function(i){n.length===0&&i([]);var c=n.length,l=new Array(c);n.forEach(function(h,f){return q.resolve(h).then(function(m){return l[f]={status:"fulfilled",value:m}},function(m){return l[f]={status:"rejected",reason:m}}).then(function(){return--c||i(l)})})})}),xe.any&&typeof AggregateError<"u"&&$(q,"any",function(){var n=He.apply(null,arguments).map(vn);return new q(function(i,c){n.length===0&&c(new AggregateError([]));var l=n.length,h=new Array(l);n.forEach(function(f,m){return q.resolve(f).then(function(v){return i(v)},function(v){h[m]=v,--l||c(new AggregateError(h))})})})}));var Ne={awaits:0,echoes:0,id:0},go=0,mn=[],yn=0,gn=0,vo=0;function Ft(n,i,c,l){var h=W,f=Object.create(h);return f.parent=h,f.ref=0,f.global=!1,f.id=++vo,ut.env,f.env=Ae?{Promise:q,PromiseProp:{value:q,configurable:!0,writable:!0},all:q.all,race:q.race,allSettled:q.allSettled,any:q.any,resolve:q.resolve,reject:q.reject}:{},i&&p(f,i),++h.ref,f.finalize=function(){--this.parent.ref||this.parent.finalize()},l=sr(f,n,c,l),f.ref===0&&f.finalize(),l}function Er(){return Ne.id||(Ne.id=++go),++Ne.awaits,Ne.echoes+=Re,Ne.id}function Bt(){return!!Ne.awaits&&(--Ne.awaits==0&&(Ne.id=0),Ne.echoes=Ne.awaits*Re,!0)}function vn(n){return Ne.echoes&&n&&n.constructor===xe?(Er(),n.then(function(i){return Bt(),i},function(i){return Bt(),Ce(i)})):n}function bo(){var n=mn[mn.length-1];mn.pop(),Mt(n,!1)}function Mt(n,i){var c,l=W;(i?!Ne.echoes||yn++&&n===W:!yn||--yn&&n===W)||queueMicrotask(i?function(h){++gn,Ne.echoes&&--Ne.echoes!=0||(Ne.echoes=Ne.awaits=Ne.id=0),mn.push(W),Mt(h,!0)}.bind(null,n):bo),n!==W&&(W=n,l===ut&&(ut.env=vi()),Ae&&(c=ut.env.Promise,i=n.env,(l.global||n.global)&&(Object.defineProperty(a,"Promise",i.PromiseProp),c.all=i.all,c.race=i.race,c.resolve=i.resolve,c.reject=i.reject,i.allSettled&&(c.allSettled=i.allSettled),i.any&&(c.any=i.any))))}function vi(){var n=a.Promise;return Ae?{Promise:n,PromiseProp:Object.getOwnPropertyDescriptor(a,"Promise"),all:n.all,race:n.race,allSettled:n.allSettled,any:n.any,resolve:n.resolve,reject:n.reject}:{}}function sr(n,i,c,l,h){var f=W;try{return Mt(n,!0),i(c,l,h)}finally{Mt(f,!1)}}function bi(n,i,c,l){return typeof n!="function"?n:function(){var h=W;c&&Er(),Mt(i,!0);try{return n.apply(this,arguments)}finally{Mt(h,!1),l&&queueMicrotask(Bt)}}}function is(n){Promise===xe&&Ne.echoes===0?yn===0?n():enqueueNativeMicroTask(n):setTimeout(n,0)}(""+nt).indexOf("[native code]")===-1&&(Er=Bt=pe);var Ce=q.reject,ir="",Tt="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",wi="String expected.",Sr=[],bn="__dbnames",as="readonly",os="readwrite";function ar(n,i){return n?i?function(){return n.apply(this,arguments)&&i.apply(this,arguments)}:n:i}var _i={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function wn(n){return typeof n!="string"||/\./.test(n)?function(i){return i}:function(i){return i[n]===void 0&&n in i&&delete(i=Ee(i))[n],i}}function ki(){throw Y.Type()}function ge(n,i){try{var c=Ei(n),l=Ei(i);if(c!==l)return c==="Array"?1:l==="Array"?-1:c==="binary"?1:l==="binary"?-1:c==="string"?1:l==="string"?-1:c==="Date"?1:l!=="Date"?NaN:-1;switch(c){case"number":case"Date":case"string":return i<n?1:n<i?-1:0;case"binary":return function(h,f){for(var m=h.length,v=f.length,E=m<v?m:v,_=0;_<E;++_)if(h[_]!==f[_])return h[_]<f[_]?-1:1;return m===v?0:m<v?-1:1}(Si(n),Si(i));case"Array":return function(h,f){for(var m=h.length,v=f.length,E=m<v?m:v,_=0;_<E;++_){var P=ge(h[_],f[_]);if(P!==0)return P}return m===v?0:m<v?-1:1}(n,i)}}catch{}return NaN}function Ei(n){var i=typeof n;return i!="object"?i:ArrayBuffer.isView(n)?"binary":(n=Qt(n),n==="ArrayBuffer"?"binary":n)}function Si(n){return n instanceof Uint8Array?n:ArrayBuffer.isView(n)?new Uint8Array(n.buffer,n.byteOffset,n.byteLength):new Uint8Array(n)}var xi=(ke.prototype._trans=function(n,i,c){var l=this._tx||W.trans,h=this.name,f=Ze&&typeof console<"u"&&console.createTask&&console.createTask("Dexie: ".concat(n==="readonly"?"read":"write"," ").concat(this.name));function m(_,P,b){if(!b.schema[h])throw new Y.NotFound("Table "+h+" not part of transaction");return i(b.idbtrans,b)}var v=Ot();try{var E=l&&l.db._novip===this.db._novip?l===W.trans?l._promise(n,m,c):Ft(function(){return l._promise(n,m,c)},{trans:l,transless:W.transless||W}):function _(P,b,O,k){if(P.idbdb&&(P._state.openComplete||W.letThrough||P._vip)){var x=P._createTransaction(b,O,P._dbSchema);try{x.create(),P._state.PR1398_maxLoop=3}catch(C){return C.name===xt.InvalidState&&P.isOpen()&&0<--P._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),P.close({disableAutoOpen:!1}),P.open().then(function(){return _(P,b,O,k)})):Ce(C)}return x._promise(b,function(C,S){return Ft(function(){return W.trans=x,k(C,S,x)})}).then(function(C){if(b==="readwrite")try{x.idbtrans.commit()}catch{}return b==="readonly"?C:x._completion.then(function(){return C})})}if(P._state.openComplete)return Ce(new Y.DatabaseClosed(P._state.dbOpenError));if(!P._state.isBeingOpened){if(!P._state.autoOpen)return Ce(new Y.DatabaseClosed);P.open().catch(pe)}return P._state.dbReadyPromise.then(function(){return _(P,b,O,k)})}(this.db,n,[this.name],m);return f&&(E._consoleTask=f,E=E.catch(function(_){return console.trace(_),Ce(_)})),E}finally{v&&Ct()}},ke.prototype.get=function(n,i){var c=this;return n&&n.constructor===Object?this.where(n).first(i):n==null?Ce(new Y.Type("Invalid argument to Table.get()")):this._trans("readonly",function(l){return c.core.get({trans:l,key:n}).then(function(h){return c.hook.reading.fire(h)})}).then(i)},ke.prototype.where=function(n){if(typeof n=="string")return new this.db.WhereClause(this,n);if(d(n))return new this.db.WhereClause(this,"[".concat(n.join("+"),"]"));var i=u(n);if(i.length===1)return this.where(i[0]).equals(n[i[0]]);var c=this.schema.indexes.concat(this.schema.primKey).filter(function(E){if(E.compound&&i.every(function(P){return 0<=E.keyPath.indexOf(P)})){for(var _=0;_<i.length;++_)if(i.indexOf(E.keyPath[_])===-1)return!1;return!0}return!1}).sort(function(E,_){return E.keyPath.length-_.keyPath.length})[0];if(c&&this.db._maxKey!==ir){var m=c.keyPath.slice(0,i.length);return this.where(m).equals(m.map(function(_){return n[_]}))}!c&&Ze&&console.warn("The query ".concat(JSON.stringify(n)," on ").concat(this.name," would benefit from a ")+"compound index [".concat(i.join("+"),"]"));var l=this.schema.idxByName,h=this.db._deps.indexedDB;function f(E,_){return h.cmp(E,_)===0}var v=i.reduce(function(O,_){var P=O[0],b=O[1],O=l[_],k=n[_];return[P||O,P||!O?ar(b,O&&O.multi?function(x){return x=Le(x,_),d(x)&&x.some(function(C){return f(k,C)})}:function(x){return f(k,Le(x,_))}):b]},[null,null]),m=v[0],v=v[1];return m?this.where(m.name).equals(n[m.keyPath]).filter(v):c?this.filter(v):this.where(i).equals("")},ke.prototype.filter=function(n){return this.toCollection().and(n)},ke.prototype.count=function(n){return this.toCollection().count(n)},ke.prototype.offset=function(n){return this.toCollection().offset(n)},ke.prototype.limit=function(n){return this.toCollection().limit(n)},ke.prototype.each=function(n){return this.toCollection().each(n)},ke.prototype.toArray=function(n){return this.toCollection().toArray(n)},ke.prototype.toCollection=function(){return new this.db.Collection(new this.db.WhereClause(this))},ke.prototype.orderBy=function(n){return new this.db.Collection(new this.db.WhereClause(this,d(n)?"[".concat(n.join("+"),"]"):n))},ke.prototype.reverse=function(){return this.toCollection().reverse()},ke.prototype.mapToClass=function(n){var i,c=this.db,l=this.name;function h(){return i!==null&&i.apply(this,arguments)||this}(this.schema.mappedClass=n).prototype instanceof ki&&(function(E,_){if(typeof _!="function"&&_!==null)throw new TypeError("Class extends value "+String(_)+" is not a constructor or null");function P(){this.constructor=E}t(E,_),E.prototype=_===null?Object.create(_):(P.prototype=_.prototype,new P)}(h,i=n),Object.defineProperty(h.prototype,"db",{get:function(){return c},enumerable:!1,configurable:!0}),h.prototype.table=function(){return l},n=h);for(var f=new Set,m=n.prototype;m;m=g(m))Object.getOwnPropertyNames(m).forEach(function(E){return f.add(E)});function v(E){if(!E)return E;var _,P=Object.create(n.prototype);for(_ in E)if(!f.has(_))try{P[_]=E[_]}catch{}return P}return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=v,this.hook("reading",v),n},ke.prototype.defineClass=function(){return this.mapToClass(function(n){p(this,n)})},ke.prototype.add=function(n,i){var c=this,l=this.schema.primKey,h=l.auto,f=l.keyPath,m=n;return f&&h&&(m=wn(f)(n)),this._trans("readwrite",function(v){return c.core.mutate({trans:v,type:"add",keys:i!=null?[i]:null,values:[m]})}).then(function(v){return v.numFailures?q.reject(v.failures[0]):v.lastResult}).then(function(v){if(f)try{ye(n,f,v)}catch{}return v})},ke.prototype.update=function(n,i){return typeof n!="object"||d(n)?this.where(":id").equals(n).modify(i):(n=Le(n,this.schema.primKey.keyPath),n===void 0?Ce(new Y.InvalidArgument("Given object does not contain its primary key")):this.where(":id").equals(n).modify(i))},ke.prototype.put=function(n,i){var c=this,l=this.schema.primKey,h=l.auto,f=l.keyPath,m=n;return f&&h&&(m=wn(f)(n)),this._trans("readwrite",function(v){return c.core.mutate({trans:v,type:"put",values:[m],keys:i!=null?[i]:null})}).then(function(v){return v.numFailures?q.reject(v.failures[0]):v.lastResult}).then(function(v){if(f)try{ye(n,f,v)}catch{}return v})},ke.prototype.delete=function(n){var i=this;return this._trans("readwrite",function(c){return i.core.mutate({trans:c,type:"delete",keys:[n]})}).then(function(c){return c.numFailures?q.reject(c.failures[0]):void 0})},ke.prototype.clear=function(){var n=this;return this._trans("readwrite",function(i){return n.core.mutate({trans:i,type:"deleteRange",range:_i})}).then(function(i){return i.numFailures?q.reject(i.failures[0]):void 0})},ke.prototype.bulkGet=function(n){var i=this;return this._trans("readonly",function(c){return i.core.getMany({keys:n,trans:c}).then(function(l){return l.map(function(h){return i.hook.reading.fire(h)})})})},ke.prototype.bulkAdd=function(n,i,c){var l=this,h=Array.isArray(i)?i:void 0,f=(c=c||(h?void 0:i))?c.allKeys:void 0;return this._trans("readwrite",function(m){var _=l.schema.primKey,v=_.auto,_=_.keyPath;if(_&&h)throw new Y.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(h&&h.length!==n.length)throw new Y.InvalidArgument("Arguments objects and keys must have the same length");var E=n.length,_=_&&v?n.map(wn(_)):n;return l.core.mutate({trans:m,type:"add",keys:h,values:_,wantResults:f}).then(function(x){var b=x.numFailures,O=x.results,k=x.lastResult,x=x.failures;if(b===0)return f?O:k;throw new yt("".concat(l.name,".bulkAdd(): ").concat(b," of ").concat(E," operations failed"),x)})})},ke.prototype.bulkPut=function(n,i,c){var l=this,h=Array.isArray(i)?i:void 0,f=(c=c||(h?void 0:i))?c.allKeys:void 0;return this._trans("readwrite",function(m){var _=l.schema.primKey,v=_.auto,_=_.keyPath;if(_&&h)throw new Y.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(h&&h.length!==n.length)throw new Y.InvalidArgument("Arguments objects and keys must have the same length");var E=n.length,_=_&&v?n.map(wn(_)):n;return l.core.mutate({trans:m,type:"put",keys:h,values:_,wantResults:f}).then(function(x){var b=x.numFailures,O=x.results,k=x.lastResult,x=x.failures;if(b===0)return f?O:k;throw new yt("".concat(l.name,".bulkPut(): ").concat(b," of ").concat(E," operations failed"),x)})})},ke.prototype.bulkUpdate=function(n){var i=this,c=this.core,l=n.map(function(m){return m.key}),h=n.map(function(m){return m.changes}),f=[];return this._trans("readwrite",function(m){return c.getMany({trans:m,keys:l,cache:"clone"}).then(function(v){var E=[],_=[];n.forEach(function(b,O){var k=b.key,x=b.changes,C=v[O];if(C){for(var S=0,T=Object.keys(x);S<T.length;S++){var A=T[S],R=x[A];if(A===i.schema.primKey.keyPath){if(ge(R,k)!==0)throw new Y.Constraint("Cannot update primary key in bulkUpdate()")}else ye(C,A,R)}f.push(O),E.push(k),_.push(C)}});var P=E.length;return c.mutate({trans:m,type:"put",keys:E,values:_,updates:{keys:l,changeSpecs:h}}).then(function(b){var O=b.numFailures,k=b.failures;if(O===0)return P;for(var x=0,C=Object.keys(k);x<C.length;x++){var S,T=C[x],A=f[Number(T)];A!=null&&(S=k[T],delete k[T],k[A]=S)}throw new yt("".concat(i.name,".bulkUpdate(): ").concat(O," of ").concat(P," operations failed"),k)})})})},ke.prototype.bulkDelete=function(n){var i=this,c=n.length;return this._trans("readwrite",function(l){return i.core.mutate({trans:l,type:"delete",keys:n})}).then(function(m){var h=m.numFailures,f=m.lastResult,m=m.failures;if(h===0)return f;throw new yt("".concat(i.name,".bulkDelete(): ").concat(h," of ").concat(c," operations failed"),m)})},ke);function ke(){}function Kr(n){function i(m,v){if(v){for(var E=arguments.length,_=new Array(E-1);--E;)_[E-1]=arguments[E];return c[m].subscribe.apply(null,_),n}if(typeof m=="string")return c[m]}var c={};i.addEventType=f;for(var l=1,h=arguments.length;l<h;++l)f(arguments[l]);return i;function f(m,v,E){if(typeof m!="object"){var _;v=v||qr;var P={subscribers:[],fire:E=E||pe,subscribe:function(b){P.subscribers.indexOf(b)===-1&&(P.subscribers.push(b),P.fire=v(P.fire,b))},unsubscribe:function(b){P.subscribers=P.subscribers.filter(function(O){return O!==b}),P.fire=P.subscribers.reduce(v,E)}};return c[m]=i[m]=P}u(_=m).forEach(function(b){var O=_[b];if(d(O))f(b,_[b][0],_[b][1]);else{if(O!=="asap")throw new Y.InvalidArgument("Invalid event config");var k=f(b,Ve,function(){for(var x=arguments.length,C=new Array(x);x--;)C[x]=arguments[x];k.subscribers.forEach(function(S){Xe(function(){S.apply(null,C)})})})}})}}function zr(n,i){return L(i).from({prototype:n}),i}function xr(n,i){return!(n.filter||n.algorithm||n.or)&&(i?n.justLimit:!n.replayFilter)}function cs(n,i){n.filter=ar(n.filter,i)}function us(n,i,c){var l=n.replayFilter;n.replayFilter=l?function(){return ar(l(),i())}:i,n.justLimit=c&&!l}function _n(n,i){if(n.isPrimKey)return i.primaryKey;var c=i.getIndexByKeyPath(n.index);if(!c)throw new Y.Schema("KeyPath "+n.index+" on object store "+i.name+" is not indexed");return c}function Pi(n,i,c){var l=_n(n,i.schema);return i.openCursor({trans:c,values:!n.keysOnly,reverse:n.dir==="prev",unique:!!n.unique,query:{index:l,range:n.range}})}function kn(n,i,c,l){var h=n.replayFilter?ar(n.filter,n.replayFilter()):n.filter;if(n.or){var f={},m=function(v,E,_){var P,b;h&&!h(E,_,function(O){return E.stop(O)},function(O){return E.fail(O)})||((b=""+(P=E.primaryKey))=="[object ArrayBuffer]"&&(b=""+new Uint8Array(P)),w(f,b)||(f[b]=!0,i(v,E,_)))};return Promise.all([n.or._iterate(m,c),Oi(Pi(n,l,c),n.algorithm,m,!n.keysOnly&&n.valueMapper)])}return Oi(Pi(n,l,c),ar(n.algorithm,h),i,!n.keysOnly&&n.valueMapper)}function Oi(n,i,c,l){var h=we(l?function(f,m,v){return c(l(f),m,v)}:c);return n.then(function(f){if(f)return f.start(function(){var m=function(){return f.continue()};i&&!i(f,function(v){return m=v},function(v){f.stop(v),m=pe},function(v){f.fail(v),m=pe})||h(f.value,f,function(v){return m=v}),m()})})}var At=Symbol(),Hr=(Ci.prototype.execute=function(n){if(this.add!==void 0){var i=this.add;if(d(i))return o(o([],d(n)?n:[],!0),i,!0).sort();if(typeof i=="number")return(Number(n)||0)+i;if(typeof i=="bigint")try{return BigInt(n)+i}catch{return BigInt(0)+i}throw new TypeError("Invalid term ".concat(i))}if(this.remove!==void 0){var c=this.remove;if(d(c))return d(n)?n.filter(function(l){return!c.includes(l)}).sort():[];if(typeof c=="number")return Number(n)-c;if(typeof c=="bigint")try{return BigInt(n)-c}catch{return BigInt(0)-c}throw new TypeError("Invalid subtrahend ".concat(c))}return i=(i=this.replacePrefix)===null||i===void 0?void 0:i[0],i&&typeof n=="string"&&n.startsWith(i)?this.replacePrefix[1]+n.substring(i.length):n},Ci);function Ci(n){Object.assign(this,n)}var wo=(me.prototype._read=function(n,i){var c=this._ctx;return c.error?c.table._trans(null,Ce.bind(null,c.error)):c.table._trans("readonly",n).then(i)},me.prototype._write=function(n){var i=this._ctx;return i.error?i.table._trans(null,Ce.bind(null,i.error)):i.table._trans("readwrite",n,"locked")},me.prototype._addAlgorithm=function(n){var i=this._ctx;i.algorithm=ar(i.algorithm,n)},me.prototype._iterate=function(n,i){return kn(this._ctx,n,i,this._ctx.table.core)},me.prototype.clone=function(n){var i=Object.create(this.constructor.prototype),c=Object.create(this._ctx);return n&&p(c,n),i._ctx=c,i},me.prototype.raw=function(){return this._ctx.valueMapper=null,this},me.prototype.each=function(n){var i=this._ctx;return this._read(function(c){return kn(i,n,c,i.table.core)})},me.prototype.count=function(n){var i=this;return this._read(function(c){var l=i._ctx,h=l.table.core;if(xr(l,!0))return h.count({trans:c,query:{index:_n(l,h.schema),range:l.range}}).then(function(m){return Math.min(m,l.limit)});var f=0;return kn(l,function(){return++f,!1},c,h).then(function(){return f})}).then(n)},me.prototype.sortBy=function(n,i){var c=n.split(".").reverse(),l=c[0],h=c.length-1;function f(E,_){return _?f(E[c[_]],_-1):E[l]}var m=this._ctx.dir==="next"?1:-1;function v(E,_){return E=f(E,h),_=f(_,h),E<_?-m:_<E?m:0}return this.toArray(function(E){return E.sort(v)}).then(i)},me.prototype.toArray=function(n){var i=this;return this._read(function(c){var l=i._ctx;if(l.dir==="next"&&xr(l,!0)&&0<l.limit){var h=l.valueMapper,f=_n(l,l.table.core.schema);return l.table.core.query({trans:c,limit:l.limit,values:!0,query:{index:f,range:l.range}}).then(function(v){return v=v.result,h?v.map(h):v})}var m=[];return kn(l,function(v){return m.push(v)},c,l.table.core).then(function(){return m})},n)},me.prototype.offset=function(n){var i=this._ctx;return n<=0||(i.offset+=n,xr(i)?us(i,function(){var c=n;return function(l,h){return c===0||(c===1?--c:h(function(){l.advance(c),c=0}),!1)}}):us(i,function(){var c=n;return function(){return--c<0}})),this},me.prototype.limit=function(n){return this._ctx.limit=Math.min(this._ctx.limit,n),us(this._ctx,function(){var i=n;return function(c,l,h){return--i<=0&&l(h),0<=i}},!0),this},me.prototype.until=function(n,i){return cs(this._ctx,function(c,l,h){return!n(c.value)||(l(h),i)}),this},me.prototype.first=function(n){return this.limit(1).toArray(function(i){return i[0]}).then(n)},me.prototype.last=function(n){return this.reverse().first(n)},me.prototype.filter=function(n){var i;return cs(this._ctx,function(c){return n(c.value)}),(i=this._ctx).isMatch=ar(i.isMatch,n),this},me.prototype.and=function(n){return this.filter(n)},me.prototype.or=function(n){return new this.db.WhereClause(this._ctx.table,n,this)},me.prototype.reverse=function(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},me.prototype.desc=function(){return this.reverse()},me.prototype.eachKey=function(n){var i=this._ctx;return i.keysOnly=!i.isMatch,this.each(function(c,l){n(l.key,l)})},me.prototype.eachUniqueKey=function(n){return this._ctx.unique="unique",this.eachKey(n)},me.prototype.eachPrimaryKey=function(n){var i=this._ctx;return i.keysOnly=!i.isMatch,this.each(function(c,l){n(l.primaryKey,l)})},me.prototype.keys=function(n){var i=this._ctx;i.keysOnly=!i.isMatch;var c=[];return this.each(function(l,h){c.push(h.key)}).then(function(){return c}).then(n)},me.prototype.primaryKeys=function(n){var i=this._ctx;if(i.dir==="next"&&xr(i,!0)&&0<i.limit)return this._read(function(l){var h=_n(i,i.table.core.schema);return i.table.core.query({trans:l,values:!1,limit:i.limit,query:{index:h,range:i.range}})}).then(function(l){return l.result}).then(n);i.keysOnly=!i.isMatch;var c=[];return this.each(function(l,h){c.push(h.primaryKey)}).then(function(){return c}).then(n)},me.prototype.uniqueKeys=function(n){return this._ctx.unique="unique",this.keys(n)},me.prototype.firstKey=function(n){return this.limit(1).keys(function(i){return i[0]}).then(n)},me.prototype.lastKey=function(n){return this.reverse().firstKey(n)},me.prototype.distinct=function(){var n=this._ctx,n=n.index&&n.table.schema.idxByName[n.index];if(!n||!n.multi)return this;var i={};return cs(this._ctx,function(h){var l=h.primaryKey.toString(),h=w(i,l);return i[l]=!0,!h}),this},me.prototype.modify=function(n){var i=this,c=this._ctx;return this._write(function(l){var h,f,m;m=typeof n=="function"?n:(h=u(n),f=h.length,function(S){for(var T=!1,A=0;A<f;++A){var R=h[A],I=n[R],N=Le(S,R);I instanceof Hr?(ye(S,R,I.execute(N)),T=!0):N!==I&&(ye(S,R,I),T=!0)}return T});function v(S,R){var A=R.failures,R=R.numFailures;x+=S-R;for(var I=0,N=u(A);I<N.length;I++){var K=N[I];k.push(A[K])}}var E=c.table.core,_=E.schema.primaryKey,P=_.outbound,b=_.extractKey,O=i.db._options.modifyChunkSize||200,k=[],x=0,C=[];return i.clone().primaryKeys().then(function(S){function T(R){var I=Math.min(O,S.length-R);return E.getMany({trans:l,keys:S.slice(R,R+I),cache:"immutable"}).then(function(N){for(var K=[],U=[],M=P?[]:null,z=[],B=0;B<I;++B){var Z=N[B],ne={value:Ee(Z),primKey:S[R+B]};m.call(ne,ne.value,ne)!==!1&&(ne.value==null?z.push(S[R+B]):P||ge(b(Z),b(ne.value))===0?(U.push(ne.value),P&&M.push(S[R+B])):(z.push(S[R+B]),K.push(ne.value)))}return Promise.resolve(0<K.length&&E.mutate({trans:l,type:"add",values:K}).then(function(oe){for(var se in oe.failures)z.splice(parseInt(se),1);v(K.length,oe)})).then(function(){return(0<U.length||A&&typeof n=="object")&&E.mutate({trans:l,type:"put",keys:M,values:U,criteria:A,changeSpec:typeof n!="function"&&n,isAdditionalChunk:0<R}).then(function(oe){return v(U.length,oe)})}).then(function(){return(0<z.length||A&&n===ls)&&E.mutate({trans:l,type:"delete",keys:z,criteria:A,isAdditionalChunk:0<R}).then(function(oe){return v(z.length,oe)})}).then(function(){return S.length>R+I&&T(R+O)})})}var A=xr(c)&&c.limit===1/0&&(typeof n!="function"||n===ls)&&{index:c.index,range:c.range};return T(0).then(function(){if(0<k.length)throw new Zt("Error modifying one or more objects",k,x,C);return S.length})})})},me.prototype.delete=function(){var n=this._ctx,i=n.range;return xr(n)&&(n.isPrimKey||i.type===3)?this._write(function(c){var l=n.table.core.schema.primaryKey,h=i;return n.table.core.count({trans:c,query:{index:l,range:h}}).then(function(f){return n.table.core.mutate({trans:c,type:"deleteRange",range:h}).then(function(m){var v=m.failures;if(m.lastResult,m.results,m=m.numFailures,m)throw new Zt("Could not delete some values",Object.keys(v).map(function(E){return v[E]}),f-m);return f-m})})}):this.modify(ls)},me);function me(){}var ls=function(n,i){return i.value=null};function _o(n,i){return n<i?-1:n===i?0:1}function ko(n,i){return i<n?-1:n===i?0:1}function et(n,i,c){return n=n instanceof Ai?new n.Collection(n):n,n._ctx.error=new(c||TypeError)(i),n}function Pr(n){return new n.Collection(n,function(){return Ti("")}).limit(0)}function En(n,i,c,l){var h,f,m,v,E,_,P,b=c.length;if(!c.every(function(x){return typeof x=="string"}))return et(n,wi);function O(x){h=x==="next"?function(S){return S.toUpperCase()}:function(S){return S.toLowerCase()},f=x==="next"?function(S){return S.toLowerCase()}:function(S){return S.toUpperCase()},m=x==="next"?_o:ko;var C=c.map(function(S){return{lower:f(S),upper:h(S)}}).sort(function(S,T){return m(S.lower,T.lower)});v=C.map(function(S){return S.upper}),E=C.map(function(S){return S.lower}),P=(_=x)==="next"?"":l}O("next"),n=new n.Collection(n,function(){return qt(v[0],E[b-1]+l)}),n._ondirectionchange=function(x){O(x)};var k=0;return n._addAlgorithm(function(x,C,S){var T=x.key;if(typeof T!="string")return!1;var A=f(T);if(i(A,E,k))return!0;for(var R=null,I=k;I<b;++I){var N=function(K,U,M,z,B,Z){for(var ne=Math.min(K.length,z.length),oe=-1,se=0;se<ne;++se){var lt=U[se];if(lt!==z[se])return B(K[se],M[se])<0?K.substr(0,se)+M[se]+M.substr(se+1):B(K[se],z[se])<0?K.substr(0,se)+z[se]+M.substr(se+1):0<=oe?K.substr(0,oe)+U[oe]+M.substr(oe+1):null;B(K[se],lt)<0&&(oe=se)}return ne<z.length&&Z==="next"?K+M.substr(K.length):ne<K.length&&Z==="prev"?K.substr(0,M.length):oe<0?null:K.substr(0,oe)+z[oe]+M.substr(oe+1)}(T,A,v[I],E[I],m,_);N===null&&R===null?k=I+1:(R===null||0<m(R,N))&&(R=N)}return C(R!==null?function(){x.continue(R+P)}:S),!1}),n}function qt(n,i,c,l){return{type:2,lower:n,upper:i,lowerOpen:c,upperOpen:l}}function Ti(n){return{type:1,lower:n,upper:n}}var Ai=(Object.defineProperty($e.prototype,"Collection",{get:function(){return this._ctx.table.db.Collection},enumerable:!1,configurable:!0}),$e.prototype.between=function(n,i,c,l){c=c!==!1,l=l===!0;try{return 0<this._cmp(n,i)||this._cmp(n,i)===0&&(c||l)&&(!c||!l)?Pr(this):new this.Collection(this,function(){return qt(n,i,!c,!l)})}catch{return et(this,Tt)}},$e.prototype.equals=function(n){return n==null?et(this,Tt):new this.Collection(this,function(){return Ti(n)})},$e.prototype.above=function(n){return n==null?et(this,Tt):new this.Collection(this,function(){return qt(n,void 0,!0)})},$e.prototype.aboveOrEqual=function(n){return n==null?et(this,Tt):new this.Collection(this,function(){return qt(n,void 0,!1)})},$e.prototype.below=function(n){return n==null?et(this,Tt):new this.Collection(this,function(){return qt(void 0,n,!1,!0)})},$e.prototype.belowOrEqual=function(n){return n==null?et(this,Tt):new this.Collection(this,function(){return qt(void 0,n)})},$e.prototype.startsWith=function(n){return typeof n!="string"?et(this,wi):this.between(n,n+ir,!0,!0)},$e.prototype.startsWithIgnoreCase=function(n){return n===""?this.startsWith(n):En(this,function(i,c){return i.indexOf(c[0])===0},[n],ir)},$e.prototype.equalsIgnoreCase=function(n){return En(this,function(i,c){return i===c[0]},[n],"")},$e.prototype.anyOfIgnoreCase=function(){var n=He.apply(pt,arguments);return n.length===0?Pr(this):En(this,function(i,c){return c.indexOf(i)!==-1},n,"")},$e.prototype.startsWithAnyOfIgnoreCase=function(){var n=He.apply(pt,arguments);return n.length===0?Pr(this):En(this,function(i,c){return c.some(function(l){return i.indexOf(l)===0})},n,ir)},$e.prototype.anyOf=function(){var n=this,i=He.apply(pt,arguments),c=this._cmp;try{i.sort(c)}catch{return et(this,Tt)}if(i.length===0)return Pr(this);var l=new this.Collection(this,function(){return qt(i[0],i[i.length-1])});l._ondirectionchange=function(f){c=f==="next"?n._ascending:n._descending,i.sort(c)};var h=0;return l._addAlgorithm(function(f,m,v){for(var E=f.key;0<c(E,i[h]);)if(++h===i.length)return m(v),!1;return c(E,i[h])===0||(m(function(){f.continue(i[h])}),!1)}),l},$e.prototype.notEqual=function(n){return this.inAnyRange([[-1/0,n],[n,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})},$e.prototype.noneOf=function(){var n=He.apply(pt,arguments);if(n.length===0)return new this.Collection(this);try{n.sort(this._ascending)}catch{return et(this,Tt)}var i=n.reduce(function(c,l){return c?c.concat([[c[c.length-1][1],l]]):[[-1/0,l]]},null);return i.push([n[n.length-1],this.db._maxKey]),this.inAnyRange(i,{includeLowers:!1,includeUppers:!1})},$e.prototype.inAnyRange=function(T,i){var c=this,l=this._cmp,h=this._ascending,f=this._descending,m=this._min,v=this._max;if(T.length===0)return Pr(this);if(!T.every(function(A){return A[0]!==void 0&&A[1]!==void 0&&h(A[0],A[1])<=0}))return et(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",Y.InvalidArgument);var E=!i||i.includeLowers!==!1,_=i&&i.includeUppers===!0,P,b=h;function O(A,R){return b(A[0],R[0])}try{(P=T.reduce(function(A,R){for(var I=0,N=A.length;I<N;++I){var K=A[I];if(l(R[0],K[1])<0&&0<l(R[1],K[0])){K[0]=m(K[0],R[0]),K[1]=v(K[1],R[1]);break}}return I===N&&A.push(R),A},[])).sort(O)}catch{return et(this,Tt)}var k=0,x=_?function(A){return 0<h(A,P[k][1])}:function(A){return 0<=h(A,P[k][1])},C=E?function(A){return 0<f(A,P[k][0])}:function(A){return 0<=f(A,P[k][0])},S=x,T=new this.Collection(this,function(){return qt(P[0][0],P[P.length-1][1],!E,!_)});return T._ondirectionchange=function(A){b=A==="next"?(S=x,h):(S=C,f),P.sort(O)},T._addAlgorithm(function(A,R,I){for(var N,K=A.key;S(K);)if(++k===P.length)return R(I),!1;return!x(N=K)&&!C(N)||(c._cmp(K,P[k][1])===0||c._cmp(K,P[k][0])===0||R(function(){b===h?A.continue(P[k][0]):A.continue(P[k][1])}),!1)}),T},$e.prototype.startsWithAnyOf=function(){var n=He.apply(pt,arguments);return n.every(function(i){return typeof i=="string"})?n.length===0?Pr(this):this.inAnyRange(n.map(function(i){return[i,i+ir]})):et(this,"startsWithAnyOf() only works with strings")},$e);function $e(){}function bt(n){return we(function(i){return Jr(i),n(i.target.error),!1})}function Jr(n){n.stopPropagation&&n.stopPropagation(),n.preventDefault&&n.preventDefault()}var Vr="storagemutated",hs="x-storagemutated-1",Kt=Kr(null,Vr),Eo=(wt.prototype._lock=function(){return X(!W.global),++this._reculock,this._reculock!==1||W.global||(W.lockOwnerFor=this),this},wt.prototype._unlock=function(){if(X(!W.global),--this._reculock==0)for(W.global||(W.lockOwnerFor=null);0<this._blockedFuncs.length&&!this._locked();){var n=this._blockedFuncs.shift();try{sr(n[1],n[0])}catch{}}return this},wt.prototype._locked=function(){return this._reculock&&W.lockOwnerFor!==this},wt.prototype.create=function(n){var i=this;if(!this.mode)return this;var c=this.db.idbdb,l=this.db._state.dbOpenError;if(X(!this.idbtrans),!n&&!c)switch(l&&l.name){case"DatabaseClosedError":throw new Y.DatabaseClosed(l);case"MissingAPIError":throw new Y.MissingAPI(l.message,l);default:throw new Y.OpenFailed(l)}if(!this.active)throw new Y.TransactionInactive;return X(this._completion._state===null),(n=this.idbtrans=n||(this.db.core||c).transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability})).onerror=we(function(h){Jr(h),i._reject(n.error)}),n.onabort=we(function(h){Jr(h),i.active&&i._reject(new Y.Abort(n.error)),i.active=!1,i.on("abort").fire(h)}),n.oncomplete=we(function(){i.active=!1,i._resolve(),"mutatedParts"in n&&Kt.storagemutated.fire(n.mutatedParts)}),this},wt.prototype._promise=function(n,i,c){var l=this;if(n==="readwrite"&&this.mode!=="readwrite")return Ce(new Y.ReadOnly("Transaction is readonly"));if(!this.active)return Ce(new Y.TransactionInactive);if(this._locked())return new q(function(f,m){l._blockedFuncs.push([function(){l._promise(n,i,c).then(f,m)},W])});if(c)return Ft(function(){var f=new q(function(m,v){l._lock();var E=i(m,v,l);E&&E.then&&E.then(m,v)});return f.finally(function(){return l._unlock()}),f._lib=!0,f});var h=new q(function(f,m){var v=i(f,m,l);v&&v.then&&v.then(f,m)});return h._lib=!0,h},wt.prototype._root=function(){return this.parent?this.parent._root():this},wt.prototype.waitFor=function(n){var i,c=this._root(),l=q.resolve(n);c._waitingFor?c._waitingFor=c._waitingFor.then(function(){return l}):(c._waitingFor=l,c._waitingQueue=[],i=c.idbtrans.objectStore(c.storeNames[0]),function f(){for(++c._spinCount;c._waitingQueue.length;)c._waitingQueue.shift()();c._waitingFor&&(i.get(-1/0).onsuccess=f)}());var h=c._waitingFor;return new q(function(f,m){l.then(function(v){return c._waitingQueue.push(we(f.bind(null,v)))},function(v){return c._waitingQueue.push(we(m.bind(null,v)))}).finally(function(){c._waitingFor===h&&(c._waitingFor=null)})})},wt.prototype.abort=function(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new Y.Abort))},wt.prototype.table=function(n){var i=this._memoizedTables||(this._memoizedTables={});if(w(i,n))return i[n];var c=this.schema[n];if(!c)throw new Y.NotFound("Table "+n+" not part of transaction");return c=new this.db.Table(n,c,this),c.core=this.db.core.table(n),i[n]=c},wt);function wt(){}function ds(n,i,c,l,h,f,m){return{name:n,keyPath:i,unique:c,multi:l,auto:h,compound:f,src:(c&&!m?"&":"")+(l?"*":"")+(h?"++":"")+Ri(i)}}function Ri(n){return typeof n=="string"?n:n?"["+[].join.call(n,"+")+"]":""}function fs(n,i,c){return{name:n,primKey:i,indexes:c,mappedClass:null,idxByName:(l=function(h){return[h.name,h]},c.reduce(function(h,f,m){return m=l(f,m),m&&(h[m[0]]=m[1]),h},{}))};var l}var Wr=function(n){try{return n.only([[]]),Wr=function(){return[[]]},[[]]}catch{return Wr=function(){return ir},ir}};function ps(n){return n==null?function(){}:typeof n=="string"?(i=n).split(".").length===1?function(c){return c[i]}:function(c){return Le(c,i)}:function(c){return Le(c,n)};var i}function Ii(n){return[].slice.call(n)}var So=0;function Gr(n){return n==null?":id":typeof n=="string"?n:"[".concat(n.join("+"),"]")}function xo(n,i,E){function l(S){if(S.type===3)return null;if(S.type===4)throw new Error("Cannot convert never type to IDBKeyRange");var k=S.lower,x=S.upper,C=S.lowerOpen,S=S.upperOpen;return k===void 0?x===void 0?null:i.upperBound(x,!!S):x===void 0?i.lowerBound(k,!!C):i.bound(k,x,!!C,!!S)}function h(O){var k,x=O.name;return{name:x,schema:O,mutate:function(C){var S=C.trans,T=C.type,A=C.keys,R=C.values,I=C.range;return new Promise(function(N,K){N=we(N);var U=S.objectStore(x),M=U.keyPath==null,z=T==="put"||T==="add";if(!z&&T!=="delete"&&T!=="deleteRange")throw new Error("Invalid operation type: "+T);var B,Z=(A||R||{length:1}).length;if(A&&R&&A.length!==R.length)throw new Error("Given keys array must have same length as given values array.");if(Z===0)return N({numFailures:0,failures:{},results:[],lastResult:void 0});function ne(We){++lt,Jr(We)}var oe=[],se=[],lt=0;if(T==="deleteRange"){if(I.type===4)return N({numFailures:lt,failures:se,results:[],lastResult:void 0});I.type===3?oe.push(B=U.clear()):oe.push(B=U.delete(l(I)))}else{var M=z?M?[R,A]:[R,null]:[A,null],ie=M[0],qe=M[1];if(z)for(var Ke=0;Ke<Z;++Ke)oe.push(B=qe&&qe[Ke]!==void 0?U[T](ie[Ke],qe[Ke]):U[T](ie[Ke])),B.onerror=ne;else for(Ke=0;Ke<Z;++Ke)oe.push(B=U[T](ie[Ke])),B.onerror=ne}function $n(We){We=We.target.result,oe.forEach(function(ur,js){return ur.error!=null&&(se[js]=ur.error)}),N({numFailures:lt,failures:se,results:T==="delete"?A:oe.map(function(ur){return ur.result}),lastResult:We})}B.onerror=function(We){ne(We),$n(We)},B.onsuccess=$n})},getMany:function(C){var S=C.trans,T=C.keys;return new Promise(function(A,R){A=we(A);for(var I,N=S.objectStore(x),K=T.length,U=new Array(K),M=0,z=0,B=function(oe){oe=oe.target,U[oe._pos]=oe.result,++z===M&&A(U)},Z=bt(R),ne=0;ne<K;++ne)T[ne]!=null&&((I=N.get(T[ne]))._pos=ne,I.onsuccess=B,I.onerror=Z,++M);M===0&&A(U)})},get:function(C){var S=C.trans,T=C.key;return new Promise(function(A,R){A=we(A);var I=S.objectStore(x).get(T);I.onsuccess=function(N){return A(N.target.result)},I.onerror=bt(R)})},query:(k=_,function(C){return new Promise(function(S,T){S=we(S);var A,R,I,M=C.trans,N=C.values,K=C.limit,B=C.query,U=K===1/0?void 0:K,z=B.index,B=B.range,M=M.objectStore(x),z=z.isPrimaryKey?M:M.index(z.name),B=l(B);if(K===0)return S({result:[]});k?((U=N?z.getAll(B,U):z.getAllKeys(B,U)).onsuccess=function(Z){return S({result:Z.target.result})},U.onerror=bt(T)):(A=0,R=!N&&"openKeyCursor"in z?z.openKeyCursor(B):z.openCursor(B),I=[],R.onsuccess=function(Z){var ne=R.result;return ne?(I.push(N?ne.value:ne.primaryKey),++A===K?S({result:I}):void ne.continue()):S({result:I})},R.onerror=bt(T))})}),openCursor:function(C){var S=C.trans,T=C.values,A=C.query,R=C.reverse,I=C.unique;return new Promise(function(N,K){N=we(N);var z=A.index,U=A.range,M=S.objectStore(x),M=z.isPrimaryKey?M:M.index(z.name),z=R?I?"prevunique":"prev":I?"nextunique":"next",B=!T&&"openKeyCursor"in M?M.openKeyCursor(l(U),z):M.openCursor(l(U),z);B.onerror=bt(K),B.onsuccess=we(function(Z){var ne,oe,se,lt,ie=B.result;ie?(ie.___id=++So,ie.done=!1,ne=ie.continue.bind(ie),oe=(oe=ie.continuePrimaryKey)&&oe.bind(ie),se=ie.advance.bind(ie),lt=function(){throw new Error("Cursor not stopped")},ie.trans=S,ie.stop=ie.continue=ie.continuePrimaryKey=ie.advance=function(){throw new Error("Cursor not started")},ie.fail=we(K),ie.next=function(){var qe=this,Ke=1;return this.start(function(){return Ke--?qe.continue():qe.stop()}).then(function(){return qe})},ie.start=function(qe){function Ke(){if(B.result)try{qe()}catch(We){ie.fail(We)}else ie.done=!0,ie.start=function(){throw new Error("Cursor behind last entry")},ie.stop()}var $n=new Promise(function(We,ur){We=we(We),B.onerror=bt(ur),ie.fail=ur,ie.stop=function(js){ie.stop=ie.continue=ie.continuePrimaryKey=ie.advance=lt,We(js)}});return B.onsuccess=we(function(We){B.onsuccess=Ke,Ke()}),ie.continue=ne,ie.continuePrimaryKey=oe,ie.advance=se,Ke(),$n},N(ie)):N(null)},K)})},count:function(C){var S=C.query,T=C.trans,A=S.index,R=S.range;return new Promise(function(I,N){var K=T.objectStore(x),U=A.isPrimaryKey?K:K.index(A.name),K=l(R),U=K?U.count(K):U.count();U.onsuccess=we(function(M){return I(M.target.result)}),U.onerror=bt(N)})}}}var f,m,v,P=(m=E,v=Ii((f=n).objectStoreNames),{schema:{name:f.name,tables:v.map(function(O){return m.objectStore(O)}).map(function(O){var k=O.keyPath,S=O.autoIncrement,x=d(k),C={},S={name:O.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:k==null,compound:x,keyPath:k,autoIncrement:S,unique:!0,extractKey:ps(k)},indexes:Ii(O.indexNames).map(function(T){return O.index(T)}).map(function(I){var A=I.name,R=I.unique,N=I.multiEntry,I=I.keyPath,N={name:A,compound:d(I),keyPath:I,unique:R,multiEntry:N,extractKey:ps(I)};return C[Gr(I)]=N}),getIndexByKeyPath:function(T){return C[Gr(T)]}};return C[":id"]=S.primaryKey,k!=null&&(C[Gr(k)]=S.primaryKey),S})},hasGetAll:0<v.length&&"getAll"in m.objectStore(v[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}),E=P.schema,_=P.hasGetAll,P=E.tables.map(h),b={};return P.forEach(function(O){return b[O.name]=O}),{stack:"dbcore",transaction:n.transaction.bind(n),table:function(O){if(!b[O])throw new Error("Table '".concat(O,"' not found"));return b[O]},MIN_KEY:-1/0,MAX_KEY:Wr(i),schema:E}}function Po(n,i,c,l){var h=c.IDBKeyRange;return c.indexedDB,{dbcore:(l=xo(i,h,l),n.dbcore.reduce(function(f,m){return m=m.create,r(r({},f),m(f))},l))}}function Sn(n,l){var c=l.db,l=Po(n._middlewares,c,n._deps,l);n.core=l.dbcore,n.tables.forEach(function(h){var f=h.name;n.core.schema.tables.some(function(m){return m.name===f})&&(h.core=n.core.table(f),n[f]instanceof n.Table&&(n[f].core=h.core))})}function xn(n,i,c,l){c.forEach(function(h){var f=l[h];i.forEach(function(m){var v=function E(_,P){return V(_,P)||(_=g(_))&&E(_,P)}(m,h);(!v||"value"in v&&v.value===void 0)&&(m===n.Transaction.prototype||m instanceof n.Transaction?$(m,h,{get:function(){return this.table(h)},set:function(E){F(this,h,{value:E,writable:!0,configurable:!0,enumerable:!0})}}):m[h]=new n.Table(h,f))})})}function ms(n,i){i.forEach(function(c){for(var l in c)c[l]instanceof n.Table&&delete c[l]})}function Oo(n,i){return n._cfg.version-i._cfg.version}function Co(n,i,c,l){var h=n._dbSchema;c.objectStoreNames.contains("$meta")&&!h.$meta&&(h.$meta=fs("$meta",Di("")[0],[]),n._storeNames.push("$meta"));var f=n._createTransaction("readwrite",n._storeNames,h);f.create(c),f._completion.catch(l);var m=f._reject.bind(f),v=W.transless||W;Ft(function(){return W.trans=f,W.transless=v,i!==0?(Sn(n,c),_=i,((E=f).storeNames.includes("$meta")?E.table("$meta").get("version").then(function(P){return P??_}):q.resolve(_)).then(function(P){return O=P,k=f,x=c,C=[],P=(b=n)._versions,S=b._dbSchema=On(0,b.idbdb,x),(P=P.filter(function(T){return T._cfg.version>=O})).length!==0?(P.forEach(function(T){C.push(function(){var A=S,R=T._cfg.dbschema;Cn(b,A,x),Cn(b,R,x),S=b._dbSchema=R;var I=ys(A,R);I.add.forEach(function(z){gs(x,z[0],z[1].primKey,z[1].indexes)}),I.change.forEach(function(z){if(z.recreate)throw new Y.Upgrade("Not yet support for changing primary key");var B=x.objectStore(z.name);z.add.forEach(function(Z){return Pn(B,Z)}),z.change.forEach(function(Z){B.deleteIndex(Z.name),Pn(B,Z)}),z.del.forEach(function(Z){return B.deleteIndex(Z)})});var N=T._cfg.contentUpgrade;if(N&&T._cfg.version>O){Sn(b,x),k._memoizedTables={};var K=jt(R);I.del.forEach(function(z){K[z]=A[z]}),ms(b,[b.Transaction.prototype]),xn(b,[b.Transaction.prototype],u(K),K),k.schema=K;var U,M=Ue(N);return M&&Er(),I=q.follow(function(){var z;(U=N(k))&&M&&(z=Bt.bind(null,null),U.then(z,z))}),U&&typeof U.then=="function"?q.resolve(U):I.then(function(){return U})}}),C.push(function(A){var R,I,N=T._cfg.dbschema;R=N,I=A,[].slice.call(I.db.objectStoreNames).forEach(function(K){return R[K]==null&&I.db.deleteObjectStore(K)}),ms(b,[b.Transaction.prototype]),xn(b,[b.Transaction.prototype],b._storeNames,b._dbSchema),k.schema=b._dbSchema}),C.push(function(A){b.idbdb.objectStoreNames.contains("$meta")&&(Math.ceil(b.idbdb.version/10)===T._cfg.version?(b.idbdb.deleteObjectStore("$meta"),delete b._dbSchema.$meta,b._storeNames=b._storeNames.filter(function(R){return R!=="$meta"})):A.objectStore("$meta").put(T._cfg.version,"version"))})}),function T(){return C.length?q.resolve(C.shift()(k.idbtrans)).then(T):q.resolve()}().then(function(){ji(S,x)})):q.resolve();var b,O,k,x,C,S}).catch(m)):(u(h).forEach(function(P){gs(c,P,h[P].primKey,h[P].indexes)}),Sn(n,c),void q.follow(function(){return n.on.populate.fire(f)}).catch(m));var E,_})}function To(n,i){ji(n._dbSchema,i),i.db.version%10!=0||i.objectStoreNames.contains("$meta")||i.db.createObjectStore("$meta").add(Math.ceil(i.db.version/10-1),"version");var c=On(0,n.idbdb,i);Cn(n,n._dbSchema,i);for(var l=0,h=ys(c,n._dbSchema).change;l<h.length;l++){var f=function(m){if(m.change.length||m.recreate)return console.warn("Unable to patch indexes of table ".concat(m.name," because it has changes on the type of index or primary key.")),{value:void 0};var v=i.objectStore(m.name);m.add.forEach(function(E){Ze&&console.debug("Dexie upgrade patch: Creating missing index ".concat(m.name,".").concat(E.src)),Pn(v,E)})}(h[l]);if(typeof f=="object")return f.value}}function ys(n,i){var c,l={del:[],add:[],change:[]};for(c in n)i[c]||l.del.push(c);for(c in i){var h=n[c],f=i[c];if(h){var m={name:c,def:f,recreate:!1,del:[],add:[],change:[]};if(""+(h.primKey.keyPath||"")!=""+(f.primKey.keyPath||"")||h.primKey.auto!==f.primKey.auto)m.recreate=!0,l.change.push(m);else{var v=h.idxByName,E=f.idxByName,_=void 0;for(_ in v)E[_]||m.del.push(_);for(_ in E){var P=v[_],b=E[_];P?P.src!==b.src&&m.change.push(b):m.add.push(b)}(0<m.del.length||0<m.add.length||0<m.change.length)&&l.change.push(m)}}else l.add.push([c,f])}return l}function gs(n,i,c,l){var h=n.db.createObjectStore(i,c.keyPath?{keyPath:c.keyPath,autoIncrement:c.auto}:{autoIncrement:c.auto});return l.forEach(function(f){return Pn(h,f)}),h}function ji(n,i){u(n).forEach(function(c){i.db.objectStoreNames.contains(c)||(Ze&&console.debug("Dexie: Creating missing table",c),gs(i,c,n[c].primKey,n[c].indexes))})}function Pn(n,i){n.createIndex(i.name,i.keyPath,{unique:i.unique,multiEntry:i.multi})}function On(n,i,c){var l={};return le(i.objectStoreNames,0).forEach(function(h){for(var f=c.objectStore(h),m=ds(Ri(_=f.keyPath),_||"",!0,!1,!!f.autoIncrement,_&&typeof _!="string",!0),v=[],E=0;E<f.indexNames.length;++E){var P=f.index(f.indexNames[E]),_=P.keyPath,P=ds(P.name,_,!!P.unique,!!P.multiEntry,!1,_&&typeof _!="string",!1);v.push(P)}l[h]=fs(h,m,v)}),l}function Cn(n,i,c){for(var l=c.db.objectStoreNames,h=0;h<l.length;++h){var f=l[h],m=c.objectStore(f);n._hasGetAll="getAll"in m;for(var v=0;v<m.indexNames.length;++v){var E=m.indexNames[v],_=m.index(E).keyPath,P=typeof _=="string"?_:"["+le(_).join("+")+"]";!i[f]||(_=i[f].idxByName[P])&&(_.name=E,delete i[f].idxByName[P],i[f].idxByName[E]=_)}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&a.WorkerGlobalScope&&a instanceof a.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(n._hasGetAll=!1)}function Di(n){return n.split(",").map(function(i,c){var l=(i=i.trim()).replace(/([&*]|\+\+)/g,""),h=/^\[/.test(l)?l.match(/^\[(.*)\]$/)[1].split("+"):l;return ds(l,h||null,/\&/.test(i),/\*/.test(i),/\+\+/.test(i),d(h),c===0)})}var Ao=(Tn.prototype._parseStoresSpec=function(n,i){u(n).forEach(function(c){if(n[c]!==null){var l=Di(n[c]),h=l.shift();if(h.unique=!0,h.multi)throw new Y.Schema("Primary key cannot be multi-valued");l.forEach(function(f){if(f.auto)throw new Y.Schema("Only primary key can be marked as autoIncrement (++)");if(!f.keyPath)throw new Y.Schema("Index must have a name and cannot be an empty string")}),i[c]=fs(c,h,l)}})},Tn.prototype.stores=function(c){var i=this.db;this._cfg.storesSource=this._cfg.storesSource?p(this._cfg.storesSource,c):c;var c=i._versions,l={},h={};return c.forEach(function(f){p(l,f._cfg.storesSource),h=f._cfg.dbschema={},f._parseStoresSpec(l,h)}),i._dbSchema=h,ms(i,[i._allTables,i,i.Transaction.prototype]),xn(i,[i._allTables,i,i.Transaction.prototype,this._cfg.tables],u(h),h),i._storeNames=u(h),this},Tn.prototype.upgrade=function(n){return this._cfg.contentUpgrade=Ye(this._cfg.contentUpgrade||pe,n),this},Tn);function Tn(){}function vs(n,i){var c=n._dbNamesDB;return c||(c=n._dbNamesDB=new Rt(bn,{addons:[],indexedDB:n,IDBKeyRange:i})).version(1).stores({dbnames:"name"}),c.table("dbnames")}function bs(n){return n&&typeof n.databases=="function"}function ws(n){return Ft(function(){return W.letThrough=!0,n()})}function _s(n){return!("from"in n)}var Me=function(n,i){if(!this){var c=new Me;return n&&"d"in n&&p(c,n),c}p(this,arguments.length?{d:1,from:n,to:1<arguments.length?i:n}:{d:0})};function Yr(n,i,c){var l=ge(i,c);if(!isNaN(l)){if(0<l)throw RangeError();if(_s(n))return p(n,{from:i,to:c,d:1});var h=n.l,l=n.r;if(ge(c,n.from)<0)return h?Yr(h,i,c):n.l={from:i,to:c,d:1,l:null,r:null},Ni(n);if(0<ge(i,n.to))return l?Yr(l,i,c):n.r={from:i,to:c,d:1,l:null,r:null},Ni(n);ge(i,n.from)<0&&(n.from=i,n.l=null,n.d=l?l.d+1:1),0<ge(c,n.to)&&(n.to=c,n.r=null,n.d=n.l?n.l.d+1:1),c=!n.r,h&&!n.l&&Xr(n,h),l&&c&&Xr(n,l)}}function Xr(n,i){_s(i)||function c(l,E){var f=E.from,m=E.to,v=E.l,E=E.r;Yr(l,f,m),v&&c(l,v),E&&c(l,E)}(n,i)}function An(n,i){var c=ks(i),l=c.next();if(l.done)return!1;for(var h=l.value,f=ks(n),m=f.next(h.from),v=m.value;!l.done&&!m.done;){if(ge(v.from,h.to)<=0&&0<=ge(v.to,h.from))return!0;ge(h.from,v.from)<0?h=(l=c.next(v.from)).value:v=(m=f.next(h.from)).value}return!1}function ks(n){var i=_s(n)?null:{s:0,n};return{next:function(c){for(var l=0<arguments.length;i;)switch(i.s){case 0:if(i.s=1,l)for(;i.n.l&&ge(c,i.n.from)<0;)i={up:i,n:i.n.l,s:1};else for(;i.n.l;)i={up:i,n:i.n.l,s:1};case 1:if(i.s=2,!l||ge(c,i.n.to)<=0)return{value:i.n,done:!1};case 2:if(i.n.r){i.s=3,i={up:i,n:i.n.r,s:0};continue}case 3:i=i.up}return{done:!0}}}}function Ni(n){var i,c,l=(((i=n.r)===null||i===void 0?void 0:i.d)||0)-(((c=n.l)===null||c===void 0?void 0:c.d)||0),h=1<l?"r":l<-1?"l":"";h&&(i=h=="r"?"l":"r",c=r({},n),l=n[h],n.from=l.from,n.to=l.to,n[h]=l[h],c[h]=l[i],(n[i]=c).d=$i(c)),n.d=$i(n)}function $i(c){var i=c.r,c=c.l;return(i?c?Math.max(i.d,c.d):i.d:c?c.d:0)+1}function Rn(n,i){return u(i).forEach(function(c){n[c]?Xr(n[c],i[c]):n[c]=function l(h){var f,m,v={};for(f in h)w(h,f)&&(m=h[f],v[f]=!m||typeof m!="object"||Xt.has(m.constructor)?m:l(m));return v}(i[c])}),n}function Es(n,i){return n.all||i.all||Object.keys(n).some(function(c){return i[c]&&An(i[c],n[c])})}D(Me.prototype,((nt={add:function(n){return Xr(this,n),this},addKey:function(n){return Yr(this,n,n),this},addKeys:function(n){var i=this;return n.forEach(function(c){return Yr(i,c,c)}),this}})[ot]=function(){return ks(this)},nt));var or={},Ss={},xs=!1;function In(n){Rn(Ss,n),xs||(xs=!0,setTimeout(function(){xs=!1,Ps(Ss,!(Ss={}))},0))}function Ps(n,i){i===void 0&&(i=!1);var c=new Set;if(n.all)for(var l=0,h=Object.values(or);l<h.length;l++)Li(m=h[l],n,c,i);else for(var f in n){var m,v=/^idb\:\/\/(.*)\/(.*)\//.exec(f);v&&(f=v[1],v=v[2],(m=or["idb://".concat(f,"/").concat(v)])&&Li(m,n,c,i))}c.forEach(function(E){return E()})}function Li(n,i,c,l){for(var h=[],f=0,m=Object.entries(n.queries.query);f<m.length;f++){for(var v=m[f],E=v[0],_=[],P=0,b=v[1];P<b.length;P++){var O=b[P];Es(i,O.obsSet)?O.subscribers.forEach(function(S){return c.add(S)}):l&&_.push(O)}l&&h.push([E,_])}if(l)for(var k=0,x=h;k<x.length;k++){var C=x[k],E=C[0],_=C[1];n.queries.query[E]=_}}function Ro(n){var i=n._state,c=n._deps.indexedDB;if(i.isBeingOpened||n.idbdb)return i.dbReadyPromise.then(function(){return i.dbOpenError?Ce(i.dbOpenError):n});i.isBeingOpened=!0,i.dbOpenError=null,i.openComplete=!1;var l=i.openCanceller,h=Math.round(10*n.verno),f=!1;function m(){if(i.openCanceller!==l)throw new Y.DatabaseClosed("db.open() was cancelled")}function v(){return new q(function(O,k){if(m(),!c)throw new Y.MissingAPI;var x=n.name,C=i.autoSchema||!h?c.open(x):c.open(x,h);if(!C)throw new Y.MissingAPI;C.onerror=bt(k),C.onblocked=we(n._fireOnBlocked),C.onupgradeneeded=we(function(S){var T;P=C.transaction,i.autoSchema&&!n._options.allowEmptyDB?(C.onerror=Jr,P.abort(),C.result.close(),(T=c.deleteDatabase(x)).onsuccess=T.onerror=we(function(){k(new Y.NoSuchDatabase("Database ".concat(x," doesnt exist")))})):(P.onerror=bt(k),S=S.oldVersion>Math.pow(2,62)?0:S.oldVersion,b=S<1,n.idbdb=C.result,f&&To(n,P),Co(n,S/10,P,k))},k),C.onsuccess=we(function(){P=null;var S,T,A,R,I,N=n.idbdb=C.result,K=le(N.objectStoreNames);if(0<K.length)try{var U=N.transaction((R=K).length===1?R[0]:R,"readonly");if(i.autoSchema)T=N,A=U,(S=n).verno=T.version/10,A=S._dbSchema=On(0,T,A),S._storeNames=le(T.objectStoreNames,0),xn(S,[S._allTables],u(A),A);else if(Cn(n,n._dbSchema,U),((I=ys(On(0,(I=n).idbdb,U),I._dbSchema)).add.length||I.change.some(function(M){return M.add.length||M.change.length}))&&!f)return console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Dexie will add missing parts and increment native version number to workaround this."),N.close(),h=N.version+1,f=!0,O(v());Sn(n,U)}catch{}Sr.push(n),N.onversionchange=we(function(M){i.vcFired=!0,n.on("versionchange").fire(M)}),N.onclose=we(function(M){n.on("close").fire(M)}),b&&(I=n._deps,U=x,N=I.indexedDB,I=I.IDBKeyRange,bs(N)||U===bn||vs(N,I).put({name:U}).catch(pe)),O()},k)}).catch(function(O){switch(O?.name){case"UnknownError":if(0<i.PR1398_maxLoop)return i.PR1398_maxLoop--,console.warn("Dexie: Workaround for Chrome UnknownError on open()"),v();break;case"VersionError":if(0<h)return h=0,v()}return q.reject(O)})}var E,_=i.dbReadyResolve,P=null,b=!1;return q.race([l,(typeof navigator>"u"?q.resolve():!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(O){function k(){return indexedDB.databases().finally(O)}E=setInterval(k,100),k()}).finally(function(){return clearInterval(E)}):Promise.resolve()).then(v)]).then(function(){return m(),i.onReadyBeingFired=[],q.resolve(ws(function(){return n.on.ready.fire(n.vip)})).then(function O(){if(0<i.onReadyBeingFired.length){var k=i.onReadyBeingFired.reduce(Ye,pe);return i.onReadyBeingFired=[],q.resolve(ws(function(){return k(n.vip)})).then(O)}})}).finally(function(){i.openCanceller===l&&(i.onReadyBeingFired=null,i.isBeingOpened=!1)}).catch(function(O){i.dbOpenError=O;try{P&&P.abort()}catch{}return l===i.openCanceller&&n._close(),Ce(O)}).finally(function(){i.openComplete=!0,_()}).then(function(){var O;return b&&(O={},n.tables.forEach(function(k){k.schema.indexes.forEach(function(x){x.name&&(O["idb://".concat(n.name,"/").concat(k.name,"/").concat(x.name)]=new Me(-1/0,[[[]]]))}),O["idb://".concat(n.name,"/").concat(k.name,"/")]=O["idb://".concat(n.name,"/").concat(k.name,"/:dels")]=new Me(-1/0,[[[]]])}),Kt(Vr).fire(O),Ps(O,!0)),n})}function Os(n){function i(f){return n.next(f)}var c=h(i),l=h(function(f){return n.throw(f)});function h(f){return function(E){var v=f(E),E=v.value;return v.done?E:E&&typeof E.then=="function"?E.then(c,l):d(E)?Promise.all(E).then(c,l):c(E)}}return h(i)()}function jn(n,i,c){for(var l=d(n)?n.slice():[n],h=0;h<c;++h)l.push(i);return l}var Io={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(n){return r(r({},n),{table:function(i){var c=n.table(i),l=c.schema,h={},f=[];function m(b,O,k){var x=Gr(b),C=h[x]=h[x]||[],S=b==null?0:typeof b=="string"?1:b.length,T=0<O,T=r(r({},k),{name:T?"".concat(x,"(virtual-from:").concat(k.name,")"):k.name,lowLevelIndex:k,isVirtual:T,keyTail:O,keyLength:S,extractKey:ps(b),unique:!T&&k.unique});return C.push(T),T.isPrimaryKey||f.push(T),1<S&&m(S===2?b[0]:b.slice(0,S-1),O+1,k),C.sort(function(A,R){return A.keyTail-R.keyTail}),T}i=m(l.primaryKey.keyPath,0,l.primaryKey),h[":id"]=[i];for(var v=0,E=l.indexes;v<E.length;v++){var _=E[v];m(_.keyPath,0,_)}function P(b){var O,k=b.query.index;return k.isVirtual?r(r({},b),{query:{index:k.lowLevelIndex,range:(O=b.query.range,k=k.keyTail,{type:O.type===1?2:O.type,lower:jn(O.lower,O.lowerOpen?n.MAX_KEY:n.MIN_KEY,k),lowerOpen:!0,upper:jn(O.upper,O.upperOpen?n.MIN_KEY:n.MAX_KEY,k),upperOpen:!0})}}):b}return r(r({},c),{schema:r(r({},l),{primaryKey:i,indexes:f,getIndexByKeyPath:function(b){return(b=h[Gr(b)])&&b[0]}}),count:function(b){return c.count(P(b))},query:function(b){return c.query(P(b))},openCursor:function(b){var O=b.query.index,k=O.keyTail,x=O.isVirtual,C=O.keyLength;return x?c.openCursor(P(b)).then(function(T){return T&&S(T)}):c.openCursor(b);function S(T){return Object.create(T,{continue:{value:function(A){A!=null?T.continue(jn(A,b.reverse?n.MAX_KEY:n.MIN_KEY,k)):b.unique?T.continue(T.key.slice(0,C).concat(b.reverse?n.MIN_KEY:n.MAX_KEY,k)):T.continue()}},continuePrimaryKey:{value:function(A,R){T.continuePrimaryKey(jn(A,n.MAX_KEY,k),R)}},primaryKey:{get:function(){return T.primaryKey}},key:{get:function(){var A=T.key;return C===1?A[0]:A.slice(0,C)}},value:{get:function(){return T.value}}})}}})}})}};function Cs(n,i,c,l){return c=c||{},l=l||"",u(n).forEach(function(h){var f,m,v;w(i,h)?(f=n[h],m=i[h],typeof f=="object"&&typeof m=="object"&&f&&m?(v=Qt(f))!==Qt(m)?c[l+h]=i[h]:v==="Object"?Cs(f,m,c,l+h+"."):f!==m&&(c[l+h]=i[h]):f!==m&&(c[l+h]=i[h])):c[l+h]=void 0}),u(i).forEach(function(h){w(n,h)||(c[l+h]=i[h])}),c}function Ts(n,i){return i.type==="delete"?i.keys:i.keys||i.values.map(n.extractKey)}var jo={stack:"dbcore",name:"HooksMiddleware",level:2,create:function(n){return r(r({},n),{table:function(i){var c=n.table(i),l=c.schema.primaryKey;return r(r({},c),{mutate:function(h){var f=W.trans,m=f.table(i).hook,v=m.deleting,E=m.creating,_=m.updating;switch(h.type){case"add":if(E.fire===pe)break;return f._promise("readwrite",function(){return P(h)},!0);case"put":if(E.fire===pe&&_.fire===pe)break;return f._promise("readwrite",function(){return P(h)},!0);case"delete":if(v.fire===pe)break;return f._promise("readwrite",function(){return P(h)},!0);case"deleteRange":if(v.fire===pe)break;return f._promise("readwrite",function(){return function b(O,k,x){return c.query({trans:O,values:!1,query:{index:l,range:k},limit:x}).then(function(C){var S=C.result;return P({type:"delete",keys:S,trans:O}).then(function(T){return 0<T.numFailures?Promise.reject(T.failures[0]):S.length<x?{failures:[],numFailures:0,lastResult:void 0}:b(O,r(r({},k),{lower:S[S.length-1],lowerOpen:!0}),x)})})}(h.trans,h.range,1e4)},!0)}return c.mutate(h);function P(b){var O,k,x,C=W.trans,S=b.keys||Ts(l,b);if(!S)throw new Error("Keys missing");return(b=b.type==="add"||b.type==="put"?r(r({},b),{keys:S}):r({},b)).type!=="delete"&&(b.values=o([],b.values,!0)),b.keys&&(b.keys=o([],b.keys,!0)),O=c,x=S,((k=b).type==="add"?Promise.resolve([]):O.getMany({trans:k.trans,keys:x,cache:"immutable"})).then(function(T){var A=S.map(function(R,I){var N,K,U,M=T[I],z={onerror:null,onsuccess:null};return b.type==="delete"?v.fire.call(z,R,M,C):b.type==="add"||M===void 0?(N=E.fire.call(z,R,b.values[I],C),R==null&&N!=null&&(b.keys[I]=R=N,l.outbound||ye(b.values[I],l.keyPath,R))):(N=Cs(M,b.values[I]),(K=_.fire.call(z,N,R,M,C))&&(U=b.values[I],Object.keys(K).forEach(function(B){w(U,B)?U[B]=K[B]:ye(U,B,K[B])}))),z});return c.mutate(b).then(function(R){for(var I=R.failures,N=R.results,K=R.numFailures,R=R.lastResult,U=0;U<S.length;++U){var M=(N||S)[U],z=A[U];M==null?z.onerror&&z.onerror(I[U]):z.onsuccess&&z.onsuccess(b.type==="put"&&T[U]?b.values[U]:M)}return{failures:I,results:N,numFailures:K,lastResult:R}}).catch(function(R){return A.forEach(function(I){return I.onerror&&I.onerror(R)}),Promise.reject(R)})})}}})}})}};function Ui(n,i,c){try{if(!i||i.keys.length<n.length)return null;for(var l=[],h=0,f=0;h<i.keys.length&&f<n.length;++h)ge(i.keys[h],n[f])===0&&(l.push(c?Ee(i.values[h]):i.values[h]),++f);return l.length===n.length?l:null}catch{return null}}var Do={stack:"dbcore",level:-1,create:function(n){return{table:function(i){var c=n.table(i);return r(r({},c),{getMany:function(l){if(!l.cache)return c.getMany(l);var h=Ui(l.keys,l.trans._cache,l.cache==="clone");return h?q.resolve(h):c.getMany(l).then(function(f){return l.trans._cache={keys:l.keys,values:l.cache==="clone"?Ee(f):f},f})},mutate:function(l){return l.type!=="add"&&(l.trans._cache=null),c.mutate(l)}})}}}};function Fi(n,i){return n.trans.mode==="readonly"&&!!n.subscr&&!n.trans.explicit&&n.trans.db._options.cache!=="disabled"&&!i.schema.primaryKey.outbound}function Bi(n,i){switch(n){case"query":return i.values&&!i.unique;case"get":case"getMany":case"count":case"openCursor":return!1}}var No={stack:"dbcore",level:0,name:"Observability",create:function(n){var i=n.schema.name,c=new Me(n.MIN_KEY,n.MAX_KEY);return r(r({},n),{transaction:function(l,h,f){if(W.subscr&&h!=="readonly")throw new Y.ReadOnly("Readwrite transaction in liveQuery context. Querier source: ".concat(W.querier));return n.transaction(l,h,f)},table:function(l){var h=n.table(l),f=h.schema,m=f.primaryKey,b=f.indexes,v=m.extractKey,E=m.outbound,_=m.autoIncrement&&b.filter(function(k){return k.compound&&k.keyPath.includes(m.keyPath)}),P=r(r({},h),{mutate:function(k){function x(B){return B="idb://".concat(i,"/").concat(l,"/").concat(B),R[B]||(R[B]=new Me)}var C,S,T,A=k.trans,R=k.mutatedParts||(k.mutatedParts={}),I=x(""),N=x(":dels"),K=k.type,z=k.type==="deleteRange"?[k.range]:k.type==="delete"?[k.keys]:k.values.length<50?[Ts(m,k).filter(function(B){return B}),k.values]:[],U=z[0],M=z[1],z=k.trans._cache;return d(U)?(I.addKeys(U),(z=K==="delete"||U.length===M.length?Ui(U,z):null)||N.addKeys(U),(z||M)&&(C=x,S=z,T=M,f.indexes.forEach(function(B){var Z=C(B.name||"");function ne(se){return se!=null?B.extractKey(se):null}function oe(se){return B.multiEntry&&d(se)?se.forEach(function(lt){return Z.addKey(lt)}):Z.addKey(se)}(S||T).forEach(function(se,qe){var ie=S&&ne(S[qe]),qe=T&&ne(T[qe]);ge(ie,qe)!==0&&(ie!=null&&oe(ie),qe!=null&&oe(qe))})}))):U?(M={from:U.lower,to:U.upper},N.add(M),I.add(M)):(I.add(c),N.add(c),f.indexes.forEach(function(B){return x(B.name).add(c)})),h.mutate(k).then(function(B){return!U||k.type!=="add"&&k.type!=="put"||(I.addKeys(B.results),_&&_.forEach(function(Z){var ne=k.values.map(function(se){return Z.extractKey(se)}),oe=Z.keyPath.findIndex(function(se){return se===m.keyPath});B.results.forEach(function(se){return ne[oe]=se}),x(Z.name).addKeys(ne)})),A.mutatedParts=Rn(A.mutatedParts||{},R),B})}}),b=function(x){var C=x.query,x=C.index,C=C.range;return[x,new Me((x=C.lower)!==null&&x!==void 0?x:n.MIN_KEY,(C=C.upper)!==null&&C!==void 0?C:n.MAX_KEY)]},O={get:function(k){return[m,new Me(k.key)]},getMany:function(k){return[m,new Me().addKeys(k.keys)]},count:b,query:b,openCursor:b};return u(O).forEach(function(k){P[k]=function(x){var C=W.subscr,S=!!C,T=Fi(W,h)&&Bi(k,x)?x.obsSet={}:C;if(S){var A=function(M){return M="idb://".concat(i,"/").concat(l,"/").concat(M),T[M]||(T[M]=new Me)},R=A(""),I=A(":dels"),C=O[k](x),S=C[0],C=C[1];if((k==="query"&&S.isPrimaryKey&&!x.values?I:A(S.name||"")).add(C),!S.isPrimaryKey){if(k!=="count"){var N=k==="query"&&E&&x.values&&h.query(r(r({},x),{values:!1}));return h[k].apply(this,arguments).then(function(M){if(k==="query"){if(E&&x.values)return N.then(function(ne){return ne=ne.result,R.addKeys(ne),M});var z=x.values?M.result.map(v):M.result;(x.values?R:I).addKeys(z)}else if(k==="openCursor"){var B=M,Z=x.values;return B&&Object.create(B,{key:{get:function(){return I.addKey(B.primaryKey),B.key}},primaryKey:{get:function(){var ne=B.primaryKey;return I.addKey(ne),ne}},value:{get:function(){return Z&&R.addKey(B.primaryKey),B.value}}})}return M})}I.add(c)}}return h[k].apply(this,arguments)}}),P}})}};function Mi(n,i,c){if(c.numFailures===0)return i;if(i.type==="deleteRange")return null;var l=i.keys?i.keys.length:"values"in i&&i.values?i.values.length:1;return c.numFailures===l?null:(i=r({},i),d(i.keys)&&(i.keys=i.keys.filter(function(h,f){return!(f in c.failures)})),"values"in i&&d(i.values)&&(i.values=i.values.filter(function(h,f){return!(f in c.failures)})),i)}function As(n,i){return c=n,((l=i).lower===void 0||(l.lowerOpen?0<ge(c,l.lower):0<=ge(c,l.lower)))&&(n=n,(i=i).upper===void 0||(i.upperOpen?ge(n,i.upper)<0:ge(n,i.upper)<=0));var c,l}function qi(n,i,O,l,h,f){if(!O||O.length===0)return n;var m=i.query.index,v=m.multiEntry,E=i.query.range,_=l.schema.primaryKey.extractKey,P=m.extractKey,b=(m.lowLevelIndex||m).extractKey,O=O.reduce(function(k,x){var C=k,S=x.type==="add"||x.type==="put"?x.values.filter(function(I){return I=P(I),v&&d(I)?I.some(function(N){return As(N,E)}):As(I,E)}).map(function(I){return I=Ee(I),f&&Object.freeze(I),I}):[];switch(x.type){case"add":C=k.concat(i.values?S:S.map(function(N){return _(N)}));break;case"put":var T=new Me().addKeys(x.values.map(function(N){return _(N)})),C=k.filter(function(N){return N=i.values?_(N):N,!An(new Me(N),T)}).concat(i.values?S:S.map(function(N){return _(N)}));break;case"delete":var A=new Me().addKeys(x.keys);C=k.filter(function(N){return N=i.values?_(N):N,!An(new Me(N),A)});break;case"deleteRange":var R=x.range;C=k.filter(function(N){return!As(_(N),R)})}return C},n);return O===n?n:(O.sort(function(k,x){return ge(b(k),b(x))||ge(_(k),_(x))}),i.limit&&i.limit<1/0&&(O.length>i.limit?O.length=i.limit:n.length===i.limit&&O.length<i.limit&&(h.dirty=!0)),f?Object.freeze(O):O)}function Ki(n,i){return ge(n.lower,i.lower)===0&&ge(n.upper,i.upper)===0&&!!n.lowerOpen==!!i.lowerOpen&&!!n.upperOpen==!!i.upperOpen}function $o(n,i){return function(c,l,h,f){if(c===void 0)return l!==void 0?-1:0;if(l===void 0)return 1;if((l=ge(c,l))===0){if(h&&f)return 0;if(h)return 1;if(f)return-1}return l}(n.lower,i.lower,n.lowerOpen,i.lowerOpen)<=0&&0<=function(c,l,h,f){if(c===void 0)return l!==void 0?1:0;if(l===void 0)return-1;if((l=ge(c,l))===0){if(h&&f)return 0;if(h)return-1;if(f)return 1}return l}(n.upper,i.upper,n.upperOpen,i.upperOpen)}function Lo(n,i,c,l){n.subscribers.add(c),l.addEventListener("abort",function(){var h,f;n.subscribers.delete(c),n.subscribers.size===0&&(h=n,f=i,setTimeout(function(){h.subscribers.size===0&&ft(f,h)},3e3))})}var Uo={stack:"dbcore",level:0,name:"Cache",create:function(n){var i=n.schema.name;return r(r({},n),{transaction:function(c,l,h){var f,m,v=n.transaction(c,l,h);return l==="readwrite"&&(m=(f=new AbortController).signal,h=function(E){return function(){if(f.abort(),l==="readwrite"){for(var _=new Set,P=0,b=c;P<b.length;P++){var O=b[P],k=or["idb://".concat(i,"/").concat(O)];if(k){var x=n.table(O),C=k.optimisticOps.filter(function(Z){return Z.trans===v});if(v._explicit&&E&&v.mutatedParts)for(var S=0,T=Object.values(k.queries.query);S<T.length;S++)for(var A=0,R=(K=T[S]).slice();A<R.length;A++)Es((U=R[A]).obsSet,v.mutatedParts)&&(ft(K,U),U.subscribers.forEach(function(Z){return _.add(Z)}));else if(0<C.length){k.optimisticOps=k.optimisticOps.filter(function(Z){return Z.trans!==v});for(var I=0,N=Object.values(k.queries.query);I<N.length;I++)for(var K,U,M,z=0,B=(K=N[I]).slice();z<B.length;z++)(U=B[z]).res!=null&&v.mutatedParts&&(E&&!U.dirty?(M=Object.isFrozen(U.res),M=qi(U.res,U.req,C,x,U,M),U.dirty?(ft(K,U),U.subscribers.forEach(function(Z){return _.add(Z)})):M!==U.res&&(U.res=M,U.promise=q.resolve({result:M}))):(U.dirty&&ft(K,U),U.subscribers.forEach(function(Z){return _.add(Z)})))}}}_.forEach(function(Z){return Z()})}}},v.addEventListener("abort",h(!1),{signal:m}),v.addEventListener("error",h(!1),{signal:m}),v.addEventListener("complete",h(!0),{signal:m})),v},table:function(c){var l=n.table(c),h=l.schema.primaryKey;return r(r({},l),{mutate:function(f){var m=W.trans;if(h.outbound||m.db._options.cache==="disabled"||m.explicit)return l.mutate(f);var v=or["idb://".concat(i,"/").concat(c)];return v?(m=l.mutate(f),f.type!=="add"&&f.type!=="put"||!(50<=f.values.length||Ts(h,f).some(function(E){return E==null}))?(v.optimisticOps.push(f),f.mutatedParts&&In(f.mutatedParts),m.then(function(E){0<E.numFailures&&(ft(v.optimisticOps,f),(E=Mi(0,f,E))&&v.optimisticOps.push(E),f.mutatedParts&&In(f.mutatedParts))}),m.catch(function(){ft(v.optimisticOps,f),f.mutatedParts&&In(f.mutatedParts)})):m.then(function(E){var _=Mi(0,r(r({},f),{values:f.values.map(function(k,b){var O,k=(O=h.keyPath)!==null&&O!==void 0&&O.includes(".")?Ee(k):r({},k);return ye(k,h.keyPath,E.results[b]),k})}),E);v.optimisticOps.push(_),queueMicrotask(function(){return f.mutatedParts&&In(f.mutatedParts)})}),m):l.mutate(f)},query:function(f){if(!Fi(W,l)||!Bi("query",f))return l.query(f);var m=((_=W.trans)===null||_===void 0?void 0:_.db._options.cache)==="immutable",b=W,v=b.requery,E=b.signal,_=function(x,C,S,T){var A=or["idb://".concat(x,"/").concat(C)];if(!A)return[];if(!(C=A.queries[S]))return[null,!1,A,null];var R=C[(T.query?T.query.index.name:null)||""];if(!R)return[null,!1,A,null];switch(S){case"query":var I=R.find(function(N){return N.req.limit===T.limit&&N.req.values===T.values&&Ki(N.req.query.range,T.query.range)});return I?[I,!0,A,R]:[R.find(function(N){return("limit"in N.req?N.req.limit:1/0)>=T.limit&&(!T.values||N.req.values)&&$o(N.req.query.range,T.query.range)}),!1,A,R];case"count":return I=R.find(function(N){return Ki(N.req.query.range,T.query.range)}),[I,!!I,A,R]}}(i,c,"query",f),P=_[0],b=_[1],O=_[2],k=_[3];return P&&b?P.obsSet=f.obsSet:(b=l.query(f).then(function(x){var C=x.result;if(P&&(P.res=C),m){for(var S=0,T=C.length;S<T;++S)Object.freeze(C[S]);Object.freeze(C)}else x.result=Ee(C);return x}).catch(function(x){return k&&P&&ft(k,P),Promise.reject(x)}),P={obsSet:f.obsSet,promise:b,subscribers:new Set,type:"query",req:f,dirty:!1},k?k.push(P):(k=[P],(O=O||(or["idb://".concat(i,"/").concat(c)]={queries:{query:{},count:{}},objs:new Map,optimisticOps:[],unsignaledParts:{}})).queries.query[f.query.index.name||""]=k)),Lo(P,k,v,E),P.promise.then(function(x){return{result:qi(x.result,f,O?.optimisticOps,l,P,m)}})}})}})}};function Dn(n,i){return new Proxy(n,{get:function(c,l,h){return l==="db"?i:Reflect.get(c,l,h)}})}var Rt=(Te.prototype.version=function(n){if(isNaN(n)||n<.1)throw new Y.Type("Given version is not a positive number");if(n=Math.round(10*n)/10,this.idbdb||this._state.isBeingOpened)throw new Y.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,n);var i=this._versions,c=i.filter(function(l){return l._cfg.version===n})[0];return c||(c=new this.Version(n),i.push(c),i.sort(Oo),c.stores({}),this._state.autoSchema=!1,c)},Te.prototype._whenReady=function(n){var i=this;return this.idbdb&&(this._state.openComplete||W.letThrough||this._vip)?n():new q(function(c,l){if(i._state.openComplete)return l(new Y.DatabaseClosed(i._state.dbOpenError));if(!i._state.isBeingOpened){if(!i._state.autoOpen)return void l(new Y.DatabaseClosed);i.open().catch(pe)}i._state.dbReadyPromise.then(c,l)}).then(n)},Te.prototype.use=function(n){var i=n.stack,c=n.create,l=n.level,h=n.name;return h&&this.unuse({stack:i,name:h}),n=this._middlewares[i]||(this._middlewares[i]=[]),n.push({stack:i,create:c,level:l??10,name:h}),n.sort(function(f,m){return f.level-m.level}),this},Te.prototype.unuse=function(n){var i=n.stack,c=n.name,l=n.create;return i&&this._middlewares[i]&&(this._middlewares[i]=this._middlewares[i].filter(function(h){return l?h.create!==l:!!c&&h.name!==c})),this},Te.prototype.open=function(){var n=this;return sr(ut,function(){return Ro(n)})},Te.prototype._close=function(){var n=this._state,i=Sr.indexOf(this);if(0<=i&&Sr.splice(i,1),this.idbdb){try{this.idbdb.close()}catch{}this.idbdb=null}n.isBeingOpened||(n.dbReadyPromise=new q(function(c){n.dbReadyResolve=c}),n.openCanceller=new q(function(c,l){n.cancelOpen=l}))},Te.prototype.close=function(c){var i=(c===void 0?{disableAutoOpen:!0}:c).disableAutoOpen,c=this._state;i?(c.isBeingOpened&&c.cancelOpen(new Y.DatabaseClosed),this._close(),c.autoOpen=!1,c.dbOpenError=new Y.DatabaseClosed):(this._close(),c.autoOpen=this._options.autoOpen||c.isBeingOpened,c.openComplete=!1,c.dbOpenError=null)},Te.prototype.delete=function(n){var i=this;n===void 0&&(n={disableAutoOpen:!0});var c=0<arguments.length&&typeof arguments[0]!="object",l=this._state;return new q(function(h,f){function m(){i.close(n);var v=i._deps.indexedDB.deleteDatabase(i.name);v.onsuccess=we(function(){var E,_,P;E=i._deps,_=i.name,P=E.indexedDB,E=E.IDBKeyRange,bs(P)||_===bn||vs(P,E).delete(_).catch(pe),h()}),v.onerror=bt(f),v.onblocked=i._fireOnBlocked}if(c)throw new Y.InvalidArgument("Invalid closeOptions argument to db.delete()");l.isBeingOpened?l.dbReadyPromise.then(m):m()})},Te.prototype.backendDB=function(){return this.idbdb},Te.prototype.isOpen=function(){return this.idbdb!==null},Te.prototype.hasBeenClosed=function(){var n=this._state.dbOpenError;return n&&n.name==="DatabaseClosed"},Te.prototype.hasFailed=function(){return this._state.dbOpenError!==null},Te.prototype.dynamicallyOpened=function(){return this._state.autoSchema},Object.defineProperty(Te.prototype,"tables",{get:function(){var n=this;return u(this._allTables).map(function(i){return n._allTables[i]})},enumerable:!1,configurable:!0}),Te.prototype.transaction=function(){var n=function(i,c,l){var h=arguments.length;if(h<2)throw new Y.InvalidArgument("Too few arguments");for(var f=new Array(h-1);--h;)f[h-1]=arguments[h];return l=f.pop(),[i,Qe(f),l]}.apply(this,arguments);return this._transaction.apply(this,n)},Te.prototype._transaction=function(n,i,c){var l=this,h=W.trans;h&&h.db===this&&n.indexOf("!")===-1||(h=null);var f,m,v=n.indexOf("?")!==-1;n=n.replace("!","").replace("?","");try{if(m=i.map(function(_){if(_=_ instanceof l.Table?_.name:_,typeof _!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return _}),n=="r"||n===as)f=as;else{if(n!="rw"&&n!=os)throw new Y.InvalidArgument("Invalid transaction mode: "+n);f=os}if(h){if(h.mode===as&&f===os){if(!v)throw new Y.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");h=null}h&&m.forEach(function(_){if(h&&h.storeNames.indexOf(_)===-1){if(!v)throw new Y.SubTransaction("Table "+_+" not included in parent transaction.");h=null}}),v&&h&&!h.active&&(h=null)}}catch(_){return h?h._promise(null,function(P,b){b(_)}):Ce(_)}var E=function _(P,b,O,k,x){return q.resolve().then(function(){var C=W.transless||W,S=P._createTransaction(b,O,P._dbSchema,k);if(S.explicit=!0,C={trans:S,transless:C},k)S.idbtrans=k.idbtrans;else try{S.create(),S.idbtrans._explicit=!0,P._state.PR1398_maxLoop=3}catch(R){return R.name===xt.InvalidState&&P.isOpen()&&0<--P._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),P.close({disableAutoOpen:!1}),P.open().then(function(){return _(P,b,O,null,x)})):Ce(R)}var T,A=Ue(x);return A&&Er(),C=q.follow(function(){var R;(T=x.call(S,S))&&(A?(R=Bt.bind(null,null),T.then(R,R)):typeof T.next=="function"&&typeof T.throw=="function"&&(T=Os(T)))},C),(T&&typeof T.then=="function"?q.resolve(T).then(function(R){return S.active?R:Ce(new Y.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))}):C.then(function(){return T})).then(function(R){return k&&S._resolve(),S._completion.then(function(){return R})}).catch(function(R){return S._reject(R),Ce(R)})})}.bind(null,this,f,m,h,c);return h?h._promise(f,E,"lock"):W.trans?sr(W.transless,function(){return l._whenReady(E)}):this._whenReady(E)},Te.prototype.table=function(n){if(!w(this._allTables,n))throw new Y.InvalidTable("Table ".concat(n," does not exist"));return this._allTables[n]},Te);function Te(n,i){var c=this;this._middlewares={},this.verno=0;var l=Te.dependencies;this._options=i=r({addons:Te.addons,autoOpen:!0,indexedDB:l.indexedDB,IDBKeyRange:l.IDBKeyRange,cache:"cloned"},i),this._deps={indexedDB:i.indexedDB,IDBKeyRange:i.IDBKeyRange},l=i.addons,this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;var h,f,m,v,E,_={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:pe,dbReadyPromise:null,cancelOpen:pe,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3,autoOpen:i.autoOpen};_.dbReadyPromise=new q(function(b){_.dbReadyResolve=b}),_.openCanceller=new q(function(b,O){_.cancelOpen=O}),this._state=_,this.name=n,this.on=Kr(this,"populate","blocked","versionchange","close",{ready:[Ye,pe]}),this.on.ready.subscribe=he(this.on.ready.subscribe,function(b){return function(O,k){Te.vip(function(){var x,C=c._state;C.openComplete?(C.dbOpenError||q.resolve().then(O),k&&b(O)):C.onReadyBeingFired?(C.onReadyBeingFired.push(O),k&&b(O)):(b(O),x=c,k||b(function S(){x.on.ready.unsubscribe(O),x.on.ready.unsubscribe(S)}))})}}),this.Collection=(h=this,zr(wo.prototype,function(T,S){this.db=h;var k=_i,x=null;if(S)try{k=S()}catch(A){x=A}var C=T._ctx,S=C.table,T=S.hook.reading.fire;this._ctx={table:S,index:C.index,isPrimKey:!C.index||S.schema.primKey.keyPath&&C.index===S.schema.primKey.name,range:k,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:x,or:C.or,valueMapper:T!==Ve?T:null}})),this.Table=(f=this,zr(xi.prototype,function(b,O,k){this.db=f,this._tx=k,this.name=b,this.schema=O,this.hook=f._allTables[b]?f._allTables[b].hook:Kr(null,{creating:[Mr,pe],reading:[er,Ve],updating:[Pt,pe],deleting:[gt,pe]})})),this.Transaction=(m=this,zr(Eo.prototype,function(b,O,k,x,C){var S=this;this.db=m,this.mode=b,this.storeNames=O,this.schema=k,this.chromeTransactionDurability=x,this.idbtrans=null,this.on=Kr(this,"complete","error","abort"),this.parent=C||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new q(function(T,A){S._resolve=T,S._reject=A}),this._completion.then(function(){S.active=!1,S.on.complete.fire()},function(T){var A=S.active;return S.active=!1,S.on.error.fire(T),S.parent?S.parent._reject(T):A&&S.idbtrans&&S.idbtrans.abort(),Ce(T)})})),this.Version=(v=this,zr(Ao.prototype,function(b){this.db=v,this._cfg={version:b,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})),this.WhereClause=(E=this,zr(Ai.prototype,function(b,O,k){if(this.db=E,this._ctx={table:b,index:O===":id"?null:O,or:k},this._cmp=this._ascending=ge,this._descending=function(x,C){return ge(C,x)},this._max=function(x,C){return 0<ge(x,C)?x:C},this._min=function(x,C){return ge(x,C)<0?x:C},this._IDBKeyRange=E._deps.IDBKeyRange,!this._IDBKeyRange)throw new Y.MissingAPI})),this.on("versionchange",function(b){0<b.newVersion?console.warn("Another connection wants to upgrade database '".concat(c.name,"'. Closing db now to resume the upgrade.")):console.warn("Another connection wants to delete database '".concat(c.name,"'. Closing db now to resume the delete request.")),c.close({disableAutoOpen:!1})}),this.on("blocked",function(b){!b.newVersion||b.newVersion<b.oldVersion?console.warn("Dexie.delete('".concat(c.name,"') was blocked")):console.warn("Upgrade '".concat(c.name,"' blocked by other connection holding version ").concat(b.oldVersion/10))}),this._maxKey=Wr(i.IDBKeyRange),this._createTransaction=function(b,O,k,x){return new c.Transaction(b,O,k,c._options.chromeTransactionDurability,x)},this._fireOnBlocked=function(b){c.on("blocked").fire(b),Sr.filter(function(O){return O.name===c.name&&O!==c&&!O._state.vcFired}).map(function(O){return O.on("versionchange").fire(b)})},this.use(Do),this.use(Uo),this.use(No),this.use(Io),this.use(jo);var P=new Proxy(this,{get:function(b,O,k){if(O==="_vip")return!0;if(O==="table")return function(C){return Dn(c.table(C),P)};var x=Reflect.get(b,O,k);return x instanceof xi?Dn(x,P):O==="tables"?x.map(function(C){return Dn(C,P)}):O==="_createTransaction"?function(){return Dn(x.apply(this,arguments),P)}:x}});this.vip=P,l.forEach(function(b){return b(c)})}var Nn,nt=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable",Fo=(Rs.prototype.subscribe=function(n,i,c){return this._subscribe(n&&typeof n!="function"?n:{next:n,error:i,complete:c})},Rs.prototype[nt]=function(){return this},Rs);function Rs(n){this._subscribe=n}try{Nn={indexedDB:a.indexedDB||a.mozIndexedDB||a.webkitIndexedDB||a.msIndexedDB,IDBKeyRange:a.IDBKeyRange||a.webkitIDBKeyRange}}catch{Nn={indexedDB:null,IDBKeyRange:null}}function zi(n){var i,c=!1,l=new Fo(function(h){var f=Ue(n),m,v=!1,E={},_={},P={get closed(){return v},unsubscribe:function(){v||(v=!0,m&&m.abort(),b&&Kt.storagemutated.unsubscribe(k))}};h.start&&h.start(P);var b=!1,O=function(){return is(x)},k=function(C){Rn(E,C),Es(_,E)&&O()},x=function(){var C,S,T;!v&&Nn.indexedDB&&(E={},C={},m&&m.abort(),m=new AbortController,T=function(A){var R=Ot();try{f&&Er();var I=Ft(n,A);return I=f?I.finally(Bt):I}finally{R&&Ct()}}(S={subscr:C,signal:m.signal,requery:O,querier:n,trans:null}),Promise.resolve(T).then(function(A){c=!0,i=A,v||S.signal.aborted||(E={},function(R){for(var I in R)if(w(R,I))return;return 1}(_=C)||b||(Kt(Vr,k),b=!0),is(function(){return!v&&h.next&&h.next(A)}))},function(A){c=!1,["DatabaseClosedError","AbortError"].includes(A?.name)||v||is(function(){v||h.error&&h.error(A)})}))};return setTimeout(O,0),P});return l.hasValue=function(){return c},l.getValue=function(){return i},l}var cr=Rt;function Is(n){var i=zt;try{zt=!0,Kt.storagemutated.fire(n),Ps(n,!0)}finally{zt=i}}D(cr,r(r({},ct),{delete:function(n){return new cr(n,{addons:[]}).delete()},exists:function(n){return new cr(n,{addons:[]}).open().then(function(i){return i.close(),!0}).catch("NoSuchDatabaseError",function(){return!1})},getDatabaseNames:function(n){try{return i=cr.dependencies,c=i.indexedDB,i=i.IDBKeyRange,(bs(c)?Promise.resolve(c.databases()).then(function(l){return l.map(function(h){return h.name}).filter(function(h){return h!==bn})}):vs(c,i).toCollection().primaryKeys()).then(n)}catch{return Ce(new Y.MissingAPI)}var i,c},defineClass:function(){return function(n){p(this,n)}},ignoreTransaction:function(n){return W.trans?sr(W.transless,n):n()},vip:ws,async:function(n){return function(){try{var i=Os(n.apply(this,arguments));return i&&typeof i.then=="function"?i:q.resolve(i)}catch(c){return Ce(c)}}},spawn:function(n,i,c){try{var l=Os(n.apply(c,i||[]));return l&&typeof l.then=="function"?l:q.resolve(l)}catch(h){return Ce(h)}},currentTransaction:{get:function(){return W.trans||null}},waitFor:function(n,i){return i=q.resolve(typeof n=="function"?cr.ignoreTransaction(n):n).timeout(i||6e4),W.trans?W.trans.waitFor(i):i},Promise:q,debug:{get:function(){return Ze},set:function(n){gr(n)}},derive:L,extend:p,props:D,override:he,Events:Kr,on:Kt,liveQuery:zi,extendObservabilitySet:Rn,getByKeyPath:Le,setByKeyPath:ye,delByKeyPath:function(n,i){typeof i=="string"?ye(n,i,void 0):"length"in i&&[].map.call(i,function(c){ye(n,c,void 0)})},shallowClone:jt,deepClone:Ee,getObjectDiff:Cs,cmp:ge,asap:Xe,minKey:-1/0,addons:[],connections:Sr,errnames:xt,dependencies:Nn,cache:or,semVer:"4.0.7",version:"4.0.7".split(".").map(function(n){return parseInt(n)}).reduce(function(n,i,c){return n+i/Math.pow(10,2*c)})})),cr.maxKey=Wr(cr.dependencies.IDBKeyRange),typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&(Kt(Vr,function(n){zt||(n=new CustomEvent(hs,{detail:n}),zt=!0,dispatchEvent(n),zt=!1)}),addEventListener(hs,function(n){n=n.detail,zt||Is(n)}));var Or,zt=!1,Hi=function(){};return typeof BroadcastChannel<"u"&&((Hi=function(){(Or=new BroadcastChannel(hs)).onmessage=function(n){return n.data&&Is(n.data)}})(),typeof Or.unref=="function"&&Or.unref(),Kt(Vr,function(n){zt||Or.postMessage(n)})),typeof addEventListener<"u"&&(addEventListener("pagehide",function(n){if(!Rt.disableBfCache&&n.persisted){Ze&&console.debug("Dexie: handling persisted pagehide"),Or?.close();for(var i=0,c=Sr;i<c.length;i++)c[i].close({disableAutoOpen:!1})}}),addEventListener("pageshow",function(n){!Rt.disableBfCache&&n.persisted&&(Ze&&console.debug("Dexie: handling persisted pageshow"),Hi(),Is({all:new Me(-1/0,[[]])}))})),q.rejectionMapper=function(n,i){return!n||n instanceof Ge||n instanceof TypeError||n instanceof SyntaxError||!n.name||!Dt[n.name]?n:(i=new Dt[n.name](i||n.message,n),"stack"in n&&$(i,"stack",{get:function(){return this.inner.stack}}),i)},gr(Ze),r(Rt,Object.freeze({__proto__:null,Dexie:Rt,liveQuery:zi,Entity:ki,cmp:ge,PropModSymbol:At,PropModification:Hr,replacePrefix:function(n,i){return new Hr({replacePrefix:[n,i]})},add:function(n){return new Hr({add:n})},remove:function(n){return new Hr({remove:n})},default:Rt,RangeSet:Me,mergeRanges:Xr,rangesOverlap:An}),{default:Rt}),Rt})})(mo);var wh=mo.exports;const si=Zo(wh),Ea=Symbol.for("Dexie"),ln=globalThis[Ea]||(globalThis[Ea]=si);if(si.semVer!==ln.semVer)throw new Error(`Two different versions of Dexie loaded in the same app: ${si.semVer} and ${ln.semVer}`);const ii={id:"",email:"",updatedAt:new Date,fullName:"Guest",username:"Guest"},Rr=Yo(ii),Sa=Ra(!1),rn=Ra(null);class yo extends ln{constructor(){super("KilobaseDB"),this.supabase=null,this.profileKey="userProfile",this.handleUserRedirect=e=>{if(!e||!e.location)return;const{location:t,timer:r=0,replace:o=!1}=e;console.log(`Redirecting user to: ${t} in ${r}ms`),setTimeout(()=>{this.cleanupEventListeners(),o?window.location.replace(t):window.location.href=t},r)},this.version(1).stores({keyValueStore:"key",profiles:"&id, email",errorLogs:"++id, actionId, message, timestamp",actionULID:"&id, action, timestamp, status, errorId"}),this.profiles=this.table("profiles"),this.errorLogs=this.table("errorLogs"),this.actionULID=this.table("actionULID"),this.supabase=this.initializeSupabaseClient(),this.initializeEventListeners()}initializeEventListeners(){fr.on("redirectUser",this.handleUserRedirect)}cleanupEventListeners(){fr.off("redirectUser",this.handleUserRedirect)}initializeSupabaseClient(){if(typeof window<"u"&&window.supabase&&(console.log("Using global Supabase client instance:",window.supabase),this.supabase=window.supabase),!this.supabase)try{this.supabase=bh(Hn.get().api,Hn.get().anonKey),console.log("Supabase client instance created:",this.supabase),typeof window<"u"&&(window.supabase=this.supabase)}catch(e){throw console.error("Error creating Supabase client:",e),e}return this.supabase}getSupabaseClient(){return this.supabase}async registerUser(e,t,r,o,a,u){const d=this.getSupabaseClient();if(!d)return null;try{if(t!==r)return await this.handleAuthError({message:"Password and confirm password do not match."},o),null;const{data:p,error:g}=await d.auth.signUp({email:e,password:t,options:{captchaToken:u,data:{username:a,full_name:a}}});if(g)return await this.handleAuthError(g,o),null;if(p?.user){const y={id:p.user.id,email:p.user.email||"",username:p.user.user_metadata?.username||void 0,fullName:p.user.user_metadata?.full_name||void 0,updatedAt:new Date(p.user.updated_at||Date.now())};return await this.saveProfile(y),await this.updateActionStatus(o,"completed"),y}}catch(p){return await this.handleAuthError(p,o),null}return null}async createActionULID(e){const t=aa().toString(),r={id:t,action:e,timestamp:new Date,status:"pending"};return await this.actionULID.add(r),t}async handleAuthError(e,t){let r="An unknown error occurred. Please try again.",o={...e},a="";e?.message&&(r=e.message),e?.code&&(a+=`Error Code: ${e.code}. `),e?.status&&(a+=`Status: ${e.status}. `),e?.supabaseCode&&(a+=`Supabase Code: ${e.supabaseCode}. `),e?.details&&(a+=`Details: ${JSON.stringify(e.details)}. `),a&&(r=`${r} (${a.trim()})`);const u={invalid_grant:"Invalid credentials provided.",invalid_request:"The request is missing a required parameter.",expired_token:"The token has expired. Please log in again.",invalid_token:"The token provided is invalid. Please try again.",email_already_exists:"The email address is already in use.",user_already_exists:"A user with this identifier already exists. Please log in instead.",invalid_password:"The password provided is incorrect."};switch(e?.code&&u[e.code]&&(r=u[e.code]),e?.status){case 400:r="Bad request. Please check the input fields.";break;case 401:r="Unauthorized. Please check your credentials.";break;case 403:r="Forbidden. You do not have permission to perform this action.";break;case 404:r="Resource not found. Please try again.";break;case 422:r="Unprocessable entity. Please check the provided data.";break;case 500:r="Internal server error. Please try again later.";break;default:r=r||"An unknown error occurred. Please try again.";break}throw await this.logError(r,{...o,supabaseCode:e?.code,statusCode:e?.status},t),console.error("Authentication Error:",r),new Error(r)}async saveProfile(e){try{await this.table("keyValueStore").put({key:this.profileKey,value:e}),e.username&&rn.set(e.username),Rr.set(e),console.log("Profile saved locally:",e)}catch(t){console.error("Failed to save profile locally:",t)}}async loadProfile(){try{const e=await this.table("keyValueStore").get(this.profileKey);if(e?.value){Rr.set(e.value),console.log("Profile loaded from local storage:",e.value);return}await this.loadProfileFromSupabase()}catch(e){console.error("Failed to load profile:",e)}}async loadProfileFromSupabase(){const e=this.getSupabaseClient();if(e)try{Sa.set(!0);const{data:{user:t},error:r}=await e.auth.getUser();if(r){console.error("Failed to get authenticated user from Supabase:",r),await this.logError("Failed to get authenticated user from Supabase",r);return}if(!t){console.warn("No authenticated user found");return}const{data:o,error:a}=await e.from("user_profiles").select("id, username, updated_at").eq("id",t.id).single();if(a){console.error("Failed to load user profile from Supabase:",a),await this.logError("Failed to load user profile from Supabase",a);return}if(o){const u={id:o.id,email:t.email||"",username:o.username||void 0,fullName:t.user_metadata?.full_name||void 0,updatedAt:new Date(o.updated_at)};await this.saveProfile(u),console.log("Profile loaded and saved from Supabase:",u)}}catch(t){console.error("An unexpected error occurred while loading the profile:",t),await this.logError("An unexpected error occurred while loading the profile",t)}finally{Sa.set(!1)}}async removeProfile(){const e=this.getSupabaseClient();if(e)try{const t=Rr.get();await this.table("keyValueStore").delete(this.profileKey),await this.profiles.delete(t.id),Rr.set(ii),console.log(`Profile ${t.id} removed locally and store reset`),rn.set(null);const{error:r}=await e.auth.signOut();r?(await this.logError("Failed to log out user from Supabase",r),console.error("Failed to log out user from Supabase:",r)):console.log("User logged out successfully from Supabase.")}catch(t){await this.logError("Failed to remove profile",t),console.error("Failed to remove profile:",t)}}async getProfile(){const e=Rr.get();if(e.id!=="")return e;try{const t=await this.table("keyValueStore").get(this.profileKey);if(t?.value){const r=t.value;return Rr.set(r),r}}catch(t){console.error("Failed to get profile from Dexie:",t)}return ii}async createAction(e){const r={id:aa().toString(),action:e,timestamp:new Date,status:"pending"};return await this.actionULID.add(r),r}async updateActionStatus(e,t,r){await this.actionULID.update(e,{status:t,errorId:r})}async logError(e,t,r){try{let o=null;if(r&&(o=await this.errorLogs.where("actionId").equals(r).first()),o){console.warn(`Error already exists for actionId: ${r}. Skipping new error log.`);return}const a={message:e,details:t,actionId:r,timestamp:new Date},u=await this.errorLogs.add(a);console.log("Error logged to Dexie:",a),r&&await this.updateActionStatus(r,"failed",u)}catch(o){console.error("Failed to log error:",o)}}async extractAuthErrorDetails(e){if(!e)return"Unknown error occurred. No error details available.";let t=e.message||"Unknown error occurred",r="";return e?.code&&(r+=`Error Code: ${e.code}. `),e?.status&&(r+=`Status: ${e.status}. `),e?.supabaseCode&&(r+=`Supabase Code: ${e.supabaseCode}. `),e?.details&&(r+=`Details: ${JSON.stringify(e.details)}. `),r&&(t=`${t} (${r.trim()})`),t}async getDetailedErrorByActionId(e){try{const t=await this.errorLogs.where("actionId").equals(e).last();return t?this.extractAuthErrorDetails(t):null}catch(t){return console.error(`Failed to retrieve detailed error for actionId: ${e}`,t),null}}async getErrorByActionId(e){try{const t=await this.errorLogs.where("actionId").equals(e).last();return t?t.message:null}catch(t){return console.error(`Failed to retrieve error for actionId: ${e}`,t),null}}async loginUser(e,t,r,o){const a=this.getSupabaseClient();if(!a)return null;try{const{data:u,error:d}=await a.auth.signInWithPassword({email:e,password:t,options:{captchaToken:o}});if(d)return await this.handleAuthError(d,r),null;if(u?.user){const p={id:u.user.id,email:u.user.email||"",username:u.user.user_metadata?.username||void 0,fullName:u.user.user_metadata?.full_name||void 0,updatedAt:new Date(u.user.updated_at||Date.now())};return await this.saveProfile(p),console.log("User logged in successfully:",p),p}}catch(u){return await this.handleAuthError(u,r),null}return null}async getSession(){const e=this.getSupabaseClient();if(!e)return null;try{const{data:t,error:r}=await e.auth.getSession();return r?(console.error("Failed to retrieve session:",r),null):t.session||null}catch(t){return console.error("Error getting session:",t),null}}async getUsername(){if(rn.get())return rn.get();try{const e=await this.table("keyValueStore").get(this.profileKey);if(e?.value?.username)return rn.set(e.value.username),e.value.username}catch(e){console.error("Failed to get username from Dexie:",e)}return null}static createPersistentAtom(e,t){return Aa(e,t,{encode:JSON.stringify,decode:JSON.parse})}createPersistentMap(e,t){return Xo(e,t,{encode:JSON.stringify,decode:JSON.parse})}updateAtomField(e,t,r){e.set({...e.get(),[t]:r})}updateMapField(e,t,r){const a={...e.get(),[t]:r};e.set(a)}removeMapField(e,t){const r=e.get(),{[t]:o,...a}=r;e.set(a)}removeAtomField(e,t){const r=e.get(),{[t]:o,...a}=r;e.set(a)}resetState(e,t){e.set(t)}getPersistentAtom(e){return e.get()}}yo.createPersistentAtom("atlas",{plugin:[]});const nn=new yo;function _h(s){const{elementIdOrName:e,duration:t=500,onComplete:r}=s;let o=null;if(o=document.getElementById(e),!o){const a=document.getElementsByName(e);a.length>0&&(o=a[0])}if(!o){H.error(`Loader element with ID or name "${e}" not found.`);return}if(!(o instanceof HTMLElement)){H.error(`Element found by "${e}" is not an HTMLElement.`);return}H.log(`Removing loader element with ID or name "${e}" with duration ${t}ms.`),o.classList.add("opacity-0","transition-opacity",`duration-${t}`),setTimeout(()=>{o&&(o.style.display="none"),H.log(`Loader element with ID or name "${e}" has been hidden.`),r&&r()},t)}class kh extends ln{constructor(){super("MapDatabase"),this.version(1).stores({maps:"tilemapKey",jsonFiles:"tilemapKey",tilesetImages:"tilemapKey"}),this.maps=this.table("maps"),this.jsonFiles=this.table("jsonFiles"),this.tilesetImages=this.table("tilesetImages")}async initializeMapDatabase(){const e="/api/mapdb.json",t="https://kbve.com/api/mapdb.json";let r;try{r=(await ve.get(e)).data,H.log(`Map database loaded from ${e}`)}catch{H.warn(`Failed to load map database from ${e}, trying fallback URL.`);try{r=(await ve.get(t)).data,H.log(`Map database loaded from ${t}`)}catch{H.error(`Failed to load map database from both ${e} and ${t}`);return}}if(r&&r.key){for(const o in r.key)if(Object.prototype.hasOwnProperty.call(r.key,o)){const a=r.key[o];await this.addMap(a),await this.addJsonData(o,a.jsonDataUrl);const u=await this.fetchTilesetImage(a.tilesetImageUrl);u&&await this.addTilesetImage(o,u)}H.log("Map database initialized and data loaded.")}else H.error("Invalid map database format.")}async addMap(e){await this.maps.put(e)}async getMap(e){return await this.maps.get(e)}async addJsonData(e,t){await this.jsonFiles.put({tilemapKey:e,jsonData:t})}async getJsonData(e){return(await this.jsonFiles.get(e))?.jsonData}async addTilesetImage(e,t){await this.tilesetImages.put({tilemapKey:e,imageData:t})}async getTilesetImage(e){return(await this.tilesetImages.get(e))?.imageData}async getBounds(e){return(await this.maps.get(e))?.bounds}async getNpcsFromTilesetKey(e){const t=await Eh.getMap(e);if(!t){H.error(`No map data found for tilesetKey: ${e}`);return}return t.npcs}async fetchMapData(e){try{return(await ve.get(e)).data}catch(t){H.error(`Failed to fetch map data from ${e}:`,t);return}}async fetchJsonData(e){try{return(await ve.get(e)).data}catch(t){H.error(`Failed to fetch JSON data from ${e}:`,t);return}}async fetchTilesetImage(e){try{return(await ve.get(e,{responseType:"blob"})).data}catch(t){H.error(`Failed to fetch tileset image from ${e}:`,t);return}}async initializeMap(e,t,r,o){try{const a=await this.fetchMapData(t);if(a){await this.addMap(a);const u=await this.fetchJsonData(r);u&&await this.addJsonData(e,u);const d=await this.fetchTilesetImage(o);d&&await this.addTilesetImage(e,d)}}catch(a){H.error("Failed to initialize map database:",a)}}async loadMapIntoScene(e,t){const r=await this.getMap(t);if(!r){H.error(`Map with key ${t} not found`);return}const o=await this.getJsonData(t);if(!o){H.error(`JSON data for map ${t} not found`);return}const a=await this.getTilesetImage(t);if(!a){H.error(`Tileset image for map ${t} not found`);return}let u=null;try{u=URL.createObjectURL(a)}catch(d){H.error(`Failed to create object URL for tileset image: ${d}`);return}if(!u){H.error(`Tileset image URL for map ${t} could not be created.`);return}e.load.tilemapTiledJSON(t,o),e.load.image(r.tilesetKey,u),e.load.once("complete",()=>{const d=e.make.tilemap({key:t}),p=d.addTilesetImage(r.tilesetName,r.tilesetKey);if(p)for(let g=0;g<d.layers.length;g++){const y=d.createLayer(g,p,0,0);y?y.scale=r.scale:H.error(`Layer ${g} could not be created.`)}else H.error(`Tileset ${r.tilesetName} could not be created.`)}),e.load.start()}async loadMap(e,t){const r=await this.getMap(t);if(!r)throw new Error(`Map with key ${t} not found`);const o=await this.getJsonData(t);if(!o)throw new Error(`JSON data for map ${t} not found`);const a=await this.getTilesetImage(t);if(!a)throw new Error(`Tileset image for map ${t} not found`);let u=null;try{u=URL.createObjectURL(a)}catch(d){throw new Error(`Failed to create object URL for tileset image: ${d}`)}if(!u)throw new Error(`Tileset image URL for map ${t} could not be created.`);return e.load.tilemapTiledJSON(t,o),e.load.image(r.tilesetKey,u),new Promise(d=>{e.load.once("complete",()=>{const p=e.make.tilemap({key:t});if(p.addTilesetImage(r.tilesetName,r.tilesetKey)){for(let y=0;y<p.layers.length;y++){const w=p.createLayer(y,r.tilesetName,0,0);w?w.scale=r.scale:console.error(`Layer ${y} could not be created.`)}d(p)}else console.error(`Tileset ${r.tilesetName} could not be created.`),d(null)}),e.load.start()})}}const Eh=new kh,Sh=({text:s,speed:e=80,onComplete:t})=>{const[r,o]=Ds.useState([]),a=Ds.useRef([]);return Ds.useEffect(()=>{let u,d=0;const p=s.split(/(<\/?span[^>]*>)/g).filter(Boolean),g=[];p.forEach((w,D)=>{if(w.startsWith("<span")||w.startsWith("</span")){const F=w.match(/<span class="([^"]*)">/);if(F){const $=F[1];g.push(Ln.jsx("span",{className:$},`span-${D}`))}else g.push(Ln.jsx("span",{},`span-${D}`))}else w.split("").forEach((F,$)=>{g.push(Ln.jsx("span",{children:F},`char-${D}-${$}`))})}),d=0;const y=()=>{d<g.length?(a.current=[...a.current,g[d]],o([...a.current]),d++,u=window.setTimeout(y,e)):t&&t()};return a.current=[],o([]),y(),()=>{window.clearTimeout(u)}},[s,e,t]),Ln.jsx("div",{children:r})};ec.memo(Sh);class xh extends ln{constructor(){super("NPCDatabase"),this.version(3).stores({npcs:"id,name",sprites:"id",avatars:"id",dialogues:"id"}),this.npcs=this.table("npcs"),this.sprites=this.table("sprites"),this.avatars=this.table("avatars"),this.dialogues=this.table("dialogues")}async addNPC(e){await this.npcs.put(e)}async getNPC(e){return await this.npcs.get(e)}async getNPCByName(e){return await this.npcs.where("name").equals(e).first()}async getAllNPCs(){return await this.npcs.toArray()}async exportNPCs(){const e=await this.getAllNPCs();return JSON.stringify(e,null,2)}async importNPCs(e){const t=JSON.parse(e);await this.npcs.bulkPut(t)}async fetchNPCData(e){try{return(await ve.get(e)).data}catch(t){H.error(`Failed to fetch NPC data from ${e}:`,t);return}}async addSprite(e){await this.sprites.put(e)}async getSprite(e){return await this.sprites.get(e)}async getAllSprites(){return await this.sprites.toArray()}async addAvatar(e){await this.avatars.put(e)}async getAvatar(e){return await this.avatars.get(e)}async getAllAvatars(){return await this.avatars.toArray()}async urlToBlob(e){try{return(await ve.get(e,{responseType:"blob"})).data}catch(t){H.error(`Failed to fetch blob from ${e}:`,t);return}}async addNewSprite(e,t){const r=await this.urlToBlob(e);if(r){const o={...t,spriteData:r};return await this.addSprite(o),o.id}}async addNewNPC(e,t,r){const o={...e,spriteImageId:t,avatarImageId:r};await this.addNPC(o)}async addNewAvatar(e,t){const r=await this.urlToBlob(e);if(r){const o={...t,avatarData:r};return await this.addAvatar(o),o.id}}async fetchAvatars(e){try{const r=(await ve.get(e)).data.key;for(const o in r){const a=r[o];let u=await this.urlToBlob(a.avatarLocation);if(u||(u=await this.urlToBlob(`https://kbve.com${a.avatarLocation}`)),u){const d={id:a.id,avatarName:a.avatarName,avatarLocation:a.avatarLocation,avatarData:u,slug:a.slug};await this.addAvatar(d)}}}catch(t){H.error(`Failed to fetch avatars from ${e}:`,t)}}async fetchSprites(e){try{const r=(await ve.get(e)).data.key;for(const o in r){const a=r[o];let u=await this.urlToBlob(a.assetLocation);if(u||(u=await this.urlToBlob(`https://kbve.com${a.assetLocation}`)),u){const d={id:a.id,spriteName:a.spriteName,assetLocation:a.assetLocation,frameWidth:a.frameWidth,frameHeight:a.frameHeight,scale:a.scale,slug:a.slug,spriteData:u};await this.addSprite(d)}}}catch(t){H.error(`Failed to fetch sprites from ${e}:`,t)}}async fetchNPCs(e){try{const r=(await ve.get(e)).data.key;for(const o in r){const a=r[o],u={id:a.id,name:a.name,spriteKey:a.spriteKey,walkingAnimationMapping:a.walkingAnimationMapping,startPosition:a.startPosition,speed:a.speed,scale:a.scale,slug:a.slug,actions:a.actions,effects:a.effects,stats:a.stats,spriteImageId:a.spriteImageId,avatarImageId:a.avatarImageId,dialogues:a.dialogues||[]};await this.addNPC(u)}}catch(t){H.error(`Failed to fetch NPCs from ${e}:`,t)}}async initializeDatabase(e="https://kbve.com"){await this.fetchAvatars(`${e}/api/avatardb.json`),await this.fetchSprites(`${e}/api/spritedb.json`),await this.fetchNPCs(`${e}/api/npcdb.json`),await this.fetchDialogues(`${e}/api/dialogue.json`)}async loadNPC(e,t,r,o){try{H.log(`Loading NPC with name: ${t}`);const a=await this.getNPCByName(t);if(!a)throw new Error(`NPC with name ${t} not found`);H.log(`NPC Data: ${JSON.stringify(a)}`),await this.loadCharacter(e,a.id,r,o)}catch(a){a instanceof Error?H.error(`Failed to load NPC: ${a.message}`):H.error("Failed to load NPC:",a)}}async loadCharacter(e,t,r,o){try{H.log(`Loading NPC with ID: ${t}`);const a=await this.getNPC(t);if(!a)throw new Error(`NPC with ID ${t} not found`);H.log(`NPC Data: ${JSON.stringify(a)}`);const u=a.spriteKey;if(e.textures.exists(u))H.log(`Texture with key ${u} already loaded.`),this.addNPCToScene(e,a,r,o);else{H.log(`Texture with key ${u} not found, attempting to load.`);const d=await this.getSprite(a.spriteImageId);if(d&&d.spriteData){H.log(`Sprite Data: ${JSON.stringify(d)}`);const p=URL.createObjectURL(d.spriteData);e.load.spritesheet(u,p,{frameWidth:d.frameWidth,frameHeight:d.frameHeight}),e.load.once("complete",()=>{H.log(`Texture ${u} loaded successfully.`),this.addNPCToScene(e,a,r,o)}),e.load.start()}else throw new Error(`Sprite with ID ${a.spriteImageId} not found`)}}catch(a){a instanceof Error?H.error(`Failed to load NPC: ${a.message}`):H.error("Failed to load NPC:",a)}}addNPCToScene(e,t,r,o){try{H.log(`Adding NPC to scene: ${JSON.stringify(t)}`),H.log(`Using sprite key: ${t.spriteKey}`);const a=e.add.sprite(0,0,t.spriteKey);a.scale=t.scale||1.5,a.name=t.id||"Error Missing Name",H.log(`NPC Sprite created with texture key ${t.spriteKey} at position (${t.startPosition.x}, ${t.startPosition.y})`);const u={id:t.id,sprite:a,walkingAnimationMapping:t.walkingAnimationMapping,startPosition:{x:r??t.startPosition.x,y:o??t.startPosition.y},speed:t.speed};if(H.log(`Grid engine config: ${JSON.stringify(u)}`),!e.textures.exists(t.spriteKey))throw new Error(`Texture with key ${t.spriteKey} does not exist in the scene`);e.gridEngine.addCharacter(u),H.log(`NPC added to grid engine with ID ${t.id}`),((p,g,y)=>{const w=e.gridEngine.getPosition(p.name);H.log(`Attaching NPC events to ${g} at position: ${JSON.stringify(w)}`),Ch.attachNPCEvent(p,g,y,{coords:w})})(a,t.name,t.actions.map(p=>({label:p}))),H.log(`NPC ${t.name} added to scene successfully`)}catch(a){a instanceof Error?H.error(`Error adding NPC to scene from addNPCToScene: ${a.message}`):H.error("Error adding NPC to scene:",a)}}async addDialogue(e){await this.dialogues.put(e)}async getDialogue(e){return await this.dialogues.get(e)}async getAllDialogues(){return await this.dialogues.toArray()}async getDialoguesForNPC(e){const t=await this.getNPC(e);if(!t)throw new Error(`NPC with ID ${e} not found`);return(await Promise.all((t.dialogues||[]).map(o=>this.getDialogue(o.dialogueId)))).filter(o=>o!==void 0)}async markDialogueAsRead(e,t){const r=await this.getNPC(e);if(!r)throw new Error(`NPC with ID ${e} not found`);const o=r.dialogues?.find(a=>a.dialogueId===t);o&&(o.read=!0,await this.addNPC(r))}async fetchDialogues(e){try{const r=(await ve.get(e)).data.key,o=Object.values(r).map(a=>({...a}));await this.dialogues.bulkPut(o)}catch(t){H.error(`Failed to fetch dialogues from ${e}:`,t)}}async getPrioritizedDialoguesForNPC(e){try{const t=await this.getNPC(e);if(!t)throw new Error(`NPC with ID ${e} not found`);const o=(await Promise.all((t.dialogues||[]).map(async a=>{const u=await this.getDialogue(a.dialogueId);return u?{...u,priority:a.priority,read:a.read}:null}))).filter(a=>a!==null);return o.sort((a,u)=>u.priority-a.priority),o}catch(t){return H.error(`Failed to get prioritized dialogues for NPC with ID ${e}:`,t),[]}}async getNPCNameById(e){return(await this.getNPC(e))?.name}async getNPCAvatarById(e){const t=await this.getNPC(e);if(t?.avatarImageId)return(await this.getAvatar(t.avatarImageId))?.avatarData}async getNPCSlugById(e){return(await this.getNPC(e))?.slug}async getNPCHealthById(e){try{return(await this.getNPC(e))?.stats?.health}catch(t){H.error(`Failed to get health for NPC with ID ${e}:`,t);return}}async getNPCManaById(e){try{return(await this.getNPC(e))?.stats?.mana}catch(t){H.error(`Failed to get mana for NPC with ID ${e}:`,t);return}}async createNPCSession(e,t){try{const r=this.getNPCNameById(t),o=this.getNPCSlugById(t),a=this.getNPCAvatarById(t),u=this.getNPCHealthById(t),d=this.getNPCManaById(t),[p,g,y,w,D]=await Promise.all([r,o,a,u,d]),F={...e.get(),[`${t}_name`]:p||"Unknown",[`${t}_slug`]:g||"Unknown",[`${t}_avatar`]:y?URL.createObjectURL(y):"Unknown",[`${t}_health`]:w||"100",[`${t}_mana`]:D||"100"};e.set(F)}catch{const o={...e.get(),[`${t}_name`]:"Unknown",[`${t}_slug`]:"Unknown",[`${t}_avatar`]:"Unknown",[`${t}_hp`]:"100",[`${t}_mana`]:"100"};e.set(o)}}async getNPCDialogueOptionsByULID(e){try{const t=await this.getDialogue(e);if(!t||!t.options)return"[]";const r=await Promise.all(t.options.map(async o=>this.getDialogue(o)));return JSON.stringify(r.filter(o=>o!==void 0))}catch(t){return H.error(`Failed to get dialogue options for ID ${e}:`,t),"[]"}}async getAllDialogueOptions(e){const t=[],r=new Set,o=async a=>{if(r.has(a))return;r.add(a);const u=await this.getDialogue(a);if(u&&(t.push(u),u.options&&u.options.length>0))for(const d of u.options)await o(d)};return await o(e),t}async createDialogueSession(e,t){try{const r=await this.getNPCDialogueOptionsByULID(t),o={...e.get(),[`${t}_options`]:r||"[]"};e.set(o)}catch{const o={...e.get(),[`${t}_options`]:"[]"};e.set(o)}}}const Ph=new xh;class Oh{constructor(){this.actionHandlers={talk:this.talkToNPC.bind(this),quest:this.questWithNPC.bind(this),trade:this.tradeWithNPC.bind(this),combat:this.startCombat.bind(this),heal:this.healNPC.bind(this),steal:this.stealFromNPC.bind(this),lore:this.loreFromNPC.bind(this)}}getActionHandler(e){return this.actionHandlers[e]}loreFromNPC(e){H.log(`Pulling up the lore of the NPC with ID: ${e.npcId}`)}questWithNPC(e){H.log(`Starting quest with NPC with ID: ${e.npcId}`)}healNPC(e){H.log(`Healing NPC with ID: ${e.npcId}`)}oathFromNPC(e){H.log(`Oath from NPC with ID: ${e.npcId}`)}async talkToNPC(e){try{H.log(`Talking to NPC with ID: ${e.npcId}`);const t=await Ph.getPrioritizedDialoguesForNPC(e.npcId);if(H.log(t),t.length>0){const r=t[0];fr.emit("npcDialogue",{npcId:e.npcId,dialogue:r},1e3)}else H.log("No dialogues available for this NPC.")}catch(t){H.error(`Failed to fetch dialogues for NPC with ID ${e.npcId}:`,t)}}tradeWithNPC(e){H.log(`Trading with NPC with ID: ${e.npcId}`)}moveToNPC(e){const r=e.data?.coords||{x:10,y:15};fr.emit("playerMove",r)}stealFromNPC(e){H.log(`Attempting to steal from NPC with ID: ${e.npcId}`);const t={npcId:e.npcId,npcName:e.npcName,data:e.data};fr.emit("playerSteal",t)}startCombat(e){H.log(`Starting combat with NPC with ID: ${e.npcId}`)}checkFish(e){H.log(`Checking fish for NPC with ID: ${e.npcId}`)}attachNPCEvent(e,t,r,o){e.setInteractive(),e.on("pointerover",a=>{const u={npcId:e.name||"",npcName:t,actions:r.map(d=>d.label),data:o||{},coords:{x:a.x,y:a.y}};fr.emit("npcInteraction",u),e.setTint(65280)}),e.on("pointerout",()=>{e.clearTint()}),e.on("pointerdown",a=>{const u={npcId:e.name||"",npcName:t,actions:r.map(d=>d.label),data:o||{},coords:{x:a.x,y:a.y}};H.log(`Click Registered at X: ${u.coords.x} Y: ${u.coords.y}`),fr.emit("npcInteractionClick",u,1e3)})}}const Ch=new Oh,{document:Hs}=Go;function xa(s){let e,t;return{c(){e=ee("script"),this.h()},l(r){e=te(r,"SCRIPT",{src:!0});var o=be(e);o.forEach(ae),this.h()},h(){Ta(e.src,t=s[5])||J(e,"src",t),e.async=!0,e.defer=!0},m(r,o){Yt(r,e,o)},p:zn,d(r){r&&ae(e)}}}function Pa(s){let e,t='<div class="flex p-4"><div class="shrink-0"><svg class="shrink-0 size-4 text-blue-500 mt-0.5" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm.93-9.412-1 4.705c-.07.34.029.533.304.533.194 0 .487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703 0-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381 2.29-.287zM8 5.5a1 1 0 1 1 0-2 1 1 0 0 1 0 2z"></path></svg></div> <div class="ms-3"><p id="hs-toast-normal-example-label" class="text-sm text-gray-700 dark:text-neutral-400">Processing...</p></div></div>';return{c(){e=ee("div"),e.innerHTML=t,this.h()},l(r){e=te(r,"DIV",{class:!0,role:!0,tabindex:!0,"aria-labelledby":!0,"data-svelte-h":!0}),_t(e)!=="svelte-xpal3g"&&(e.innerHTML=t),this.h()},h(){J(e,"class","max-w-xs bg-white border border-gray-200 rounded-xl shadow-lg dark:bg-neutral-800 dark:border-neutral-700 z-100"),J(e,"role","alert"),J(e,"tabindex","-1"),J(e,"aria-labelledby","hs-toast-normal-example-label")},m(r,o){Yt(r,e,o)},d(r){r&&ae(e)}}}function Oa(s){let e,t,r,o='<svg class="shrink-0 size-4 text-red-500 mt-0.5" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zM5.354 4.646a.5.5 0 1 0-.708.708L7.293 8l-2.647 2.646a.5.5 0 0 0 .708.708L8 8.707l2.646 2.647a.5.5 0 0 0 .708-.708L8.707 8l2.647-2.646a.5.5 0 0 0-.708-.708L8 7.293 5.354 4.646z"></path></svg>',a,u,d,p=s[4].svelte_internal_message+"",g;return{c(){e=ee("div"),t=ee("div"),r=ee("div"),r.innerHTML=o,a=Ie(),u=ee("div"),d=ee("p"),g=Wn(p),this.h()},l(y){e=te(y,"DIV",{class:!0,role:!0,tabindex:!0,"aria-labelledby":!0});var w=be(e);t=te(w,"DIV",{class:!0});var D=be(t);r=te(D,"DIV",{class:!0,"data-svelte-h":!0}),_t(r)!=="svelte-mnfjrn"&&(r.innerHTML=o),a=je(D),u=te(D,"DIV",{class:!0});var F=be(u);d=te(F,"P",{id:!0,class:!0});var $=be(d);g=Gn($,p),$.forEach(ae),F.forEach(ae),D.forEach(ae),w.forEach(ae),this.h()},h(){J(r,"class","shrink-0"),J(d,"id","hs-toast-error-example-label"),J(d,"class","text-sm text-gray-700 dark:text-neutral-400"),J(u,"class","ms-3"),J(t,"class","flex p-4"),J(e,"class","max-w-xs bg-white border border-gray-200 rounded-xl shadow-lg dark:bg-neutral-800 dark:border-neutral-700 z-100"),J(e,"role","alert"),J(e,"tabindex","-1"),J(e,"aria-labelledby","hs-toast-error-example-label")},m(y,w){Yt(y,e,w),G(e,t),G(t,r),G(t,a),G(t,u),G(u,d),G(d,g)},p(y,w){w&16&&p!==(p=y[4].svelte_internal_message+"")&&Yn(g,p)},d(y){y&&ae(e)}}}function Ca(s){let e,t,r=s[4].successful_message+"",o;return{c(){e=ee("div"),t=ee("span"),o=Wn(r),this.h()},l(a){e=te(a,"DIV",{class:!0});var u=be(e);t=te(u,"SPAN",{class:!0});var d=be(t);o=Gn(d,r),d.forEach(ae),u.forEach(ae),this.h()},h(){J(t,"class","text-lg text-cyan-600 dark:text-cyan-300"),J(e,"class","flex")},m(a,u){Yt(a,e,u),G(e,t),G(t,o)},p(a,u){u&16&&r!==(r=a[4].successful_message+"")&&Yn(o,r)},d(a){a&&ae(e)}}}function Th(s){let e,t='<span class="relative flex h-3 w-3"><span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-cyan-400 opacity-75"></span> <span class="relative inline-flex rounded-full h-3 w-3 bg-cyan-500"></span></span> <span class="px-2 text-gray-600 dark:text-neutral-400 font-bold">Online</span>';return{c(){e=ee("div"),e.innerHTML=t,this.h()},l(r){e=te(r,"DIV",{class:!0,"data-svelte-h":!0}),_t(e)!=="svelte-hfgq2j"&&(e.innerHTML=t),this.h()},h(){J(e,"class","inline-flex items-center")},m(r,o){Yt(r,e,o)},p:zn,d(r){r&&ae(e)}}}function Ah(s){let e,t,r='<span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-red-400 opacity-75"></span> <span class="relative inline-flex rounded-full h-3 w-3 bg-red-500"></span>',o,a,u;return{c(){e=ee("div"),t=ee("span"),t.innerHTML=r,o=Ie(),a=ee("div"),u=Wn(s[3]),this.h()},l(d){e=te(d,"DIV",{class:!0});var p=be(e);t=te(p,"SPAN",{class:!0,"data-svelte-h":!0}),_t(t)!=="svelte-493u0u"&&(t.innerHTML=r),o=je(p),a=te(p,"DIV",{class:!0});var g=be(a);u=Gn(g,s[3]),g.forEach(ae),p.forEach(ae),this.h()},h(){J(t,"class","relative flex h-3 w-3"),J(a,"class","px-2 text-gray-600 dark:text-neutral-400 text-wrap w-1/2"),J(e,"class","inline-flex items-center")},m(d,p){Yt(d,e,p),G(e,t),G(e,o),G(e,a),G(a,u)},p(d,p){p&8&&Yn(u,d[3])},d(d){d&&ae(e)}}}function Rh(s){let e,t,r,o,a,u,d,p="Sign up",g,y,w="KBVE Authentication Portal",D,F,$,L,V,Q,le,he,X="Username",Xe,Le,ye,jt,at,Qe,Xt="Email Address",ce,Ee,Se,Qt,ot,St,ft='<label for="register-password" class="mb-1 block text-xs md:text-sm md:mb-2 text-neutral-800 dark:text-neutral-200">Password</label>',pt,He,Ue,Br,Ge,mt,Zt='<label for="confirm-register-password" class="mb-1 block text-xs md:text-sm md:mb-2 text-neutral-800 dark:text-neutral-200">Confirm Password</label>',yt,xt,Je,Y,Dt,ct,pe,Ve,er=s[2]?"Loading...":"Register",rt,Mr,gt,Pt,qr,Ye,Ze,gr,Nt,Re=s[1]&&!window?.hcaptcha&&xa(s),Oe=s[2]&&Pa(),xe=s[4].svelte_internal_message&&Oa(s),Ae=s[4].successful_message&&Ca(s);function $t(re,Pe){return re[3]?Ah:Th}let Lt=$t(s),Be=Lt(s);return{c(){Re&&Re.c(),e=Ji(),t=Ie(),r=ee("div"),o=ee("div"),a=ee("div"),u=ee("div"),d=ee("h3"),d.textContent=p,g=Ie(),y=ee("h1"),y.textContent=w,D=Ie(),Oe&&Oe.c(),F=Ie(),xe&&xe.c(),$=Ie(),Ae&&Ae.c(),L=Ie(),V=ee("form"),Q=ee("div"),le=ee("div"),he=ee("label"),he.textContent=X,Xe=Ie(),Le=ee("div"),ye=ee("input"),jt=Ie(),at=ee("div"),Qe=ee("label"),Qe.textContent=Xt,ce=Ie(),Ee=ee("div"),Se=ee("input"),Qt=Ie(),ot=ee("div"),St=ee("div"),St.innerHTML=ft,pt=Ie(),He=ee("div"),Ue=ee("input"),Br=Ie(),Ge=ee("div"),mt=ee("div"),mt.innerHTML=Zt,yt=Ie(),xt=ee("div"),Je=ee("input"),Y=Ie(),Dt=ee("div"),ct=ee("div"),pe=Ie(),Ve=ee("button"),rt=Wn(er),Mr=Ie(),gt=ee("div"),Pt=ee("div"),Be.c(),qr=Ie(),Ye=ee("dotlottie-player"),this.h()},l(re){const Pe=Ko("svelte-1fvsnp3",Hs.head);Re&&Re.l(Pe),e=Ji(),Pe.forEach(ae),t=je(re),r=te(re,"DIV",{class:!0});var vr=be(r);o=te(vr,"DIV",{class:!0,id:!0});var ut=be(o);a=te(ut,"DIV",{class:!0});var W=be(a);u=te(W,"DIV",{class:!0});var De=be(u);d=te(De,"H3",{class:!0,"data-svelte-h":!0}),_t(d)!=="svelte-12p1rd1"&&(d.textContent=p),g=je(De),y=te(De,"H1",{class:!0,"data-svelte-h":!0}),_t(y)!=="svelte-4x0q1u"&&(y.textContent=w),D=je(De),Oe&&Oe.l(De),F=je(De),xe&&xe.l(De),$=je(De),Ae&&Ae.l(De),L=je(De),V=te(De,"FORM",{id:!0,class:!0,action:!0});var vt=be(V);Q=te(vt,"DIV",{class:!0});var Fe=be(Q);le=te(Fe,"DIV",{});var q=be(le);he=te(q,"LABEL",{for:!0,class:!0,"data-svelte-h":!0}),_t(he)!=="svelte-1w0boxg"&&(he.textContent=X),Xe=je(q),Le=te(q,"DIV",{});var br=be(Le);ye=te(br,"INPUT",{type:!0,id:!0,name:!0,autocomplete:!0,class:!0,"aria-describedby":!0}),br.forEach(ae),q.forEach(ae),jt=je(Fe),at=te(Fe,"DIV",{});var tr=be(at);Qe=te(tr,"LABEL",{for:!0,class:!0,"data-svelte-h":!0}),_t(Qe)!=="svelte-54c5ua"&&(Qe.textContent=Xt),ce=je(tr),Ee=te(tr,"DIV",{});var wr=be(Ee);Se=te(wr,"INPUT",{type:!0,id:!0,name:!0,autocomplete:!0,class:!0,"aria-describedby":!0}),wr.forEach(ae),tr.forEach(ae),Qt=je(Fe),ot=te(Fe,"DIV",{});var rr=be(ot);St=te(rr,"DIV",{class:!0,"data-svelte-h":!0}),_t(St)!=="svelte-ghqbo6"&&(St.innerHTML=ft),pt=je(rr),He=te(rr,"DIV",{});var _r=be(He);Ue=te(_r,"INPUT",{type:!0,id:!0,name:!0,class:!0,"aria-describedby":!0}),_r.forEach(ae),rr.forEach(ae),Br=je(Fe),Ge=te(Fe,"DIV",{});var kr=be(Ge);mt=te(kr,"DIV",{class:!0,"data-svelte-h":!0}),_t(mt)!=="svelte-18n8n7b"&&(mt.innerHTML=Zt),yt=je(kr),xt=te(kr,"DIV",{});var pn=be(xt);Je=te(pn,"INPUT",{type:!0,id:!0,name:!0,class:!0,"aria-describedby":!0}),pn.forEach(ae),kr.forEach(ae),Y=je(Fe),Dt=te(Fe,"DIV",{});var Ot=be(Dt);ct=te(Ot,"DIV",{id:!0,class:!0}),be(ct).forEach(ae),Ot.forEach(ae),pe=je(Fe),Ve=te(Fe,"BUTTON",{type:!0,class:!0});var Ct=be(Ve);rt=Gn(Ct,er),Ct.forEach(ae),Fe.forEach(ae),vt.forEach(ae),De.forEach(ae),Mr=je(W),gt=te(W,"DIV",{class:!0});var Ut=be(gt);Pt=te(Ut,"DIV",{class:!0});var nr=be(Pt);Be.l(nr),nr.forEach(ae),qr=je(Ut),Ye=te(Ut,"DOTLOTTIE-PLAYER",{autoplay:!0,loop:!0,class:!0,mode:!0,src:!0});var we=be(Ye);we.forEach(ae),Ut.forEach(ae),W.forEach(ae),ut.forEach(ae),vr.forEach(ae),this.h()},h(){J(d,"class","text-blue-400 mb-1"),J(y,"class","page-title text-white font-bold text-3xl mb-5 lg:text-3xl xl:text-4xl 2xl:text-5xl"),J(he,"for","login-username"),J(he,"class","mb-1 block text-xs text-left md:text-sm md:mb-2 text-neutral-800 dark:text-neutral-200"),J(ye,"type","text"),J(ye,"id","register-username"),J(ye,"name","username"),J(ye,"autocomplete","username"),J(ye,"class","block w-full h-4 md:h-12 rounded-lg border border-neutral-200 bg-neutral-50 px-4 py-3 text-sm text-neutral-700 focus:border-neutral-200 focus:outline-none focus:ring focus:ring-neutral-400 disabled:pointer-events-none disabled:opacity-50 dark:border-neutral-600 dark:bg-neutral-700/30 dark:text-neutral-300 dark:focus:ring-1"),ye.required=!0,J(ye,"aria-describedby","register-username"),J(Qe,"for","register-email"),J(Qe,"class","mb-1 block text-xs text-left md:text-sm md:mb-2 text-neutral-800 dark:text-neutral-200"),J(Se,"type","email"),J(Se,"id","register-email"),J(Se,"name","email"),J(Se,"autocomplete","email"),J(Se,"class","block w-full h-4 md:h-12 rounded-lg border border-neutral-200 bg-neutral-50 px-4 py-3 text-sm text-neutral-700 focus:border-neutral-200 focus:outline-none focus:ring focus:ring-neutral-400 disabled:pointer-events-none disabled:opacity-50 dark:border-neutral-600 dark:bg-neutral-700/30 dark:text-neutral-300 dark:focus:ring-1"),Se.required=!0,J(Se,"aria-describedby","register-email"),J(St,"class","flex items-center justify-between"),J(Ue,"type","password"),J(Ue,"id","register-password"),J(Ue,"name","password"),J(Ue,"class","block w-full h-4 md:h-12 rounded-lg border border-neutral-200 bg-neutral-50 px-4 py-3 text-sm text-neutral-700 focus:border-neutral-200 focus:outline-none focus:ring focus:ring-neutral-400 disabled:pointer-events-none disabled:opacity-50 dark:border-neutral-600 dark:bg-neutral-700/30 dark:text-neutral-300 dark:focus:ring-1"),Ue.required=!0,J(Ue,"aria-describedby","register-password"),J(mt,"class","flex items-center justify-between"),J(Je,"type","password"),J(Je,"id","confirm-register-password"),J(Je,"name","password"),J(Je,"class","block w-full h-4 md:h-12 rounded-lg border border-neutral-200 bg-neutral-50 px-4 py-3 text-sm text-neutral-700 focus:border-neutral-200 focus:outline-none focus:ring focus:ring-neutral-400 disabled:pointer-events-none disabled:opacity-50 dark:border-neutral-600 dark:bg-neutral-700/30 dark:text-neutral-300 dark:focus:ring-1"),Je.required=!0,J(Je,"aria-describedby","confirm-register-password"),J(ct,"id","h-captcha-"+s[6]),J(ct,"class","flex justify-center scale-75 md:scale-100"),J(Ve,"type","submit"),J(Ve,"class",`${jh} ${Dh} ${Nh} ${$h} ${Lh} ${Uh} ${Fh}`),Ve.disabled=s[2],J(Q,"class","grid gap-y-2 md:gap-y-4"),J(V,"id","registerForm"),J(V,"class","opacity-0 transition-opacity duration-500"),J(V,"action","#"),J(u,"class","relative"),J(Pt,"class",""),Qr(Ye,"autoplay",""),Qr(Ye,"loop",""),Qr(Ye,"class","hidden md:block md:w-full"),Qr(Ye,"mode","normal"),Ta(Ye.src,Ze="/assets/lottie/"+Ih)||Qr(Ye,"src",Ze),J(gt,"class","flex flex-col w-1/2"),J(a,"class","px-16 flex flex-row justify-center items-center lg:justify-between"),J(o,"class","py-16 opacity-0 transition-opacity duration-500"),J(o,"id","formulation_form"),J(r,"class","")},m(re,Pe){Re&&Re.m(Hs.head,null),G(Hs.head,e),Yt(re,t,Pe),Yt(re,r,Pe),G(r,o),G(o,a),G(a,u),G(u,d),G(u,g),G(u,y),G(u,D),Oe&&Oe.m(u,null),G(u,F),xe&&xe.m(u,null),G(u,$),Ae&&Ae.m(u,null),G(u,L),G(u,V),G(V,Q),G(Q,le),G(le,he),G(le,Xe),G(le,Le),G(Le,ye),Ht(ye,s[4].username),G(Q,jt),G(Q,at),G(at,Qe),G(at,ce),G(at,Ee),G(Ee,Se),Ht(Se,s[4].email),G(Q,Qt),G(Q,ot),G(ot,St),G(ot,pt),G(ot,He),G(He,Ue),Ht(Ue,s[4].password),G(Q,Br),G(Q,Ge),G(Ge,mt),G(Ge,yt),G(Ge,xt),G(xt,Je),Ht(Je,s[4].confirm),G(Q,Y),G(Q,Dt),G(Dt,ct),G(Q,pe),G(Q,Ve),G(Ve,rt),G(a,Mr),G(a,gt),G(gt,Pt),Be.m(Pt,null),G(gt,qr),G(gt,Ye),gr||(Nt=[Zr(ye,"input",s[16]),Zr(Se,"input",s[17]),Zr(Ue,"input",s[18]),Zr(Je,"input",s[19]),Zr(V,"submit",zo(s[0]))],gr=!0)},p(re,[Pe]){re[1]&&!window?.hcaptcha?Re?Re.p(re,Pe):(Re=xa(re),Re.c(),Re.m(e.parentNode,e)):Re&&(Re.d(1),Re=null),re[2]?Oe||(Oe=Pa(),Oe.c(),Oe.m(u,F)):Oe&&(Oe.d(1),Oe=null),re[4].svelte_internal_message?xe?xe.p(re,Pe):(xe=Oa(re),xe.c(),xe.m(u,$)):xe&&(xe.d(1),xe=null),re[4].successful_message?Ae?Ae.p(re,Pe):(Ae=Ca(re),Ae.c(),Ae.m(u,L)):Ae&&(Ae.d(1),Ae=null),Pe&16&&ye.value!==re[4].username&&Ht(ye,re[4].username),Pe&16&&Se.value!==re[4].email&&Ht(Se,re[4].email),Pe&16&&Ue.value!==re[4].password&&Ht(Ue,re[4].password),Pe&16&&Je.value!==re[4].confirm&&Ht(Je,re[4].confirm),Pe&4&&er!==(er=re[2]?"Loading...":"Register")&&Yn(rt,er),Pe&4&&(Ve.disabled=re[2]),Lt===(Lt=$t(re))&&Be?Be.p(re,Pe):(Be.d(1),Be=Lt(re),Be&&(Be.c(),Be.m(Pt,null)))},i:zn,o:zn,d(re){re&&(ae(t),ae(r)),Re&&Re.d(re),ae(e),Oe&&Oe.d(),xe&&xe.d(),Ae&&Ae.d(),Be.d(),gr=!1,Ho(Nt)}}}let Ih="/robot.lottie";const jh="inline-flex w-full items-center justify-center gap-x-2 rounded-lg px-4 py-1 text-sm font-normal text-blue-400 focus-visible:ring outline-none transition duration-300 py-3",Dh="border border-transparent",Nh="bg-blue-100 dark:focus:outline-none",$h="hover:bg-blue-400 hover:text-white",Lh="2xl:text-base",Uh="disabled:pointer-events-none disabled:opacity-50 disabled:animate-pulse",Fh="ring-zinc-500 dark:ring-zinc-200";function Bh(s,e,t){const r=Jo(),o=()=>{t(2,y=!1),t(4,X.successful_message="",X),p&&g&&w&&hcaptcha.reset(w)},a=ce=>{if(p&&g&&w)return hcaptcha.execute(w,ce)},u=async()=>{if(t(2,y=!0),D=await nn.createActionULID("registerUser"),!D){t(4,X.svelte_internal_message="Failed to create action!",X),o();return}try{const ce=await nn.registerUser(X.email,X.password,X.confirm,D,X.username,X.captchaToken);if(ce){t(4,X.successful_message=`Welcome, ${ce.username||ce.email}! Registration successful. Redirecting in 2 Seconds`,X),console.log("User registered and profile saved:",ce);const Ee=await nn.getSession();Ee?(console.log("User is already logged in after registration:",Ee),setTimeout(()=>{window.location.href="/dashboard"},1500)):setTimeout(()=>{window.location.href="/login"},1500);return}await d(D)}catch(ce){console.error("Registration failed:",ce),await d(D)}finally{t(2,y=!1)}},d=async ce=>{const Ee=await nn.getErrorByActionId(ce);Ee?t(4,X.svelte_internal_message=Ee,X):t(4,X.svelte_internal_message="An unexpected error occurred. Please try again.",X);const Se=await nn.getDetailedErrorByActionId(ce);Se?t(3,F=Se):t(4,X.svelte_internal_message="An unexpected error occurred. Please try again.",X)};let p=!1,g=!1,y=!1,w,D,F,{hl:$=""}=e,{sitekey:L=Hn.get().hcaptcha}=e,{apihost:V=Hn.get().hcaptcha_api}=e,{reCaptchaCompat:Q=!0}=e,{theme:le=Ia.DARK}=e,{size:he="compact"}=e,X={email:"",password:"",confirm:"",username:"",captchaToken:"",svelte_internal_message:"",successful_message:""};const Xe=new URLSearchParams({recaptchacompat:Q?"on":"off",onload:"hcaptchaOnLoad",render:"explicit"}),Le=`${V}?${Xe.toString()}`,ye=Math.floor(Math.random()*100);Vo(()=>{_h({elementIdOrName:"skeleton_login_loader",duration:500}),document.getElementById("astro_error_message")&&document.getElementById("astro_error_message");const ce=document.getElementById("formulation_form");ce&&setTimeout(()=>{ce.classList.replace("opacity-0","opacity-100")},200);const Ee=document.getElementById("registerForm");Ee&&setTimeout(()=>{Ee.classList.replace("opacity-0","opacity-100")},500),window.hcaptchaOnLoad=()=>{r("load"),t(15,g=!0)},window.onSuccess=Se=>{r("success",{token:Se}),t(4,X.captchaToken=Se,X)},window.onError=()=>{r("error")},window.onClose=()=>{r("close")},window.onExpired=()=>{r("expired"),o()},r("mount"),t(1,p=!0)}),Wo(()=>{window.hcaptchaOnLoad=null,window.onSuccess=null,g&&(hcaptcha=null)});function jt(){X.username=this.value,t(4,X)}function at(){X.email=this.value,t(4,X)}function Qe(){X.password=this.value,t(4,X)}function Xt(){X.confirm=this.value,t(4,X)}return s.$$set=ce=>{"hl"in ce&&t(9,$=ce.hl),"sitekey"in ce&&t(10,L=ce.sitekey),"apihost"in ce&&t(11,V=ce.apihost),"reCaptchaCompat"in ce&&t(12,Q=ce.reCaptchaCompat),"theme"in ce&&t(13,le=ce.theme),"size"in ce&&t(14,he=ce.size)},s.$$.update=()=>{s.$$.dirty&58882&&p&&g&&(w=hcaptcha.render(`h-captcha-${ye}`,{sitekey:L,hl:$,theme:le,callback:"onSuccess","error-callback":"onError","close-callback":"onClose","expired-callback":"onExpired",size:he}))},[u,p,y,F,X,Le,ye,o,a,$,L,V,Q,le,he,g,jt,at,Qe,Xt]}class Wh extends Bo{constructor(e){super(),Mo(this,e,Bh,Rh,qo,{reset:7,execute:8,handleRegister:0,hl:9,sitekey:10,apihost:11,reCaptchaCompat:12,theme:13,size:14})}get reset(){return this.$$.ctx[7]}get execute(){return this.$$.ctx[8]}get handleRegister(){return this.$$.ctx[0]}}export{Wh as default};
